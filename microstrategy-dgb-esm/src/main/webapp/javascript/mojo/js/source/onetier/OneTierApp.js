(function(){mstrmojo.requiresCls("mstrmojo.vi.VisualInsightApp","mstrmojo.onetier.controllers.RootController","mstrmojo._SupportsEllipsisText","mstrmojo.customVisLoader","mstrmojo.hash","mstrmojo.css","mstrmojo.dom","mstrmojo.func","mstrmojo.array","mstrmojo.string");mstrmojo.requiresDescs(119,13569,15628,15629,117,118,137,138,139,140,141,142,143,190,218,219,221,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355,356,358,359,360,361,362,363,364,368,369,370,371,372,375,379,380,382,383,384,385,386,387,388,389,390,391,392,393,394,395,396,397,398,399,400,401,402,403,404,405,407,408,512,527,529,530,537,538,545,701,875,1005,1158,1885,1886,1892,2020,2021,2033,2034,2035,2052,2057,2102,2120,2122,2131,2132,2142,2146,2175,2184,2185,2210,2214,2215,2216,2409,2460,2461,2510,2519,2559,2647,2699,2789,2790,2890,2901,2946,2947,2948,2950,2961,2983,2985,3037,3038,3039,3040,3041,3042,3044,3046,3047,3048,3049,3050,3051,3052,3053,3054,3153,3154,3155,3156,3157,3168,3170,3264,3273,3274,3275,3305,3306,3307,3321,3322,3323,3324,3325,3326,3327,3328,3329,3330,3331,3377,3380,3434,3478,3479,3484,3533,3544,3583,3623,3624,3625,3626,3631,3632,3642,3643,3702,3798,3807,3811,3849,3850,3851,3878,3899,3900,3901,3902,3903,4388,4389,4400,4402,4405,4406,4407,4410,4500,4501,4502,4506,4546,4579,4585,4637,4752,4754,4862,4875,4883,4884,4885,4886,4888,4889,4891,4947,4954,4965,4969,4970,5140,5141,5142,5174,5175,5207,5224,5225,5228,5238,5239,5244,5245,5260,5261,5271,5282,5283,5297,5308,5309,5310,5325,5326,5327,5328,5329,5330,5331,5332,5333,5334,5335,5336,5337,5338,5339,5340,5341,5342,5365,5414,5415,5416,5417,5421,5422,5425,5426,5434,5447,5448,5449,5450,5451,5452,5453,5454,5455,5456,5457,5458,5459,5460,5461,5462,5463,5464,5465,5466,5467,5468,5469,5470,5471,5472,5473,5474,5475,5476,5477,5478,5479,5480,5481,5482,5483,5484,5485,5486,5487,5488,5489,5490,5491,5553,5554,5576,5577,5578,5579,5580,5581,5582,5583,5607,5674,5686,5720,5721,5728,5753,5776,5778,5784,5785,5786,5808,5858,5865,5867,5884,5901,5910,5921,5922,5923,5924,5925,5950,5956,5969,5970,5971,5976,5977,5978,5979,5980,5981,5982,6003,6117,6140,6141,6156,6595,7578,7579,7580,7743,7744,7745,7746,7747,7978,7979,8122,8953,9030,9031,9032,9034,9035,9174,9272,9751,9752,9829,9830,9832,9833,9834,9835,9836,9837,11576,11577,11578,14475,14584,5286,15751,15800);var $CSS=mstrmojo.css,$DOM=mstrmojo.dom,$HASH=mstrmojo.hash,$ARR=mstrmojo.array;var CUSTOM_VIZ_CSS=["global.css","Html5ViPage.css"],CUSTOM_VIZ_CSS_HREF_PATHS=["../plugins/","/style/"],DOSSIER_SERVER_CUSTOM_VIZ_CSS_HREF_PATHS=["plugins/","/style/"];function getCustomVizCSSPaths(custVizname,isFromDossierServer){var customCss=[],rootPluginPath=isFromDossierServer?(mstrApp.dossierServerBaseUrl+DOSSIER_SERVER_CUSTOM_VIZ_CSS_HREF_PATHS[0]):CUSTOM_VIZ_CSS_HREF_PATHS[0];CUSTOM_VIZ_CSS.forEach(function(cssFile){customCss.push(rootPluginPath+custVizname+CUSTOM_VIZ_CSS_HREF_PATHS[1]+cssFile+"?v="+Date.now());});return customCss;}function setupDossierServerCustomVisualizations(pluginNames,isVisBuilderApp){if(pluginNames&&pluginNames.length>0){var customCss=[];$HASH.copy(mstrConfig.dossierServerCustomVisList,mstrConfig.pluginsVisList);pluginNames.forEach(function(pluginName){if(!isVisBuilderApp&&pluginNames[pluginName]==="nonDashboard"){return ;}customCss=customCss.concat(getCustomVizCSSPaths(pluginName,true));});window.setTimeout(function(){mstrmojo.insertCSSLinks(customCss);},0);}}function deleteCustomVisualizations(pluginNames){var vizName,currentPluginVisList=mstrConfig.pluginsVisList;pluginNames.forEach(function(cachedName){for(vizName in currentPluginVisList){if(currentPluginVisList[vizName].pn===cachedName||vizName===cachedName){delete currentPluginVisList[vizName];}}});}function restoreModelData(newModelData){if(mstrApp.isAppStatePause()){var unpublishedCubes=$HASH.walk("rootCtrl.docCtrl.model.unpublishedCubes",mstrApp);if(unpublishedCubes&&newModelData){newModelData.unpublishedCubes=unpublishedCubes;}}}var openModalDialogs={};mstrmojo.onetier.OneTierApp=mstrmojo.declare(mstrmojo.vi.VisualInsightApp,[mstrmojo._SupportsEllipsisText],{scriptClass:"mstrmojo.onetier.OneTierApp",isSingleTier:true,isPrefLangChanged:false,isPrefNdfChanged:false,_categoryCache:{},start:function start(docModelData){this.isWSLiveMode=undefined;$CSS.addClass(document.body,mstrApp.isSingleTier&&$DOM.isMac()?"mac":"none-mac");if(!!mstrApp.isWorkstation){$CSS.addClass(document.body,"workstation");}mstrApp.set("browseAllObjects",!docModelData.disableAllObjects);mstrmojo.helpPath=function(){return(mstrApp.helpUrl||"../help/")+"WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/Content/";};mstrmojo.helpPathMobileAdmin=function(){return(mstrApp.helpUrl||"../help/")+"WebHelp/Lang_"+(mstrApp.helpLocaleId||mstrApp.localeId)+"/";};restoreModelData(docModelData);this._super(docModelData);if(docModelData.istup){window.setTimeout(function(){window.FormWrapper.restoreDashboard();},0);}},getDossierCustomVisList:function getDossierCustomVisList(callback){if(!this.getWSLiveMode()){mstrConfig.dossierServerCustomVisList={};if(callback.success){callback.success();}return ;}this.serverRequest({taskId:"getDossierCustomVisList"},mstrmojo.func.wrapMethods({success:function success(res){mstrConfig.dossierServerCustomVisList=res||{};}},callback));},setupCustomVisualizations:function setupCustomVisualizations(pluginNames,isVisBuilderApp){if(mstrApp.supportFeature(mstrmojo.vi.enums.EnumFeatures.SUPPORT_LIVEMODE)&&mstrApp.getWSLiveMode()){var dossierServerVisList=mstrConfig.dossierServerCustomVisList,dossierServerPluginNames=mstrConfig.dossierServerPluginNames=$ARR.map(Object.keys(dossierServerVisList),function(styleName){var vis=dossierServerVisList[styleName],sc=vis&&vis.c;if(sc&&sc.match(/^plugins\./)){return sc.substring(8,sc.indexOf(".",8));}else{return sc;}});pluginNames=$ARR.filter(pluginNames,function(plugin){return $ARR.indexOf(dossierServerPluginNames,plugin)<0;});setupDossierServerCustomVisualizations(dossierServerPluginNames,isVisBuilderApp);}if(pluginNames&&pluginNames.length>0){var customCss=[];$HASH.copy((mstrmojo.customVisLoader.loadVisualizations(pluginNames,isVisBuilderApp)),mstrConfig.pluginsVisList);pluginNames.forEach(function(pluginName){if(!isVisBuilderApp&&pluginNames[pluginName]==="nonDashboard"){return ;}customCss=customCss.concat(getCustomVizCSSPaths(pluginName));});window.setTimeout(function(){mstrmojo.insertCSSLinks(customCss);},0);}},getWSLiveMode:function getWSLiveMode(){return window.FormWrapper&&window.FormWrapper.isWSLiveMode&&(parseInt(window.FormWrapper.isWSLiveMode(),10)===1);},getRootController:function getRootController(){return(this.rootCtrl=this.rootCtrl||new mstrmojo.onetier.controllers.RootController());},confirmApplyTheme:function confirmApplyTheme(themeName,themeId){this.getRootController().confirmApplyTheme(themeName,themeId);},getRecentGallery:function getRecentGallery(isOnVizDeletion){var cachedNames=mstrConfig.pluginNames,currentNames=mstrConfig.pluginNames=(window.FormWrapper.getCustomizationNames()||"").split(",");if(!!isOnVizDeletion){deleteCustomVisualizations($ARR.difference(cachedNames,currentNames));}else{this.setupCustomVisualizations($ARR.difference(currentNames,cachedNames),this.isVisBuilderApp);}},resetCustomVisGallery:function resetCustomVisGallery(){var dossierServerPluginsName=mstrConfig.dossierServerPluginNames||[],localPluginsName=mstrConfig.pluginNames||[],pluginsNames=dossierServerPluginsName.concat(localPluginsName),customVis,scriptClass,dz,em;$ARR.forEach(pluginsNames,function(pluginName){customVis=mstrConfig.pluginsVisList[pluginName];if(customVis){if(customVis.c){scriptClass="mstrmojo."+customVis.c;mstrmojo.invalidateCls(scriptClass);}if(customVis.dz){dz="mstrmojo."+customVis.dz;mstrmojo.invalidateCls(dz);}if(customVis.em){em="mstrmojo."+customVis.em;mstrmojo.invalidateCls(em);}}});deleteCustomVisualizations(mstrConfig.dossierServerPluginNames||[]);deleteCustomVisualizations(mstrConfig.pluginNames);mstrConfig.pluginNames=mstrConfig.dossierServerPluginNames=[];},serverResponse:function serverResponse(id,methodName,requestID,status,responseJSON){var sp=mstrmojo.all[id],request=sp&&sp.getRequest&&sp.getRequest(requestID);if((!sp||!status)&&!(request&&request.config&&request.config.hideFailureErr)){this.onerror(responseJSON);}this._super(id,methodName,requestID,status,responseJSON);},getPreferredColors:function getPreferredColors(){return mstrmojo.array.map(this.rootCtrl.docCtrl.model.getCurrentPaletteColors(),function(encodedColor){return mstrmojo.color.decodeColor(encodedColor);});},onFormWrapperClick:function onFormWrapperClick(){window.document.body.dispatchEvent(new Event("mousedown"));},openPage:function openPage(url){window.FormWrapper.openPage(url);},modalEditorChange:function modalEditorChange(id,isOpen){var fnToggle=function(){window.FormWrapper.toggleNetMenu(Object.keys(openModalDialogs).length?"disable":"enable");};if(isOpen){openModalDialogs[id]=true;fnToggle();}else{delete openModalDialogs[id];fnToggle();}},enableProgress:true,toggleProgress:function(enable){this.enableProgress=enable;},showProgress:function(config){if(!window.FormWrapper.showLoadProgressDialog||mstrApp.isWorkstation){return ;}if(config&&config.category){var cntCat="_"+config.category+"cnt";this[cntCat]=(this[cntCat]||0)+1;this._categoryCache[cntCat]=true;}if(!this.enableProgress){return ;}if(!mstrApp.isWaiting()){this.showWait(config);this._isWaitBoxTriggered=true;}else{var msg=config&&config.message||mstrmojo.desc(11960,"Loading Data...");var waitBox=this.getWaitBox();waitBox.editorNode.style.display="block";waitBox.set("displayMsg",msg);if(this.ellipsize("msg",waitBox.msgfield.domNode,false)){msg=waitBox.msgfield.domNode.innerHTML;}waitBox.editorNode.style.display="none";window.FormWrapper.showLoadProgressDialog(msg);}},hideProgress:function(config){if(!window.FormWrapper.closeLoadProgressDialog||mstrApp.isWorkstation){return ;}var me=this;setTimeout(function(){if(config&&config.category){var cntCat="_"+config.category+"cnt";if(me.hasOwnProperty(cntCat)){me[cntCat]--;if(me[cntCat]<=0){if(me._isWaitBoxTriggered){me.hideWait();me._isWaitBoxTriggered=false;}else{window.FormWrapper.closeLoadProgressDialog();}delete me[cntCat];}return ;}}me.hideWait(true);window.FormWrapper.closeLoadProgressDialog();Object.keys(me._categoryCache).forEach(function(key){delete me[key];});me._categoryCache={};},0);},showWait:function(config){this._super(config);if(!window.FormWrapper.showLoadProgressDialog){return ;}if(!mstrApp.isWorkstation){var waitBox=this.getWaitBox();if(mstrApp.isWaiting()&&waitBox.editorNode){waitBox.editorNode.style.display="none";}}window.FormWrapper.showLoadProgressDialog(config&&config.message||mstrmojo.desc(11960,"Loading Data..."));},hideWait:function(force){this._super(force);if(!window.FormWrapper.closeLoadProgressDialog){return ;}var me=this;setTimeout(function(){if(!mstrApp.isWaiting()){window.FormWrapper.closeLoadProgressDialog();}else{var waitBox=me.getWaitBox(),progressBarListener=waitBox.attachEventListener("visibleChange",waitBox.id,function(evt){if(evt.value===false){window.FormWrapper.closeLoadProgressDialog();progressBarListener.clear();}});}},0);}});}());