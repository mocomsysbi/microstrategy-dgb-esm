(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Button","mstrmojo.Box","mstrmojo.dom","mstrmojo.Label","mstrmojo.Image","mstrmojo.Pulldown","mstrmojo.ui.Pulldown","mstrmojo.tooltip","mstrmojo.CheckBox","mstrmojo.TextBox","mstrmojo.SREditor","mstrmojo.DI.DIHelpers","mstrmojo.warehouse.EnumDatabaseType","mstrmojo.DI.DIModel","mstrmojo.DI.DITableStatusList","mstrmojo.locales","mstrmojo.date","mstrmojo.ProgressBar","mstrmojo.DI.DNTextBox","mstrmojo.css","mstrmojo.hash","mstrmojo.string");mstrmojo.requiresDescs(221,773,1302,4311,4364,4996,8473,10160,12761,12509,12762,12763,12764,12765,12766,12767,12769,13005,13028,13029,2502,13257,9242,13274,13444,13882,15071,15072,15077,3464,5923,10639,10159,9705,9704,9380,15095,15096,15097,15098,15099,15100,15101,15102,15103,15104,15105,15205,15206,16017);var $A=mstrmojo.array,$H=mstrmojo.hash,$DIHelper=mstrmojo.DI.DIHelpers,$S=mstrmojo.string,constants=mstrmojo.DI.DIConstants,EVENT_CAN_SAVE_SCHEDULE="canSaveSchedule",EVENT_CAN_START_REFRESH="canStartRefresh",DISABLED_BUTTON_TOOLTIP=mstrmojo.desc(13882,"Please upload the data or unselect the source in order to enable this option."),ENUM={onLabel:6,wtime:2,mday:4},$C=mstrmojo.css,SCHS_DAILY=0,SCHS_WEEKDAY=1,SCHS_WEEKLY=2,SCHS_MONTHLY=3,widthConfig={subscribe:"526px",subscribeChecked:"846px",refresh:"530px"};function timeConfig(mode){this.set("onLabel",mode&ENUM.onLabel);this.set("wtime",mode&ENUM.wtime);this.set("mtime",mode&ENUM.mday);}function getTrgName(){var schs=this.parent;switch(schs.selectTimePulldown.stp){case"Daily":return mstrmojo.desc(10639,"Daily")+" "+schs.time.items[schs.time.selectedIndex].v;case"Weekday":return mstrmojo.desc(10159,"Weekday")+" "+schs.time.items[schs.time.selectedIndex].v;case"Weekly":return mstrmojo.desc(9705,"Weekly")+" "+schs.wtime.items[schs.wtime.selectedIndex].n+" "+schs.time.items[schs.time.selectedIndex].v;case"Monthly":return mstrmojo.desc(9704,"Monthly")+" "+schs.mday.items[schs.mday.selectedIndex].v+" "+schs.time.items[schs.time.selectedIndex].v;default:return schs.selectTimePulldown.stp;}}function getTrgDefinition(){var schs=this.parent,stp=schs.selectTimePulldown.stp;switch(stp){case"Daily":return stp+" "+schs.time.selectedIndex;case"Weekday":return stp+" "+schs.time.selectedIndex;case"Weekly":return stp+" "+schs.wtime.selectedIndex+" "+schs.time.selectedIndex;case"Monthly":return stp+" "+schs.mday.selectedIndex+" "+schs.time.selectedIndex;default:return stp;}}function onCustomSchedule(){var model=this.parent.parent.parent.model,schedule=model&&model.getSchedule(),hasCustomSched=this.parent.parent.chooseSchedPulldown.hasCustomSchedule,d=new Date();if(hasCustomSched){var trgName=getTrgName.call(this),trgDef=getTrgDefinition.call(this);schedule.set("trgName",trgName);schedule.set("curTrg",{n:trgName,id:trgDef,isHidden:true});if(!schedule.subsID){var name=model.cubeName+" "+schedule.trgName+" "+d.toLocaleString();this.parent.parent.parent.secondBox.nameBox.set("sugName",name);schedule.set("subsName",name);}}}function notifyDialogResized(dialog){dialog.raiseEvent({name:"EditorResized"});}function isSourceChanged(model){var changed=false;mstrmojo.hash.forEach(model.importSources,function(value){if(!value.checked){if(value.refreshType!==constants.cubeRefreshType.preserve){value.refreshType=constants.cubeRefreshType.preserve;}}else{if(value.checked){if(value.refreshType===constants.cubeRefreshType.preserve){if(value.origRefreshType!==constants.cubeRefreshType.preserve){value.refreshType=value.origRefreshType;}else{value.refreshType=constants.cubeRefreshType.replaceTable;}}if(value.xdaType===constants.xdaType.excel||value.xdaType===constants.xdaType.text){if(value.sourceInfo.url===""&&!value.hasSelectFile){value.refreshType=constants.cubeRefreshType.preserve;}}}}if(value.checked&&value.refreshType!==value.origRefreshType){changed=true;return false;}});return changed;}function isFileTypeUnsupportChanged(sources){var knownTypes={".xls":1,".xlsx":1,".txt":2,".csv":2};var oriFileName,oriFileType,oriTypePos,uploadFileName,uploadFileType,uploadTypePos,i,source;for(i in sources){source=sources[i];if(!source.fileUploader||!source.sourceInfo){continue;}oriFileName=source.sourceInfo.dbTableName;uploadFileName=source.fileUploader.value;if(!oriFileName||!uploadFileName){continue;}oriTypePos=oriFileName.lastIndexOf(".");uploadTypePos=uploadFileName.lastIndexOf(".");if(oriTypePos===-1||uploadTypePos===-1){continue;}oriFileType=oriFileName.substr(oriTypePos);uploadFileType=uploadFileName.substr(uploadTypePos);if(knownTypes[oriFileType]&&knownTypes[uploadFileType]&&knownTypes[oriFileType]!==knownTypes[uploadFileType]){return true;}}return false;}mstrmojo.DI.DIRepublishScheduleEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.DI.DIRepublishScheduleEditor",cssClass:"mstrmojo-di-scheduleEMMA",title:"",allowHTMLTitle:true,simpleProgressMode:false,showTimeWarningMsg:false,width:"650px",height:"",canSaveScheduleJudgedByNameBox:false,canRefreshJudgedByTableStatusList:true,useRichTooltip:false,resetOKButtonText:function(){var model=this.model;var okButtonText=mstrmojo.desc(1302,"Finish");if(model.operationMode===constants.operationMode.refresh){okButtonText=mstrmojo.desc(773,"Refresh");}if(model.operationMode===constants.operationMode.subscribe){okButtonText=mstrmojo.desc(1085,"Schedule");}this.okButton.set("text",okButtonText);},onOpen:function(){var rootModel=mstrApp.getRootController().model,model=this.model,canHasAdv=false,hasBDE=false,tableIDs,source,i;if(this.opened){return ;}this.opened=true;if(this.subEvt){model.detachEventListener(this.subEvt);}this.resetOKButtonText();if(model.operationMode===constants.operationMode.refresh){this.subEvt=model.attachEventListener("PublishStatusUpdate",this.id,"update");this.set("title",mstrmojo.desc(15103,"Refresh ####").replace("####",$S.htmlAngles(model.cubeName)));if($DIHelper.isWS()){this.set("height","460px");}else{this.set("height",(460+this.titleNode.parentNode.clientHeight+"px"));}this.set("showTimeWarningMsg",!!rootModel.analysisID);this.okButton.set("visible",true);this.cancelButton.set("visible",true);this.cancelButton.set("text",mstrmojo.desc(221,"Cancel"));this.set("width",widthConfig.refresh);}if(model.operationMode===constants.operationMode.subscribe){this.set("help","schedule_a_cube_refresh.htm");this.subEvt=model.attachEventListener("CreateScheduleUpdate",this.id,"update");if($DIHelper.isWS()){$C.addClass(this.okButton.domNode,"emphasizeDisabled");this.toggleEnable(false);}this.set("title",mstrmojo.desc(12762,"Schedule for ####").replace("####",$S.htmlAngles(model.cubeName)));this.okButton.set("visible",true);this.cancelButton.set("visible",true);this.cancelButton.set("text",mstrmojo.desc(221,"Cancel"));tableIDs=model.getAllTableID();for(i=0;i<tableIDs.length;i++){source=model.getImportSource(tableIDs[i]);if(source.canSetAlternateSource()){canHasAdv=true;}if(source.type===constants.sourceType.hadoop||source.databaseType===mstrmojo.warehouse.EnumDatabaseType.BDE){hasBDE=true;}}if(hasBDE){canHasAdv=false;}this.advLink.set("visible",canHasAdv);this.set("width",widthConfig.subscribe);notifyDialogResized(this);}if(model.operationMode===constants.operationMode.create){this.subEvt=model.attachEventListener("CreateScheduleUpdate",this.id,"update");this.set("title",mstrmojo.desc(13028,"### Publishing Status").replace("###",$S.htmlAngles(model.cubeName)));this.set("width","450px");mstrmojo.css.addClass(this.domNode,"pub-create");}if(model.operationMode===constants.operationMode.edit){this.subEvt=model.attachEventListener("PublishStatusUpdate",this.id,"update");this.okButton.set("visible",true);this.cancelButton.set("visible",true);this.cancelButton.set("text",mstrmojo.desc(221,"Cancel"));this.set("width","650px");if(rootModel.isDirectDataAccess){this.set("title",mstrmojo.desc(13029,"### Saving Status").replace("###",$S.htmlAngles(model.cubeName)));}else{this.set("title",mstrmojo.desc(13028,"### Publishing Status").replace("###",$S.htmlAngles(model.cubeName)));}if(this.simpleProgressMode){this.okButton.set("visible",false);this.cancelButton.set("visible",false);this.progress.updateProgress(50);mstrApp.hideWait(true);}}},onClose:function(){var controller=mstrApp.getRootController(),model=this.model,reportId=model.cubeID,editor=this;this.opened=false;if(this.subEvt){model.detachEventListener(this.subEvt);}$A.forEach(model.getAllTableID(),function(id){var source=model.getImportSource(id);source.hasSelectFile=false;source.republishError=undefined;});this.toggleEnable(true);this.statusList.updateStarted=false;this.stopPublishAnimation();this.destroy();if(this.onCompleted&&model.operationMode===constants.operationMode.subscribe&&controller.dialogController.pageZIndex>0){window.setTimeout(function(){if(editor.isSendNow){controller.getCubeQuota({success:function(){controller.scheduleController.updateScheduleAndStatus();}},{showProgress:true,showProgressText:true,progressText:mstrmojo.desc(12955,"Getting information about your cubes...")});}else{controller.scheduleController.updateScheduleAndStatus();}},1);}if(this.onCompleted&&model.operationMode===constants.operationMode.refresh&&controller.dialogController.pageZIndex>0){window.setTimeout(function(){var model,cubesInfo,cubes,idx,dataset={did:reportId};if(mstrApp.refreshMultipleCubes){model=mstrApp.getRootController().getModel();model.publishedDatasets.push(dataset);cubesInfo=model.cubesInfo;cubes=cubesInfo&&cubesInfo.cubes&&cubesInfo.cubes.cube;idx=$A.find(cubes,"cube_id",reportId);if(idx>=0){cubes.splice(idx,1);model.raiseEvent({name:"cubesInfoChange"});}}},1);}if(model.operationMode===constants.operationMode.refresh||model.operationMode===constants.operationMode.subscribe){if(this.onCompleted&&!mstrApp.fromCubesList){mstrApp.getRootController().exitApplication();}else{if(mstrApp.fromCubesList){mstrApp.fromCubesList=false;var cubeID=mstrApp.getRootController().model.cubeID;controller.resetAppforImport();if(!mstrApp.refreshMultipleCubes){controller.getCubeQuota();}else{controller.getCubeInfo(cubeID);}}else{mstrApp.getRootController().cancelApplication();}}}this.toggleEnable(true);this.statusList.updateStarted=false;},onwidthChange:function(){if(this.editorNode){this.editorNode.style.width=this.width||"auto";}},startPublishAnimation:function(){var origTitle=this.title,tickCnt=0,me=this;this._origTitle=origTitle;var animationTick=function(){var txt,dots;if(me._tickTimer===null||!me.titleNode){return ;}switch(tickCnt%3){case 0:dots=".&nbsp;&nbsp;";break;case 1:dots="..&nbsp;";break;case 2:dots="...";break;}txt='<span class="republish-success-label">'+me._origTitle+'</span><span class="republish-success-label color">(&nbsp;'+mstrmojo.desc(4311,"Processing")+dots+"&nbsp)</span>";me.titleNode.innerHTML=txt;tickCnt++;};if(this._tickTimer){return ;}this._tickTimer=window.setInterval(animationTick,1000);},stopPublishAnimation:function(){if(this._tickTimer){window.clearInterval(this._tickTimer);this._tickTimer=null;this.titleNode.innerHTML=this._origTitle;}},update:function(evt){var model=this.model,res,cnt,i,title;this.onCompleted=false;this.onError=false;if(model.operationMode===constants.operationMode.refresh||(model.operationMode===constants.operationMode.edit&&!this.simpleProgressMode)){this.startPublishAnimation();if(evt.completed!==undefined){this.onCompleted=evt.completed;}if(evt.error!==undefined){this.onError=evt.error;}if(this.onCompleted){this.toggleEnable(true);}else{this.toggleEnable(false);}this.cancelButton.set("text",mstrmojo.desc(221,"Cancel"));if(this.onError){this.okButton.set("visible",false);this.cancelButton.set("visible",true);this.sendToHistoryList.set("visible",false);this.statusBox.statusText.set("visible",false);this.stopPublishAnimation();$C.removeClass(window.document.body,"invisible-wait");}else{if(this.onCompleted&&!this.onError){var lauchingApp=mstrApp.launchingApp;if(lauchingApp&&mstrmojo.vi&&mstrmojo.vi.VisualInsightApp&&lauchingApp instanceof mstrmojo.vi.VisualInsightApp&&lauchingApp.isAppStatePause()){if($H.valarray(model.importSources).every(function(value){return value.checked;})){lauchingApp.getRootController().docCtrl.model.removeUnpublishedCubes(model.cubeID);}}this.stopPublishAnimation();title=this.title;if(title.indexOf('<span class="republish-success-label">')<0){title='<span class="republish-success-label">'+title+'</span><span class="republish-success-label color">'+mstrmojo.desc(13444,"( Successfully published to memory )")+"</span>";}this.set("title",title);this.okButton.set("visible",false);this.cancelButton.set("text",mstrmojo.desc(8473,"Done"));this.cancelButton.set("enabled",true);this.sendToHistoryList.set("visible",false);this.cancelButton.set("visible",true);if(model.operationMode===constants.operationMode.refresh){this.statusBox.statusText.set("text",mstrmojo.desc(15100,"Successfully refreshed."));$C.addClass(this.statusBox.statusText.domNode,"finished");}$C.removeClass(window.document.body,"invisible-wait");}}if(evt&&evt.reset){this.stopPublishAnimation();this.toggleEnable(true);this.okButton.set("visible",true);this.cancelButton.set("visible",true);this.cancelButton.set("enabled",true);this.statusBox.statusText.set("visible",false);$C.removeClass(window.document.body,"invisible-wait");}}if(model.operationMode===constants.operationMode.subscribe){res=evt.res;this.cancelButton.set("enabled",true);if(res.subsID){this.okButton.set("visible",false);this.cancelButton.set("visible",true);this.cancelButton.set("text",mstrmojo.desc(8473,"Done"));this.onCompleted=true;this.statusBusy.set("visible",false);}else{this.onError=true;if($DIHelper.isWS()){mstrApp.getRootController().displayError(null,false,res.message,null,mstrmojo.desc(15205,"Schedule Dataset Refresh"),mstrmojo.desc(15206,"This subscription cannot be saved."));}else{mstrApp.getRootController().displayError(mstrmojo.desc(12763,"Cannot save this subscription."),false,res.message);}}$C.removeClass(window.document.body,"invisible-wait");}if(model.operationMode===constants.operationMode.edit&&this.simpleProgressMode){i=0;cnt=0;$H.forEach(model.importSources,function(value){cnt++;if(value.status!=="3"&&value.status!=="4"&&value.status!=="6"){this.onCompleted=false;}if(value.status==="4"||value.status==="6"){this.onError=true;}if(value.status==="3"||value.status==="4"||value.status==="6"){i++;}},this);this.progress.updateProgress(50+i*50/cnt);}},toggleEnable:function(bEnable){this.okButton.set("enabled",!!bEnable);},getFileUploader:function(tableID){return this.statusList.getFileUploader(tableID);},checkCanRefresh:function(){return this.statusList.checkCanRefresh();},checkCanChange:function(){if($DIHelper.isWS()&&this.model.operationMode===constants.operationMode.refresh&&!this.okButton.enabled){return false;}return this.statusList.checkCanChange();},updateSchsStatus:function(bEnable){this.advLink.set("enabled",!!bEnable);this.scheduleBox.chooseSchedPulldown.set("enabled",!!bEnable);this.secondBox.nameBox.set("enabled",!!bEnable);var timeBox=this.scheduleBox.selectTimeBox;if(timeBox.visible){timeBox.selectTimePulldown.set("enabled",!!bEnable);timeBox.wtime.set("enabled",!!bEnable);timeBox.mday.set("enabled",!!bEnable);timeBox.time.set("enabled",!!bEnable);}this.advanceOpsCheckbox.set("enabled",!!bEnable);},children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13005,"Building the cube"),cssClass:"simpleProgress-label",bindings:{visible:"this.parent.simpleProgressMode"}},{alias:"progress",scriptClass:"mstrmojo.ProgressBar",cssClass:"simpleProgress-progress",bindings:{visible:"this.parent.simpleProgressMode"}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(13956,"Publishing time depends on your dataset. Are you sure you want to republish?"),cssClass:"timewarning-label",bindings:{visible:"this.parent.showTimeWarningMsg"}},{alias:"advLink",scriptClass:"mstrmojo.Label",cssClass:"advanceOpsLink",cssDisplay:"table",text:mstrmojo.desc(15095,"Show Advanced Options..."),postCreate:function postCreate(){mstrmojo.ImageCheckBox.prototype.postCreate.call(this);var evtConfig={},listConfig=evtConfig[this.id]={};listConfig.isScheduleAdvancedChange=this.handleAdvMode;mstrApp.getRootController().attachDataChangeListeners(evtConfig);},postBuildRendering:function postBuildRendering(){this.set("checked",mstrApp.getRootController().getScheduleController().isAdvState());},handleAdvMode:function handleAdvMode(evt){this.set("checked",evt.value);},bindings:{visible:function(){return(this.parent.model.operationMode===constants.operationMode.subscribe)&&!this.parent.simpleProgressMode;}},onclick:function(){this.set("checked",!this.checked);notifyDialogResized(this.parent);},oncheckedChange:function(){var bChecked=this.checked,parent=this.parent,statusList=parent.statusList,rootController=mstrApp.getRootController(),scheduleController=rootController.getScheduleController(),cubeID=parent.model.cubeID,callback={success:function success(){var changeList=[],refreshTypes=[];scheduleController.setAdvMode(true);statusList.set("hasIRR",true);mstrmojo.array.forEach(statusList.items,function(item){if(!item.isAll&&item.checked){changeList.push(item.tableID);refreshTypes.push(item.refreshType.toString());}});if(changeList.length>0){scheduleController.createEmmaIRRSourceTables(cubeID,changeList,refreshTypes);}},failure:function failure(res){scheduleController.setAdvMode(false);rootController.displayError(mstrmojo.desc(12766,"Cannot create emma IRR report instance."),false,(res&&res.message)||"");}};statusList.set("bHasSourceFilter",bChecked);statusList.set("bHasAlternateSource",bChecked);statusList.refresh();if(bChecked){this.set("text",mstrmojo.desc(15096,"Hide Advanced Options..."));parent.set("width",widthConfig.subscribeChecked);parent.scheduleBox.set("width","814px");$C.toggleClass(parent.scheduleBox.chooseSchedPulldown.domNode,"chooseSchedPulldownCheck",true);$C.toggleClass(parent.scheduleBox.selectTimeBox.domNode,"selectTimeBoxCheck",true);}else{this.set("text",mstrmojo.desc(15095,"Show Advanced Options..."));parent.editorNode.style.width=widthConfig.subscribe;parent.set("width",widthConfig.subscribe);parent.scheduleBox.set("width","437px");$C.toggleClass(parent.scheduleBox.chooseSchedPulldown.domNode,"chooseSchedPulldownCheck",false);$C.toggleClass(parent.scheduleBox.selectTimeBox.domNode,"selectTimeBoxCheck",false);}parent.positionDialog();if(bChecked){if(!rootController.dataService.emmaIRRMessageID){scheduleController.createEmmaIRRReportInstance(rootController.model.IRRid,null,callback);return ;}if(!statusList.hasIRR){statusList.set("hasIRR",true);}scheduleController.setAdvMode(true);scheduleController.setAdvState(true);}else{scheduleController.setAdvState(false);}}},{scriptClass:"mstrmojo.DI.DITableStatusList",alias:"statusList",bindings:{model:"this.parent.model",forceFullPublish:"(!this.parent.model.isCubePublished || !this.parent.model.rawDataExistsInAE)",bHasRefreshPolicy:function(){return this.parent.model.operationMode===constants.operationMode.refresh||this.parent.model.operationMode===constants.operationMode.subscribe||this.parent.model.operationMode===constants.operationMode.edit;},visible:"!this.parent.simpleProgressMode",editorZIndex:"this.parent.zIndex"}},{scriptClass:"mstrmojo.Box",cssClass:"cf scheduleBox",alias:"scheduleBox",bindings:{visible:function(){return(this.parent.model.operationMode===constants.operationMode.subscribe)&&!this.parent.simpleProgressMode;}},children:[{scriptClass:"mstrmojo.Label",cssClass:"text",text:mstrmojo.desc(3464,"Schedule:")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"chooseSchedPulldown",isHostedWithin:false,cssClass:"chooseSchedPulldown",hostedCSSClass:"mstrmojo-di-republishSchedule-chooseSched-hosted",popupToBody:true,popupZIndex:999,defaultSelection:-1,itemIdField:"id",itemField:"n",value:mstrmojo.desc(15097,"Choose a schedule template"),hasCustomSchedule:false,preBuildRendering:function(){var model=this.parent.parent.model,schedule=model&&model.getSchedule(),items=[{n:mstrmojo.desc(15098,"Custom Schedule..."),id:0}];if(schedule){var availableTrgs=mstrmojo.hash.clone(schedule.availableTriggers);if(availableTrgs.length>0){items=items.concat([{cls:"separator"}],availableTrgs);}}this.set("items",items);},postselectedIndexChange:function(evt){var parent=this.parent.parent,model=parent.model,schedule=model&&model.getSchedule(),$D=mstrmojo.date,$L=mstrmojo.locales,now,dateJson,dateStr,timeStr,idx,nameBox=parent.secondBox.nameBox;if(!model){return ;}idx=evt.value;if(idx===0){this.set("hasCustomSchedule",true);onCustomSchedule.call(this.parent.selectTimeBox.selectTimePulldown);}else{if(idx>0){this.set("hasCustomSchedule",false);schedule.set("curTrg",this.items[idx]);schedule.set("trgName",this.items[idx].n);if(!schedule.subsID){now=new Date();dateJson=$D.getDateJson(now);dateStr=$D.formatDateInfo(dateJson,$L.datetime.DATEDISPLAYFORMAT);timeStr=$D.formatTimeInfo(dateJson,$L.datetime.TIMEDISPLAYFORMAT);var name=model.cubeName+" "+schedule.trgName+" "+dateStr+" "+timeStr;nameBox.set("sugName",name);schedule.set("subsName",name);}}}notifyDialogResized(parent);if(!nameBox.enabled){nameBox.set("enabled",true);}}},{scriptClass:"mstrmojo.Box",cssClass:"selectTimeBox",alias:"selectTimeBox",bindings:{visible:"this.parent.chooseSchedPulldown.hasCustomSchedule"},children:[{scriptClass:"mstrmojo.ui.Pulldown",alias:"selectTimePulldown",cssClass:"selectTimePulldown",stp:constants.schedule.WEEKLY,wday:"0",mday:"1",time:"8:00AM",items:[{n:mstrmojo.desc(10639,"Daily"),v:constants.schedule.DAILY},{n:mstrmojo.desc(10159,"Weekday"),v:constants.schedule.WEEKDAY},{n:mstrmojo.desc(9705,"Weekly"),v:constants.schedule.WEEKLY},{n:mstrmojo.desc(9704,"Monthly"),v:constants.schedule.MONTHLY}],value:mstrmojo.desc(9705,"Weekly"),onLabel:true,wtime:true,postselectedIndexChange:function(evt){var idx=evt.value;this.set("stp",this.items[idx].v);switch(idx){case SCHS_DAILY:timeConfig.call(this,1);break;case SCHS_WEEKDAY:timeConfig.call(this,1);break;case SCHS_WEEKLY:timeConfig.call(this,2);break;case SCHS_MONTHLY:timeConfig.call(this,4);break;}onCustomSchedule.call(this);}},{scriptClass:"mstrmojo.Label",alias:"onLabel",text:mstrmojo.desc(15099,"on"),bindings:{visible:"this.parent.selectTimePulldown.onLabel"}},{scriptClass:"mstrmojo.ui.Pulldown",alias:"wtime",cssClass:"mday",items:constants.weekDay,value:mstrmojo.desc(9380,"Monday"),bindings:{visible:"this.parent.selectTimePulldown.wtime"},preBuildRendering:function(){var idx=$A.find(this.items,this.itemIdField,this.parent.selectTimePulldown.wday);if(idx>=0){this.set("selectedIndex",idx);}},itemIdField:"v",postselectedIndexChange:function(evt){var item=this.items[evt.value];this.parent.parent.set("wday",item.v);onCustomSchedule.call(this);}},{scriptClass:"mstrmojo.ui.Pulldown",alias:"mday",cssClass:"mday",items:constants.dateMon,value:"1st",bindings:{visible:"this.parent.selectTimePulldown.mtime"},preBuildRendering:function(){var idx=$A.find(this.items,this.itemIdField,this.parent.selectTimePulldown.mday);if(idx>=0){this.set("selectedIndex",idx);}},itemIdField:"v",postselectedIndexChange:function(evt){var item=this.items[evt.value];this.parent.parent.set("mday",item.v);onCustomSchedule.call(this);}},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(5923,"at")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"time",cssClass:"time",items:constants.timeOfDay,value:"8:00AM",preBuildRendering:function(){var idx=$A.find(this.items,this.itemIdField,this.parent.selectTimePulldown.time);if(idx>=0){this.set("selectedIndex",idx);}},itemIdField:"v",postselectedIndexChange:function(evt){var item=this.items[evt.value];this.parent.parent.set("time",item.v);onCustomSchedule.call(this);}}]}]},{scriptClass:"mstrmojo.Box",cssClass:"cf secondBox",alias:"secondBox",bindings:{visible:function(){return(this.parent.model.operationMode===constants.operationMode.subscribe)&&!this.parent.simpleProgressMode;}},children:[{scriptClass:"mstrmojo.Label",cssClass:"text",text:mstrmojo.desc(12769,"Schedule Name:")},{scriptClass:"mstrmojo.DI.DNTextBox",cssClass:"inputName",alias:"nameBox",maxInput:250,userInput:false,sugName:"",enabled:false,valid:false,onvalueChange:function(){var model=this.parent.parent.model,schedule=model&&model.getSchedule();if(schedule){if(!this.userInput){this.set("userInput",schedule.subsName!==this.value?true:false);}schedule.set("subsName",this.value);}},onvalidChange:function(){var editor=$H.walk("parent.parent",this);if(typeof editor==="undefined"){return ;}$C.toggleClass(editor.okButton.domNode,"emphasizeDisabled",!this.valid);editor.set("canSaveScheduleJudgedByNameBox",this.valid);editor.toggleEnable(editor.canSaveScheduleJudgedByNameBox&&editor.canRefreshJudgedByTableStatusList);},postBuildRendering:function(){var model=this.parent.parent.model,schedule=model&&model.getSchedule();this.update();if(schedule){schedule.attachEventListener("subsNameChange",this.id,"update");}},update:function(){var model=this.parent.parent.model,schedule=model&&model.getSchedule();if(schedule){if(!this.userInput){this.set("value",schedule.subsName||"");}else{if(schedule.subsName!==""&&this.value===""){this.set("value",this.sugName);}}}}}]},{slot:"buttonNode",scriptClass:"mstrmojo.CheckBox",alias:"advanceOpsCheckbox",cssClass:"advanceOpsCheckbox",label:mstrmojo.desc(13274,"Refresh data now"),postBuildRendering:function(){var model=this.parent.model,schedule=model&&model.getSchedule();this.update();if(schedule){schedule.attachEventListener("trgNameChange",this.id,"update");schedule.attachEventListener("isSendNowChange",this.id,"update");}},update:function(){var model=this.parent.model,schedule=model&&model.getSchedule();if(model){this.set("visible",model.operationMode===constants.operationMode.subscribe&&mstrApp.diParams.canSendNow);this.set("enabled",!!schedule.trgName);this.set("checked",schedule.isSendNow);}},oncheckedChange:function(){var model=this.parent.model,checked=this.checked;if(model){model.getSchedule().set("isSendNow",checked);}}},{slot:"buttonNode",alias:"cancelButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton",text:mstrmojo.desc(221,"Cancel"),onclick:function(){var editor=this.parent;editor.close();},postBuildRendering:function(){var model=this.parent.model;model.attachEventListener("PublishStatusUpdate",this.id,"update");},update:function(evt){if(evt&&evt.name&&!evt.completed&&!evt.hasError){this.set("enabled",false);}if(evt&&evt.reset){this.set("enabled",true);}},bindings:{visible:function(){return(mstrApp.getRootController().model.operationMode!==constants.operationMode.create&&!this.parent.simpleProgressMode);}}},{slot:"buttonNode",alias:"okButton",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton hot",text:mstrmojo.desc(1302,"Finish"),useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT},postBuildRendering:function(){this.richTooltip.refNode=this.domNode;this.attachEventListener("renderComplete",this.id,this.onuseRichTooltipChange);},postCreate:function postCreate(){var me=this,editor=this.parent,evtConfig={},listConfig=evtConfig[this.id]={};var evtHandler=function(evt){var model=me.parent.model,operationMode=model.operationMode,schedule=model.getSchedule(),selectedSchedule=schedule&&schedule.trgName;editor.set("canRefreshJudgedByTableStatusList",evt.value);if(operationMode===constants.operationMode.subscribe&&selectedSchedule){me.set("enabled",editor.canRefreshJudgedByTableStatusList&&editor.canSaveScheduleJudgedByNameBox);me.parent.resetOKButtonText();me.richTooltip.content=evt.value?"":DISABLED_BUTTON_TOOLTIP;}else{if(operationMode===constants.operationMode.refresh||operationMode===constants.operationMode.edit){me.set("enabled",editor.canRefreshJudgedByTableStatusList);me.parent.resetOKButtonText();me.richTooltip.content=evt.value?"":DISABLED_BUTTON_TOOLTIP;}else{if(operationMode===constants.operationMode.subscribe&&!selectedSchedule){me.set("enabled",false);}}}};listConfig[EVENT_CAN_SAVE_SCHEDULE]=evtHandler;listConfig[EVENT_CAN_START_REFRESH]=evtHandler;mstrApp.getRootController().attachDataChangeListeners(evtConfig);},onclick:function(){var rootCtrl=mstrApp.getRootController(),model=this.parent.model;if(isFileTypeUnsupportChanged(model.importSources)){rootCtrl.displayError(mstrmojo.desc(12509,"Switching the file type is not allowed during republishing or editing the cube."),false);return ;}var shouldValidateSecurityFilter=model.isManagedCube===false&&model.operationMode===constants.operationMode.refresh&&(model.writable===0||model.copyable===0);if(shouldValidateSecurityFilter){var changedSources=isSourceChanged(model),hasChanged=changedSources||(model.isDirectDataAccess!==model.origIsDirectDataAccess);if(hasChanged){rootCtrl.displayError(mstrmojo.desc(16017,"You need write access to cube # to the operation, because the cube have security filter or shared attribute associated.").replace("#",model.cubeName),false);return ;}}if(model.operationMode===constants.operationMode.subscribe){rootCtrl.getScheduleController().createSchedule();this.parent.toggleEnable(false);this.parent.okButton.set("text",mstrmojo.desc(15104,"Scheduling..."));$C.addClass(window.document.body,"invisible-wait");this.parent.statusBusy.set("visible",true);this.parent.updateSchsStatus(false);rootCtrl.raiseModelEvent({name:"PublishStatusUpdate",completed:false});this.parent.isSendNow=this.parent.model.getSchedule().isSendNow;}if(model.operationMode===constants.operationMode.refresh){this.parent.toggleEnable(false);this.parent.okButton.set("text",mstrmojo.desc(15079,"Refreshing..."));this.parent.statusBox.statusText.set("visible",true);$C.addClass(window.document.body,"invisible-wait");rootCtrl.saveAndPublish();}if(model.operationMode===constants.operationMode.edit){this.parent.toggleEnable(false);rootCtrl.getPublishController().startSaveAndPublish();}},bindings:{visible:function(){return(mstrApp.getRootController().model.operationMode!==constants.operationMode.create&&!this.parent.simpleProgressMode);}}},{slot:"buttonNode",alias:"sendToHistoryList",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton sendToHistory",text:mstrmojo.desc(4364,"Send to History List"),useRichTooltip:true,richTooltip:{cssClass:"vi-regular vi-tooltip-V",posType:mstrmojo.tooltip.POS_BOTTOMLEFT},onclick:function(){mstrApp.getRootController().getPublishController().sendToHistoryList();},postBuildRendering:function(){this.richTooltip.refNode=this.domNode;this.attachEventListener("renderComplete",this.id,this.onuseRichTooltipChange);},postCreate:function postCreate(){var me=this,evtConfig={},listConfig=evtConfig[this.id]={};var evtHandler=function(evt){var model=me.parent.model,operationMode=model.operationMode;if(operationMode===constants.operationMode.refresh||operationMode===constants.operationMode.edit){me.set("enabled",evt.value);me.richTooltip.content=evt.value?"":DISABLED_BUTTON_TOOLTIP;}};listConfig[EVENT_CAN_START_REFRESH]=evtHandler;mstrApp.getRootController().attachDataChangeListeners(evtConfig);},bindings:{visible:function(){return(!$DIHelper.isWS()&&mstrApp.getRootController().model.operationMode!==constants.operationMode.subscribe&&!mstrApp.isSingleTier&&!mstrApp.getRootController().model.analysisID&&!mstrApp.refreshMultipleCubes);}}},{scriptClass:"mstrmojo.Box",slot:"buttonNode",alias:"statusBox",children:[{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(15105,"Loading data..."),alias:"statusText",cssClass:"republish-status-text",visible:false}]},{scriptClass:"mstrmojo.Label",slot:"buttonNode",alias:"statusBusy",cssClass:"schedule-status-busy",visible:false}]});}());