(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.rw.selectors.Slider","mstrmojo.vi.ui.rw.selectors.SliderHelper","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.MapUtils","mstrmojo.hash","mstrmojo.dom","mstrmojo.tooltip","mstrmojo.css","mstrmojo.ui.menus.MenuConfig","mstrmojo.ui.menus._HasMenuPopup","mstrmojo.VisUtility");var $HASH=mstrmojo.hash,$D=mstrmojo.dom,$C=mstrmojo.css,$GMAPS=mstrmojo.gmaps,$MUTIL=$GMAPS.MapUtils,$EnumPropertyType=$GMAPS.EnumPropertyType,$VISUTIL=mstrmojo.VisUtility;mstrmojo.mapbox.ui.selectors.LayerZoomSlider=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.Slider,[mstrmojo.ui.menus._HasMenuPopup],{scriptClass:"mstrmojo.mapbox.ui.selectors.LayerZoomSlider",thumbWidth:3,cssBkBW:0,sliderDefaultWidth:140,multiSelect:true,markupString:'<div class="mstrmojo-VISlider mstrmojo-Slider {@cssClass} {@clsOrientation}" style="{@cssText}"><div class="sl-title"></div><div class="sl-control"></div><div class="cont" style="position:relative"><div class="bk" style="{@bkCssText}"></div><div class="sdc" style="position:absolute;{@sdcCssText}"><div class="sd" style="{@sdCssText}" mstrAttach:click><div class="bk left" style="{@lowerRangeCssText}"></div><div class="t1 {@handle1Exlcude}" style="{@handle1CssText}" mstrAttach:mouseout></div><div class="bk middle" style="{@thumbCssText}"></div><div class="t3 {@handle2Exlcude}" style="{@handel2CssText}" mstrAttach:mouseout></div><div class="bk right" style="{@upperRangeCssText}"></div></div></div><div class="mstrmojo-Label subscript left">{@lowText}</div><div class="mstrmojo-Label subscript right">{@highText}</div></div></div>',markupSlots:{titleNode:function(){return this.domNode.firstChild;},controlNode:function(){return this.domNode.childNodes[1];},dndNode:function(){return this.domNode.childNodes[2];},bgNode:function(){return this.domNode.childNodes[2].firstChild;},sdcNode:function(){return this.domNode.childNodes[2].childNodes[1];},containerNode:function(){return this.domNode.childNodes[2].childNodes[1].firstChild;},lowerRange:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.firstChild;},handle1Node:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[1];},thumbNode:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[2];},handle2Node:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[3];},upperRange:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.lastChild;},lowNode:function(){return this.domNode.childNodes[2].childNodes[2];},highNode:function(){return this.domNode.childNodes[2].childNodes[3];},tooltipNode:function(){return[this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[0],this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[1],this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[2],this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[3],this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[4]];}},init:function init(p){p=$HASH.copy(p,{isHoriz:true,cssClass:"mapbox_layer_zoom_slider"});if(!p.layer){throw new Error(this.scriptClass+"must be initialized with a graphic layer.");}if(!p.items||!p.getIndexByValue){throw new Error(this.scriptClass+"must be initialized with items and getIndexByValue function.");}var layer=p.layer,minLayerZoomLvl=layer.getLayerProp($EnumPropertyType.minLayerZoomLvl),maxLayerZoomLvl=layer.getLayerProp($EnumPropertyType.maxLayerZoomLvl),maxZoomIndex,minZoomIndex;p.minLayerZoomLvl=!$MUTIL.checkDefined(minLayerZoomLvl)?p.minZoom:parseFloat(minLayerZoomLvl);p.maxLayerZoomLvl=!$MUTIL.checkDefined(maxLayerZoomLvl)?p.maxZoom:parseFloat(maxLayerZoomLvl);maxZoomIndex=p.getIndexByValue(p.maxLayerZoomLvl);minZoomIndex=p.getIndexByValue(p.minLayerZoomLvl);p.selectedIndices={};p.selectedIndices[maxZoomIndex]=true;p.selectedIndices[minZoomIndex]=true;this._super(p);},updateTypeHelper:function updateTypeHelper(){var Cls=$HASH.walk("mapbox.ui.selectors.LayerSliderHelper",mstrmojo);this.typeHelper=new Cls({slider:this});},positionLayerName:function positionLayerName(){if(!this.hasRendered){return ;}var layer=this.layer,layerName=layer&&layer.getLayerName(),style=$C.getComputedStyle(this.thumbNode),fontStyle={fontFamily:style.fontFamily,fontSize:style.fontSize,fontStyle:style.fontStyle,fontWeight:style.fontWeight},padding=parseFloat(style.paddingLeft)+parseFloat(style.paddingRight),layerNameWidth=$VISUTIL.measureTextWidth(layerName,fontStyle,padding);this.thumbNode.innerText="";this.upperRange.innerText="";this.lowerRange.innerText="";if(layerNameWidth<=this.thumbNode.offsetWidth){this.layerNameNode=this.thumbNode;}else{if(layerNameWidth<=this.upperRange.offsetWidth){this.layerNameNode=this.upperRange;}else{if(layerNameWidth<=this.lowerRange.offsetWidth){this.layerNameNode=this.lowerRange;}else{this.layerNameNode=this.thumbNode;}}}this.layerNameNode.innerText=layerName;this.layerNameWidth=layerNameWidth;this.layerName=layerName;},synchronizeSlider:function synchronizeSlider(){this._super();this.positionLayerName();},onselectionChange:function onselectionChange(){this._super();this.parent.onLayerSelectionChange(this);},initDrag:function initDrag(e,hWin){if(this.enabled){this._super(e,hWin);}},_updateTooltip:function _updateTooltip(e,win){var tgt=$D.eventTarget(win,e),txt,posType,tooltipClass,left,top,txtMarkup='<div class="name">{@content}</div>',tooltip,showTooltip=false;posType=mstrmojo.tooltip.POS_BOTTOMLEFT;tooltipClass="vi-tooltip-V ";top=0;left=-7;switch(tgt){case this.handle1Node:txt=String(this.cs1Nm).replace("$","$$$$");showTooltip=true;break;case this.handle2Node:txt=String(this.cs2Nm).replace("$","$$$$");showTooltip=true;if(parseFloat(txt)<1.5){txtMarkup='<div class="name" style="font-weight: bold">'+mstrmojo.desc(15861,"## is not a safe level to stop showing layer.").replace("##","{@content}")+'</div><div class="dsc">'+mstrmojo.desc(15862,"You might never see this layer under certain screen resolution.")+"</div>";}break;case this.lowerRange:case this.thumbNode:case this.upperRange:if(this.layerNameWidth>this.layerNameNode.offsetWidth){txt=this.layerName;showTooltip=true;left=0;}break;default:break;}if(showTooltip&&this.enabled){tooltip={cssClass:"mstrmojo-VISlider vi-regular "+tooltipClass+mstrApp.getThemeClassName(),content:txtMarkup.replace(/\{@content\}/g,txt),contentNodeCssClass:"scm-tooltip",refNode:tgt,posType:posType,left:left,top:top};}else{tooltip=null;}this.set("richTooltip",tooltip);},destroy:function dst(skipCleanup){delete this.layer;this._super(skipCleanup);}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.mapbox.ui.selectors.LayerZoomSlider,{onenabledChange:function(){$C.toggleClass(this.handle1Node,"enable",this.enabled);$C.toggleClass(this.handle2Node,"enable",this.enabled);}});mstrmojo.mapbox.ui.selectors.LayerSliderHelper=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.SliderHelper,null,{scriptClass:" mstrmojo.mapbox.ui.selectors.LayerSliderHelper",updateSummary:function updateSummary(){},initialSlider:function initialSlider(){var sl=this.slider;this._super();sl.min=sl.cs1Idx;sl.max=sl.cs2Idx;}});}());