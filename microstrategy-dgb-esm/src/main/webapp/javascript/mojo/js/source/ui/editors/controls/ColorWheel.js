(function(){mstrmojo.requiresCls("mstrmojo.Widget","mstrmojo.color","mstrmojo.dom");var $COLOR=mstrmojo.color,$DOM=mstrmojo.dom;var hueRadius=68.5,widgetCenterPoint=77.5,slSize=83;function getMouseOffsetFromCenter(htmlEvent,widgetPosition){return{x:htmlEvent.clientX-widgetPosition.x-widgetCenterPoint,y:htmlEvent.clientY-widgetPosition.y-widgetCenterPoint};}function updateSlHandle(){var saturation=this._hsl[1],lightness=this._hsl[2];var slHandleNode=this.slHandleNode.style;slHandleNode.left=Math.round(slSize*(0.5-saturation)+widgetCenterPoint)+"px";slHandleNode.top=Math.round(slSize*(0.5-lightness)+widgetCenterPoint)+"px";}function updateHueHandle(){var hue=this._hsl[0],hueAngle=hue*2*Math.PI;var hueHandleNodeStyle=this.hueHandleNode.style;hueHandleNodeStyle.left=Math.round(Math.sin(hueAngle)*hueRadius+widgetCenterPoint)+"px";hueHandleNodeStyle.top=Math.round(-Math.cos(hueAngle)*hueRadius+widgetCenterPoint)+"px";this.slNode.style.backgroundColor=$COLOR.hsl2hex(hue,1,0.5);}function updateHandles(){this._hsl=$COLOR.hex2hsl(this.color);if(this.slHandleNode&&this.hueHandleNode){updateSlHandle.call(this);updateHueHandle.call(this);}}mstrmojo.ui.editors.controls.ColorWheel=mstrmojo.declare(mstrmojo.Widget,null,{scriptClass:"mstrmojo.ui.editors.controls.ColorWheel",markupString:'<div id="{@id}" class="mstrmojo-ui-ColorWheel {@cssClass}" style="{@cssText}" mstrAttach:mousedown><div class="cwHue"></div><div class="cwColorField"></div><div class="cwHandle"><div></div></div><div class="cwHandle"><div></div></div></div>',markupSlots:{slNode:function(){return this.domNode.childNodes[1];},hueHandleNode:function(){return this.domNode.childNodes[2];},slHandleNode:function(){return this.domNode.lastChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},slNode:null,hueHandleNode:null,slHandleNode:null,color:"#ffffff",onColorPicked:function onColorPicked(color){},postBuildRendering:function postBuildRendering(){updateHandles.call(this);},oncolorChange:function oncolorChange(){updateHandles.call(this);},onmousedown:function onmousedown(evt){var wheel=this,widgetPosition=$DOM.position(this.domNode),currentHSL=this._hsl,htmlEvent=evt.e,initialOffset=getMouseOffsetFromCenter(htmlEvent,widgetPosition),isHueDrag=Math.max(Math.abs(initialOffset.x),Math.abs(initialOffset.y))*2>slSize,fnMouseMove=function(mouseEvt){var moveOffset=getMouseOffsetFromCenter(mouseEvt,widgetPosition),hue=currentHSL[0],saturation=currentHSL[1],lightness=currentHSL[2];if(isHueDrag){hue=Math.atan2(moveOffset.x,-moveOffset.y)/(2*Math.PI);if(hue<0){hue+=1;}wheel._hsl=[hue,saturation,lightness];updateHueHandle.call(wheel);}else{saturation=Math.max(0,Math.min(1,-(moveOffset.x/slSize)+0.5));lightness=Math.max(0,Math.min(1,-(moveOffset.y/slSize)+0.5));wheel._hsl=[hue,saturation,lightness];updateSlHandle.call(wheel);}var color=$COLOR.hsl2hex(hue,saturation,lightness);wheel.color=color;wheel.onColorPicked(color);$DOM.stopPropogation(window,mouseEvt);return false;};$DOM.attachMouseMoveEvents(fnMouseMove);fnMouseMove(htmlEvent);}});}());