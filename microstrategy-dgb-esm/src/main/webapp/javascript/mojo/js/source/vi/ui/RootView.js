(function(){mstrmojo.requiresCls("mstrmojo.vi._MonitorsAppState","mstrmojo.Container","mstrmojo._FillsBrowser","mstrmojo._HasLayout","mstrmojo.ui._HasUITheme","mstrmojo.util.ThemeHelper","mstrmojo.ui.pathbar.PathBar","mstrmojo.css","mstrmojo.array","mstrmojo.PerformanceLogOutput","mstrmojo.vi.controllers.EnumEvents","mstrmojo.vi.models.PanelFormatSaver","mstrmojo.vi.enums.EnumThemeProperties","mstrmojo.vi.enums.EnumHiddenSections");var $CSS=mstrmojo.css,$DOM=mstrmojo.dom,$H=mstrmojo.hash,$ARR=mstrmojo.array,PATH_BAR_HEIGHT="42px",MIN_WIDTH=610,$HIDSEC=mstrmojo.vi.enums.EnumHiddenSections,$PerfLog=mstrmojo.PerformanceLogOutput,$VI_MODELS=mstrmojo.vi.models,EVENTS=mstrmojo.vi.controllers.EnumEvents,CSS_CLASS_PAUSE="pause",$ENUM_THEME_PROPS=mstrmojo.vi.enums.EnumThemeProperties,ThemeHelper=mstrmojo.util.ThemeHelper;var ENUM_LAYOUT_THEME=$ENUM_THEME_PROPS.ENUM_LAYOUT_THEME,getThemeProps=ThemeHelper.getThemePropConfig;function contextMenuCheck(evt){var target=$DOM.eventTarget(window,evt),tagName;if(target&&target.tagName){tagName=target.tagName.toLowerCase();}if(tagName!=="input"&&tagName!=="textarea"&&target.contentEditable!=="true"&&!mstrmojo.debugBundles){$DOM.preventDefault(window,evt);return false;}}function animatePathbar(pathbarNode,startTop,endTop,delay){pathbarNode.style.height=PATH_BAR_HEIGHT;window.setTimeout(function(){pathbarNode.style.top=startTop;window.setTimeout(function(){pathbarNode.style.top=endTop;},0);},delay||0);}mstrmojo.vi.ui.RootView=mstrmojo.declare(mstrmojo.Container,[mstrmojo._FillsBrowser,mstrmojo._HasLayout,mstrmojo.vi._MonitorsAppState,mstrmojo.ui._HasUITheme],{scriptClass:"mstrmojo.vi.ui.RootView",markupString:'<div id="{@id}" class="mstrmojo-RootView {@cssClass}" style="{@cssText}" mstrAttach:click><div class="mstrmojo-RootView-pathbar"></div><div class="mstrmojo-RootView-menutoolbar {@cssClassToolbar}"><div class="mstrmojo-RootView-menubar"></div><div class="mstrmojo-RootView-toolbar"></div></div><div><div class="mstrmojo-RootView-datasets"></div><div class="mstrmojo-RootView-content"></div><div class="mstrmojo-RootView-gallery"></div></div><div id="canvasOverlay"></div><div id="annotate_tools"></div></div>',markupSlots:{pathbarNode:function(){return this.domNode.firstChild;},menuToolbarNode:function(){return this.domNode.childNodes[1];},menubarNode:function(){return this.domNode.childNodes[1].childNodes[0];},toolbarNode:function(){return this.domNode.childNodes[1].childNodes[1];},contentNode:function(){return this.domNode.childNodes[2];},datasetsNode:function(){return this.domNode.childNodes[2].childNodes[0];},containerNode:function(){return this.domNode.childNodes[2].childNodes[1];},galleryNode:function(){return this.domNode.childNodes[2].lastChild;},annotationsOverlayNode:function(){return this.domNode.childNodes[3];},annotationsToolbarNode:function(){return this.domNode.childNodes[4];}},markupMethods:{onheightChange:mstrmojo.Widget.heightMarkupMethod,onwidthChange:mstrmojo.Widget.widthMarkupMethod},menutoolbarHeight:"41px",themeClassName:"mojo-theme-light",themeProps:$ENUM_THEME_PROPS.CLASSIC_THEME_PROPS,onthemeClassNameChange:function onthemeClassNameChange(evt){this._super(evt);document.body.setAttribute("appThemeClass",this.themeClassName);},onlayoutStyleChange:function onlayoutStyleChange(evt){if(this._super){this._super(evt);}$CSS.toggleClass(this.domNode,"card",evt.value===$ENUM_THEME_PROPS.ENUM_LAYOUT_STYLE.CARD);},onlayoutThemeChange:function onlayoutThemeChange(evt){if(this._super){this._super(evt);}this.themeProps=getThemeProps({layoutTheme:this.layoutTheme});$CSS.toggleClass(this.domNode,ENUM_LAYOUT_THEME.DEFAULT,this.layoutTheme===ENUM_LAYOUT_THEME.DEFAULT);},datasetObjectsPanel:null,isCPVisible:true,setIsCPVisible:function setIsCPVisible(visible,noSave){if(this.isCPVisible===visible){return ;}this.isCPVisible=visible;if(!noSave){var panelSaver=this.getPanelSaver();if(panelSaver){panelSaver.saveProperty("visible",visible);}}this.raiseEvent({name:EVENTS.CONTENTS_PANEL_VISIBILITY_CHANGE,visible:visible});},getPanelSaver:function(){var rootCtrl=this.controller,docCtrl=rootCtrl.docCtrl,model=docCtrl.model;return $VI_MODELS.PanelFormatSaver.getPanelSaver(model,{visible:{set:"FormattingAnalysis",name:"TOCVisible"}});},init:function init(props){this._super(props);this.layoutConfig={h:{pathbarNode:"0px",menuToolbarNode:this.menutoolbarHeight,datasetsNode:"100%",containerNode:"100%",galleryNode:"100%"},w:{pathbarNode:"all",menuToolbarNode:"all",datasetsNode:"auto",containerNode:"100%",galleryNode:"auto"},xt:true};var pathInfo=mstrApp.pathInfo,controller=this.controller;if(pathInfo){this.setPathbar(new mstrmojo.ui.pathbar.PathBar({pathInfo:pathInfo,visible:false}));}if(mstrApp.menubarModelData){controller.menubar=this.setMenubar(new mstrmojo.vi.ui.toolbars.RootToolbar({ignoreLayout:true}));}if(mstrApp.tbModelData){controller.toolbar=this.setToolbar(new mstrmojo.vi.ui.toolbars.RootToolbar({useRichTooltip:true,ignoreLayout:true}));}if(mstrApp.isSectionHidden($HIDSEC.DOCKTOP)){this.cssClassToolbar="hidden";this.layoutConfig.h.menuToolbarNode="0px";}var cssClass=this.cssClass&&this.cssClass.split(" ")||[];$ARR.removeItem(cssClass,CSS_CLASS_PAUSE);if(mstrApp.isAppStatePause()){$ARR.insert(cssClass,null,CSS_CLASS_PAUSE);}this.cssClass=cssClass.join(" ");$DOM.attachEvent(window.document.body,"contextmenu",contextMenuCheck,false);},destroy:function destroy(){$DOM.detachEvent(window.document.body,"contextmenu",contextMenuCheck);this._super();},onAppStateChange:function onAppStateChange(evt){var appStates=mstrmojo.vi.VisualInsightApp.APP_STATES,presentationMode=appStates.PRESENTATION,pauseMode=appStates.PAUSE,isPresentationMode=mstrApp.isAppStatePresentation(),isPauseMode=mstrApp.isAppStatePause(),domNode=this.domNode,clsPresentation="presentation",isSelectionMode=mstrApp.isAppStateSelection(),clsSelection="selection";var wasPauseMode=!!(evt.valueWas&pauseMode);if(isPauseMode!==wasPauseMode){$CSS.toggleClass(domNode,CSS_CLASS_PAUSE,isPauseMode);}if(evt.value&presentationMode||evt.valueWas&presentationMode){if(isPresentationMode){$CSS.addClass(domNode,clsPresentation);if(mstrApp.enhancedPrensetation&&!mstrApp.isShare){$CSS.addClass(domNode,"enhanced");}var pathbar=this.pathbar;if(pathbar&&pathbar.visible){this.togglePathbar(true);}}if(!isPresentationMode){$CSS.removeClass(domNode,clsPresentation);}}$CSS.toggleClass(domNode,clsSelection,isSelectionMode);},addView:function addView(view,slot,alias,noReplace){var oldView=this[alias];if(oldView){if(noReplace){throw new Error("RootView: Cannot replace "+view.scriptClass+".");}this.removeChildren(oldView);}view.slot=slot;view.alias=alias;var timerid_buildClass=$PerfLog.startTimer({functionName:"RootView.buildChildren: "+alias,purpose:"build class"});this.addChildren([view]);$PerfLog.endTimer(timerid_buildClass);$PerfLog.startTimer({functionName:"RootView.addView: ",purpose:"time gap between build document and buildMap"},"timerid_callback_buildMap");return view;},setPathbar:function setPathbar(pathbar){return this.addView(pathbar,"pathbarNode","pathbar");},setMenubar:function setMenubar(menubar){return this.addView(menubar,"menubarNode","menubar");},setToolbar:function setToolbar(toolbar){return this.addView(toolbar,"toolbarNode","toolbar");},setDatasetObjectsPanel:function setDatasetObjectsPanel(panel){this.addView(panel,"datasetsNode","datasetObjectsPanel",true);this.doLayout();},setDocumentView:function setDocumentView(documentView){var containerNode=this.containerNode;documentView.height=containerNode.offsetHeight+"px";documentView.width=containerNode.offsetWidth+"px";return this.addView(documentView,"containerNode","documentView",true);},setGalleryView:function setGalleryView(gallery){var view=this.addView(gallery,"galleryNode","visGalleryView",true);this.doLayout();return view;},toggleFilterPanel:function toggleFilterPanel(){var rootController=this.controller,docController=rootController.docCtrl,filterPanel=docController.getViPanel("filterPanel"),isPresentationMode=mstrApp.isAppStatePresentation();if(filterPanel){var isVisible=filterPanel.getOpenStatus();var update=docController.model.getDataService().newUpdateWithoutCmd();update.addExtras(mstrmojo.DocDataService.SUPPRESS_DATA);filterPanel.setOpenStatus(!isVisible,false,update,true);var actions=update.actions;if(actions&&actions.length&&!isPresentationMode){update.submit();}}else{docController.openViPanel("filterPanel",undefined,isPresentationMode);}},toggleMenuToolbar:function toggleMenuToolbar(skipReLayout){if(!this.menubar&&!this.toolbar){return ;}var showMenuToolbar=!this.menubar.visible,rootView=this,menuToolbarNode=rootView.menuToolbarNode;this.menubar.set("visible",showMenuToolbar);this.toolbar.set("visible",showMenuToolbar);this.layoutConfig.h.menuToolbarNode=showMenuToolbar?this.menutoolbarHeight:"0px";if(!skipReLayout){rootView.doLayout();}if(!showMenuToolbar){menuToolbarNode.style.display="none";$CSS.addClass(menuToolbarNode,"printPreview");}else{menuToolbarNode.style.display="block";$CSS.removeClass(menuToolbarNode,"printPreview");}},togglePathbar:function togglePathbar(skipReLayout){if(!mstrApp.pathInfo){return ;}var showPathbar=!this.pathbar.visible,rootView=this,pathbarNode=rootView.pathbarNode,top="-"+PATH_BAR_HEIGHT,ANIMATION_TIME=700;$CSS.addClass(pathbarNode,"absolute");this.pathbar.set("visible",showPathbar);this.layoutConfig.h.pathbarNode=showPathbar?PATH_BAR_HEIGHT:"0px";if(showPathbar){animatePathbar(pathbarNode,top,"0px");if(!skipReLayout){window.setTimeout(function(){rootView.doLayout();},ANIMATION_TIME);}}else{if(!skipReLayout){rootView.doLayout();}animatePathbar(pathbarNode,"0px",top,200);window.setTimeout(function(){pathbarNode.style.height="0px";},ANIMATION_TIME);}window.setTimeout(function(){$CSS.removeClass(pathbarNode,"absolute");pathbarNode.style.top="";},ANIMATION_TIME);},getPathbarState:function getPathbarState(){return this.pathbar.visible;},showErrMsg:function showErrMsg(msg){if(msg){this.containerNode.innerHTML='<div class="errMsg">'+msg+"</div>";mstrmojo.css.addClass(this.containerNode,"errMsg");}},setDimensions:function setDimensions(h,w){return this._super(h,Math.max(parseInt(w,10),MIN_WIDTH)+"px");},monitorWindow:function monitorWindow(evt){var diApp=null,qbApp=null;if(mstrApp.isDI){diApp=mstrApp;window.mstrApp=mstrApp.launchingApp;}else{if(mstrApp.isQB){qbApp=mstrApp;window.mstrApp=$H.walk("container.launchingApp.launchingApp",mstrApp)||$H.walk("launchingApp.launchingApp",window);}}this._super(evt);if(diApp){window.mstrApp=diApp;}else{if(qbApp){window.mstrApp=qbApp;}}}});mstrmojo.vi.ui.RootView.getThemeProps=getThemeProps;}());