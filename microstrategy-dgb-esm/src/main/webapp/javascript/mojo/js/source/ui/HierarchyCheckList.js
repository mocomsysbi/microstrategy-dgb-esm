(function(){mstrmojo.requiresCls("mstrmojo.ui.CheckList","mstrmojo.ui._IsHierarchyList","mstrmojo.css","mstrmojo.array","mstrmojo.EnumSelectionType");var $CSS=mstrmojo.css,$ARR=mstrmojo.array,$SELECTION_TYPE=mstrmojo.EnumSelectionType;var CSS_HIDDEN="hidden",CSS_SELECTED="selected",CSS_EXPANDED="expanded",CSS_COLLAPSED="collapsed",CSS_HIERARCHY="hierarchy",CSS_HAS_CHILDREN="hasChildren";var ELEM_ALL_ID="u;",LEVEL_INDENT=10;mstrmojo.ui.HierarchyCheckList=mstrmojo.declare(mstrmojo.ui.CheckList,[mstrmojo.ui._IsHierarchyList],{scriptClass:"mstrmojo.ui.HierarchyCheckList",markupString:'<div id="{@id}" class="mstrmojo-ui-CheckList {@cssClass}" style="{@cssText}" mstrAttach:click,contextmenu><div class="header"></div><div class="scroll-container"><div class="{@icnCss}" style="{@icnCssText}">{@itemsHtml}</div></div><div class="footer"></div></div>',markupSlots:{headerNode:function headerNode(){return this.domNode.firstChild;},footerNode:function footerNode(){return this.domNode.lastChild;},scrollboxNode:function scrollboxNode(){return this.domNode.children[1];},itemsContainerNode:function itemsContainerNode(){return this.domNode.children[1].firstChild;}},getItemMarkup:function getItemMarkup(item,idx){return'<{@tag} class="item {@cls}" idx="{@idx}" style="{@style}" title="{@tt}"><span class="indent" style="padding-left: {@indent}px;"></span><span class="triangle"></span><span class="checkbox"></span><span class="text">{@en@n}</span></{@tag}>';},getItemProps:function getItemProps(item,idx){var props=this._super(item,idx);if(item.isSelected){props.addCls(CSS_SELECTED);}if(this.isHiearachyDisplay()){if(item.hcd){props.addCls(item.epd?CSS_EXPANDED:CSS_COLLAPSED);}}return props;},setupScrollNodes:function setupScrollNodes(){this.scrollNode=this.scrollboxNode;var scrollNodeHeight=this.domNode.clientHeight-this.headerNode.clientHeight-this.footerNode.clientHeight;if(scrollNodeHeight>0){this.scrollNode.style.height=scrollNodeHeight+"px";}},onclick:function onclick(evt){var target=evt.getTarget(),itemNode=this.getItemNodeFromTarget(target),item=this.getItemFromTarget(target);if(item){if($CSS.hasClass(target,"triangle")){if(item.hcd){this.doExpandCollapse(itemNode,item);}}else{if(!$CSS.hasClass(target,"indent")){this.doBranchSelect(itemNode,item,!item.isSelected);}}evt.cancel();}},doElementSelect:function doElementSelect(itemNode,item,isSelected){item.isSelected=isSelected;this.onSelectionChange($SELECTION_TYPE.ELEMENT,isSelected,item);this.updateItemNodesStatus();},doBranchSelect:function doBranchSelect(itemNode,item,isSelected){var branchSelect=function(item){item.isSelected=isSelected;item.isBranchSelected=isSelected;(item.children||[]).forEach(function(child){branchSelect(child);});};branchSelect(item);this.onSelectionChange($SELECTION_TYPE.BRANCH,isSelected,item);this.updateItemNodesStatus();},doLevelSelect:function doLevelSelect(level,isSelected){this.getItems().forEach(function(item){if(item.lv===level){item.isSelected=isSelected;}});this.onSelectionChange($SELECTION_TYPE.LEVEL,isSelected,null,level);this.updateItemNodesStatus();},doBranchLevelSelect:function doBranchLevelSelect(itemNode,item,level,isSelected){var branchLevelSelect=function(item){if(item.lv===level){item.isSelected=isSelected;}else{if(item.lv<level){(item.children||[]).forEach(function(child){branchLevelSelect(child);});}}};branchLevelSelect(item);this.onSelectionChange($SELECTION_TYPE.BRANCH_LEVEL,isSelected,item,level);this.updateItemNodesStatus();},doAllSelect:function doAllSelect(isSelected){this.getItems().forEach(function(item){item.isSelected=item.isBranchSelected=isSelected;});this.onSelectionChange($SELECTION_TYPE.ALL,isSelected);this.updateItemNodesStatus();},updateItemNodesStatus:function updateItemNodesStatus(){var itemNodes=this.itemsContainerNode&&this.itemsContainerNode.childNodes;$ARR.forEach(itemNodes,function(itemNode){var item=this.getItemFromTarget(itemNode);if(item){$CSS.toggleClass(itemNode,CSS_SELECTED,item.isSelected);}},this);},onSelectionChange:mstrmojo.emptyFn});}());