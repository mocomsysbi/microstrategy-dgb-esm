(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.dom","mstrmojo.array","mstrmojo.hash","mstrmojo.vi._MonitorsLayoutMode","mstrmojo.vi.models._CheckDataCards","mstrmojo.vi.models.EnumPanelTypes","mstrmojo.EnumRWUnitType");var $MOJO=mstrmojo,$HASH=$MOJO.hash,$DOM=$MOJO.dom,$ARR=$MOJO.array;var ENUM_LAYOUT_STYLE={RESERVED:0,CARD:1,BASIC:2};var DARK_THEME_ID="F1FED8AC42B57AC1B0E9518FED0F89D6";function getAllowItems(res){var currLayoutKey=res.currlaykey,layouts=$ARR.filter(res.data.layouts,function(lyt){return currLayoutKey===lyt.k;}),currentLayout=layouts[0],model=new mstrmojo.vi.models.DocModel(res),paneKey=model.getVIPanelKeyFromUnits(mstrmojo.vi.models.EnumPanelTypes.VISUALIZATION);var fnGetAllowItems=function(currentLayout,paneKey,model){var curr,panel,curObjArray=[],allowItem=[];var fnSearchCurrPanel=function(des){if(des.k===paneKey){curr=des;return ;}$ARR.forEach(model.extractChildren(des||{})||[],function(item){fnSearchCurrPanel(item);if(curr){return ;}});};var fnSearchTemplateUnits=function(des){if(des&&des.gts){curObjArray.push(des);return ;}$ARR.forEach(model.extractChildren(des)||[],function(item){fnSearchTemplateUnits(item);});};var fnSearchAttr=function(des,currPanelKey){if(des.k===currPanelKey){panel=des;return ;}$ARR.forEach(model.extractChildren(des)||[],function(item){fnSearchAttr(item,currPanelKey);if(panel){return ;}});};fnSearchCurrPanel(currentLayout);var currPanelKey=curr.selKey;fnSearchAttr(curr,currPanelKey);fnSearchTemplateUnits(panel);$ARR.forEach(curObjArray,function(curObjData){if(!curObjData){return ;}var titleUnits=((curObjData.gts&&curObjData.gts.row)||[]).concat((curObjData.gts&&curObjData.gts.col)||[]);mstrmojo.vi.models._CheckDataCards.addAttributeNameAndTargetVisForAddUnits(curObjData,titleUnits);allowItem=allowItem.concat(titleUnits);});return allowItem;};var allowItems=fnGetAllowItems.call(this,currentLayout,paneKey,model);var fnBuildTree=function(defn){var tree={},k;for(k in defn.units){var unit=defn.units[k],pnk=unit.pnk;if(pnk){var tnd=tree[pnk]=tree[pnk]||[];tnd[unit.chdidx]={key:k,type:unit.t,id:unit.srcid||""};}}return tree;},fnSearchTree=function(tree,node,type,srcId){if(node!==undefined){for(var i=0;i<node.length;i++){var nodeItem=node[i];if(nodeItem&&nodeItem.type&&nodeItem.type===type&&!!nodeItem.id){srcId[nodeItem.id]=true;}}}for(var idx=0;idx<node.length;idx++){var item=node[idx];if(item!==undefined&&tree[item.key]){fnSearchTree(tree,tree[item.key],type,srcId);}}return srcId;},tree=fnBuildTree.call(this,model.getCurrentLayoutDef()),hashAttrSrcId={};fnSearchTree.call(this,tree,tree[model.currlaykey],mstrmojo.EnumRWUnitType.SELECTOR,hashAttrSrcId);if(!$HASH.isEmpty(hashAttrSrcId)){allowItems=[];}model.destroy();return allowItems;}mstrmojo.vi.controllers.RootControllerBase=mstrmojo.declare(mstrmojo.Obj,[mstrmojo.vi._MonitorsLayoutMode],{scriptClass:"mstrmojo.vi.controllers.RootControllerBase",view:null,docCtrl:null,document:null,installedEventListeners:null,init:function init(props){this._super(props);this.installedEventListeners=[];},destroy:function destroy(ignoreDOM){this.installedEventListeners.forEach(function(h){$DOM.detachEvent(window.document,h.evt,h.fn);});this._super(ignoreDOM);mstrmojo.css.removeClass(window.document.body,"workstation");delete this.document;delete this.view;delete this.docCtrl;},isDarkThemeSelected:function isDarkThemeSelected(){var docModel=this.docCtrl.model,themeId=docModel.thm?docModel.thm.did:"";return themeId===DARK_THEME_ID;},isDarkThemeEnabled:function isDarkThemeEnabled(){if(this.darkThemeEnabled===undefined){this.darkThemeEnabled=this.isDarkThemeSelected();}return this.darkThemeEnabled;},getAllowItems:getAllowItems});mstrmojo.vi.controllers.RootControllerBase.ENUM_LAYOUT_STYLE=ENUM_LAYOUT_STYLE;}());