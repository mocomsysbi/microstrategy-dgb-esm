(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.dom","mstrmojo.hash","mstrmojo.array","mstrmojo.qb.es.TableList","mstrmojo.Label");mstrmojo.requiresDescs(12930,2121,14909);var DRAG_ACTION_ADD_TABLE="addTable",$A=mstrmojo.array,$STR=mstrmojo.string,$H=mstrmojo.hash;mstrmojo.qb.es.TableDropbox=mstrmojo.declare(mstrmojo.Box,null,{scriptClass:"mstrmojo.qb.es.TableDropbox",markupString:'<div id="{@id}" class="mstrmojo-qb-EmmaTableDropbox {@cssClass}" style="{@cssText}"><div class="mstrmojo-qb-emma-container" style="margin-left: 12px"><div class="mstrmojo-qb-emma-EmptyHint"><div class="mstrmojo-qb-emma-EmptyHint-text">{@emptyHint}</div></div><div class="mstrmojo-qb-emma-TableCount"></div><div class="mstrmojo-qb-emma-content"></div></div></div>',markupSlots:{hintNode:function hintNode(){return this.domNode.firstChild.firstChild;},countNode:function countNode(){return this.domNode.firstChild.children[1];},containerNode:function containerNode(){return this.domNode.firstChild.lastChild;},panelNode:function panelNode(){return this.domNode.firstChild;}},emptyHint:mstrmojo.desc(14909,"Drag and Drop to Add Tables"),children:[{scriptClass:"mstrmojo.Label",alias:"tableCount",slot:"countNode",visible:false,postCreate:function postCreate(){if(this._super){this._super();}var evtConfig={},listConfig=evtConfig[this.id]={},TOTAL_TEXT=mstrmojo.desc(2121,"Total");listConfig.refreshTables=function(evt){var count=evt.items.length;this.set("visible",count>1);if(count>1){this.set("text",TOTAL_TEXT+": "+count);}};mstrApp.getRootController().attachDataChangeListeners(evtConfig);}},{scriptClass:"mstrmojo.qb.es.TableList",alias:"tableList"}],init:function init(props){this._super(props);var evtConfig={},tableConfig=evtConfig[this.id]={};tableConfig.refreshTables=this.onTableRefresh;mstrApp.getRootController().attachDataChangeListeners(evtConfig);},onTableRefresh:function onTableRefresh(evt){var hasTable=evt.items.length>0;mstrmojo.css.toggleClass(this.hintNode,["off"],hasTable);mstrmojo.css.toggleClass(this.panelNode,["active"],hasTable);this.panelNode.scrollTop=this.panelNode.scrollHeight;},dropZone:true,allowDrop:function allowDrop(context){return DRAG_ACTION_ADD_TABLE===context.action;},ondrop:function ondrop(context){var dragEvent=context.action,contextSrc=context.src;if(contextSrc&&contextSrc.data){var dragData=contextSrc.data;$A.forEach(dragData,function(obj,index){if(obj.n){obj.n=$STR.decodeHtmlString(obj.n.replace(/<strong>|<\/strong>/gi,""));obj.decoded=true;}});if(dragEvent===DRAG_ACTION_ADD_TABLE){mstrApp.getRootController().addTable(dragData);}}mstrmojo.css.removeClass(this.panelNode,"dragging");},getAvatarIconClass:function getAvatarIconClass(){return"enabled";},ondragenter:function ondragenter(context){var srcWidget=context.src.widget;if(srcWidget&&srcWidget.toggleAvatarClass&&this.allowDrop(context)){srcWidget.toggleAvatarClass(this.getAvatarIconClass(context),true);}mstrmojo.css.addClass(this.panelNode,"dragging");},ondragleave:function ondragleave(context){var srcWidget=context.src.widget;if(srcWidget&&srcWidget.toggleAvatarClass&&this.allowDrop(context)){srcWidget.toggleAvatarClass(this.getAvatarIconClass(context),false);}mstrmojo.css.removeClass(this.panelNode,"dragging");},onwidthChange:function onwidthChange(evt){var width=parseInt(evt.value,10);if(isNaN(width)){return ;}width=width-140;width=(width<=0)?"20px":width+"px";this.tableList.set("itemMaxWidth",width);}});}());