(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.Label","mstrmojo.TextBox","mstrmojo.DI.DIConstants","mstrmojo.qb.thirdParty.UrlSourceItem");mstrmojo.requiresDescs(11098,12850,13992);var $CSS=mstrmojo.css,$ARR=mstrmojo.array;mstrmojo.qb.thirdParty.SourceInput=mstrmojo.declare(mstrmojo.Container,null,{scriptClass:"mstrmojo.qb.thirdParty.SourceInput",markupString:'<div id="{@id}" class="mstrmojo-di-fileUpload mstrmojo-di-fu mstrmojo-qb-thirdParty-SourceInput {@cssClass}" style="{@cssText}" ><div></div><div class="url-input"></div><div class="url-container"></div><div class="url-placeholder">'+mstrmojo.desc(15306,"Please select a connection first")+"</div></div>",markupSlots:{containerNode:function(){return this.domNode;},instructionNode:function(){return this.domNode.firstChild;},urlInputNode:function(){return this.domNode.children[1];},urlContainerNode:function(){return this.domNode.children[2];},urlPlaceholderNode:function(){return this.domNode.lastChild;}},children:[{slot:"urlInputNode",scriptClass:"mstrmojo.TextBox",cssClass:"upload-url",alias:"urlInput",emptyText:mstrmojo.desc(12850,"Enter URL"),onvalueChange:function(){this.parent.updateAddBtnState();this.parent.enableFooterBtn();}},{slot:"urlInputNode",alias:"addBtn",scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-di-button mstrmojo-WebButton mstrmojo-bi-tools-add",cssDisplay:"inline-block",text:mstrmojo.desc(531,"Add"),onclick:function(){this.parent.addURL();}},{scriptClass:"mstrmojo.Box",cssClass:"select-hint-box",alias:"select-hint",bindings:{visible:function(){return this.parent.urlList.getSrcCnt()===0;}},children:[{scriptClass:"mstrmojo.Label",cssClass:"select-hint-text",text:mstrmojo.desc(13992,"Please select a connection first")}]},{slot:"urlContainerNode",scriptClass:"mstrmojo.Box",cssClass:"mstrmojo-qb-thirdParty-url-holder",alias:"urlList",srcs:[],bindings:{visible:function(){return true;}},postBuildRendering:function postBuildRendering(){this.srcs=[];},addURL:function addURL(url){var controller=mstrApp.getRootController();var urlItem=mstrmojo.insert({scriptClass:"mstrmojo.qb.thirdParty.UrlSourceItem",url:url,dbRoleID:controller.model.SelDBRoleID,dbRoleName:controller.model.SelDBRoleName,index:this.srcs.length===0?0:this.srcs[this.srcs.length-1].index+1});this.srcs.push({url:urlItem.url,dbRoleID:urlItem.dbRoleID,index:this.srcs.length===0?0:this.srcs[this.srcs.length-1].index+1});var urlList=this.addChildren(urlItem);urlList.render();this.containerNode.style.borderStyle=this.getSrcCnt()>0?"solid":"dashed";this.parent.urlPlaceholderNode.style.display=this.getSrcCnt()>0?"none":"block";},deleteURL:function deleteURL(urlItem){var index=mstrmojo.array.find(this.srcs,"index",urlItem.index);this.removeChildren(urlItem);this.containerNode.style.borderStyle=this.getSrcCnt()>0?"solid":"dashed";this.parent.urlPlaceholderNode.style.display=this.getSrcCnt()>0?"none":"block";this.parent.enableFooterBtn();if(index>=0){this.srcs.splice(index,1);}},deleteAll:function(){this.removeChildren();this.srcs=[];this.containerNode.style.borderStyle=this.getSrcCnt()>0?"solid":"dashed";this.parent.urlPlaceholderNode.style.display=this.getSrcCnt()>0?"none":"block";this.parent.enableFooterBtn();},getSrcCnt:function(){return this.children?this.children.length:0;},getSrcs:function(){return this.srcs;}}],addURL:function addURL(){var controller=mstrApp.getRootController();var model=controller.model;var url=this.urlInput.value;url=url.replace(/^\s+|\s+$/g,"");if(url.length===0||!model.SelDBRoleID){return ;}if(!model.isNew){this.urlList.deleteAll();}this.urlList.addURL(url);this.urlInput.set("value","");},enableFooterBtn:function enableFooterBtn(){var controller=mstrApp.getRootController();var model=controller.model;var srcCnt=this.urlList.getSrcCnt();var input=this.urlInput.value;if(srcCnt===0){var enabled=input&&model.SelDBRoleID;controller.enableButton(enabled);}else{if(!model.isNew&&srcCnt===1){controller.enableButton(input.length<1);}}},getSrcs:function getSrcs(){this.addURL();return this.urlList.getSrcs();},removeSrcs:function removeSrcs(srcs){var urlList=this.urlList;var children=urlList.children,childrenToDel=[];$ARR.forEach(srcs,function(src){$ARR.forEach(children,function(child){if(child.url===src.url){childrenToDel.push(child);return false;}});});$ARR.forEach(childrenToDel,function(child){urlList.removeChildren(child);});},initURL:function initURL(){var url=mstrApp.getRootController().model.SQLstmt;if(url&&url.length>0){this.urlList.addURL(url);this.enableFooterBtn();}},postBuildRendering:function postBR(){if(this._super){this._super();}var self=this;var model=mstrApp.getRootController().model;model.attachEventListener("reportDefLoaded",this.id,this.initURL);model.attachEventListener("BISourceChange",this.id,function(){self.updateAddBtnState();self.enableFooterBtn();});},updateAddBtnState:function(){var controller=mstrApp.getRootController();var model=controller.model;var enable=model.SelDBRoleID&&this.urlInput.value;this.toggleAddBtnState(enable);},toggleAddBtnState:function toggleAddBtnState(enable){$CSS[enable?"addClass":"removeClass"](this.addBtn.domNode,["hot"]);}});}());