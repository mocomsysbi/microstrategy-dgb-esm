(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.array","mstrmojo.SearchableDropDownList","mstrmojo._IsTableLayoutListDIC","mstrmojo.TableLayoutList","mstrmojo._IsInputControl","mstrmojo.DynamicClassFactory");var $CFC=mstrmojo.DynamicClassFactory.newComponent,$H=mstrmojo.hash,$A=mstrmojo.array,$C=mstrmojo.css,$D=mstrmojo.dom,DATA_DRIVEN_CONTROL=2,INPUT_VALUES_CALCULATED=0,INPUT_VALUES_MANUAL=1,INPUT_VALUES_DATASET=2;mstrmojo.SearchableDropDownListForListDIC=mstrmojo.declare(mstrmojo.SearchableDropDownList,null,{scriptClass:"mstrmojo.SearchableDropDownListForListDIC",markupString:'<div id="{@id}" class="mstrmojo-SearchableDropDownList mstrmojo-DropDownButton {@cssClass} {@direction}" style="{@cssText}"><div class="mstrmojo-DropDownButton-boxNode {@cssClass}-boxNode" title="{@title}"><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode" tabindex="0" mstrAttach:mousedown,keyup>{@text}</div><table class="mstrmojo-InputNodeBar"><colgroup><col class="inputCol"/><col class="iconCol"/></colgroup><tr><td><input class="mstrmojo-SearchableDropDownList-inputNode" value="{@text}" placeholder="{@placeholderText}" mstrAttach:keyup,blur,click/></td><td><div class="mstrmojo-DropDownButton-iconNode {@cssClass}-iconNode" mstrAttach:mousedown></div></td></tr></table></div><div class="mstrmojo-DropDownButton-popupNode {@cssClass}-popupNode"></div><div class="curtain"></div></div>',markupSlots:$H.copy({popupNode:function(){return this.domNode.children[1];},disableCurtainNode:function(){return this.domNode.lastChild;}},$H.copy(mstrmojo.SearchableDropDownList.prototype.markupSlots)),markupMethods:$H.copy({onenabledChange:function(){$C.toggleClass(this.disableCurtainNode,"disabled",!!this.enabled);}},$H.copy(mstrmojo.SearchableDropDownList.prototype.markupMethods)),init:function init(props){this._super(props);this.popupRef.children[0].onmousedown=function(){var p=this.parent,pd=p.opener;p.close();if(pd){pd.onPopupClosed();}};},postBuildRendering:function(){this.autofocus=false;this._super();},focus:function(){this.autofocus=true;this._super&&this._super();},onmousedown:function onmousedown(evt){this._super&&this._super(evt);if($D.isIE||$D.isIEW3C){this.focus();}},openPopup:function(ref,config){var showByDefault=this.parent.showByDefault;this[ref].popupConfig=new mstrmojo.ui.PopupConfig({hostElement:this.popupNode,isHostedWithin:false});this._super(ref,config);if(showByDefault){this.parent.setInfoWindowLock(true);}},togglePopup:function togglePopup(){if(this._super){this._super();}var pn=this.popupRef.domNode;var pos=$D.position(this.popupNode,true);if(pn){var style=(window.getComputedStyle&&window.getComputedStyle(pn,null))||pn.currentStyle;var fixMaxHeight=extractNumber(style.height);var outer=extractNumber(style.marginTop)+extractNumber(style.borderTopWidth)+extractNumber(style.paddingTop)+extractNumber(style.paddingBottom)+extractNumber(style.borderBottomWidth)+extractNumber(style.marginBottom);var contentPos=$D.position(pn,true);var winDim=$D.windowDim();if(contentPos.y<0){pn.style.maxHeight=Math.min((Math.round(pos.y)-outer),fixMaxHeight)+"px";pn.lastChild.style.maxHeight=pn.style.maxHeight;}else{if(contentPos.y+contentPos.h>winDim.h){pn.style.maxHeight=Math.min((Math.round(winDim.h-contentPos.y)-outer),(Math.round(pos.y)-outer),fixMaxHeight)+"px";pn.lastChild.style.maxHeight=pn.style.maxHeight;}}}},popupRef:$H.copy({onClose:function(){var showByDefault=this.opener.parent.showByDefault;if(showByDefault){this.opener.parent.setInfoWindowLock(false);}}},$H.clone(mstrmojo.SearchableDropDownList.prototype.popupRef)),onPopupClosed:mstrmojo.emptyFn});function getTitleItems(items){var arr=[];mstrmojo.array.forEach(items,function(v){arr.push(v.n);});return arr;}mstrmojo.TableLayoutListForListDIC=$CFC(mstrmojo.TableLayoutList,[mstrmojo._IsTableLayoutListDIC],{scriptClass:"mstrmojo.TableLayoutListForListDIC",getItemMarkup:function(item,idx){var markup='<{@tag} class="item {@cls}" idx="{@idx}" title="{@en@n}" style="{@style}"><span class="item_bg"></span>{@en@n}</{@tag}>',lt=this.getLeftEndTitle(idx),rt=this.getRightEndTitle(idx),ipr=this.itemsPerRow;lt='<td class="left_text" title="'+lt+'">'+lt+"</id>";rt='<td class="right_text" title="'+rt+'">'+rt+"</id>";if(ipr>0){markup=(idx%ipr===0?"<tr>"+lt:"")+"<td>"+markup+"</td>"+((idx+1)%ipr===0?rt+"</tr>":"");}else{markup='<td><div class="item_wrapper" idx="'+idx+'">'+markup+"</div></td>";if(!idx){markup="<tr>"+lt+markup;}else{if(idx===this.items.length-1){markup=markup+rt+"</tr>";}}}return markup;},postvalueChange:function(){this._super&&this._super();if(this.parent&&this.parent.owner&&this.parent.owner.model){var model=this.parent.owner.model,zf=model.getZoomFactor&&model.getZoomFactor()||1;this.zoomBackground(zf,this.domNode.getElementsByClassName("item_bg"));}},postBuildRendering:function(){this._super&&this._super();$C.toggleClass(this.domNode,"disabled",!this.enabled);if(this.parent&&this.parent.owner&&this.parent.owner.model){var model=this.parent.owner.model,zf=model.getZoomFactor&&model.getZoomFactor()||1;if(zf!==1){var item_wrappers=this.domNode.getElementsByClassName("item_wrapper");for(var j=0;j<item_wrappers.length;j++){item_wrappers[j].parentNode.style.width=item_wrappers[j].parentNode.offsetWidth*zf+"px";}this.zoomStyle(zf,this.domNode.getElementsByClassName("item_bg"),100,500);}}},});function getDICWidget(style,dic,items,requireEmptyElem){var ipr=dic.ipr||0,mint=dic.mint||"",maxt=dic.maxt||"";return{0:{scriptClass:"mstrmojo.SearchableDropDownListForListDIC",cssDisplay:"block",searchEnabled:items.length>=10,itemIdField:"v",fixWidth:true,fixHeight:true,postCreate:function(){var value=this.value||"",ipt=dic.ipt||INPUT_VALUES_CALCULATED,ust=ipt===INPUT_VALUES_MANUAL?dic.ust||"":"",idx=mstrmojo.array.find(items,"wbfv",value),tmpIdx=mstrmojo.array.find(items,"v",value);if(ipt!==INPUT_VALUES_DATASET){idx=tmpIdx;}if(idx===-1||requireEmptyElem){value=(idx===-1&&tmpIdx===-1)?value:undefined;if(idx===-1&&tmpIdx===-1&&requireEmptyElem){items=[{n:value||"",v:value||""}].concat(items);}else{items=[{n:ust,v:value}].concat(items);}if(tmpIdx!==-1){idx=tmpIdx;}idx+=1;if(idx===0){this.unset=true;}}this.items=items;this.selectedIndex=idx;this.set("value",items[idx].v);if(this.parent.showByDefault&&this.searchEnabled){this.applyChange=function(){if(this.value!=this.parent.value){this.parent.set("value",this.value);}else{this.items=this.allItems;this.set("text",this.text);}};this.onvalueChange=function(){};if($D.isIE||$D.isIEW3C){this.onPopupClosed=function(){this.applyChange&&this.applyChange();};}}},onblur:function(evt){this.applyChange&&this.applyChange();},onEnter:function(){this.applyChange&&this.applyChange();},onEsc:function(){this.items=this.allItems;this.set("value",this.parent.value);},getDisplayValue:function(){return this.items.length&&this.items[this.selectedIndex===-1?0:this.selectedIndex].n;},isPopupClosed:function(){return !(this.popupRef&&this.popupRef.visible);},bindings:{enabled:"this.parent.enabled"}},1:{scriptClass:"mstrmojo.TableLayoutListForListDIC",styleCssClass:"radio",itemsPerRow:ipr,items:items,getDisplayValue:function(){return this.items[this.selectedIndex].n;},bindings:{enabled:"this.parent.enabled"}},2:{scriptClass:"mstrmojo.TableLayoutListForListDIC",styleCssClass:"check",delim:",",multiSelect:true,itemsPerRow:ipr,items:items,getDisplayValue:function(){return"";},bindings:{enabled:"this.parent.enabled"}}}[style||0];}function extractNumber(value){var n=parseInt(value);return n===null||isNaN(n)?0:n;}mstrmojo.ListDIC=mstrmojo.declare(mstrmojo.Container,[mstrmojo._IsInputControl],{scriptClass:"mstrmojo.ListDIC",tabIndex:0,markupString:'<div class="mstrmojo-ListDIC {@cssClass}" tabIndex="{@tabIndex}" mstrAttach:focus></div>',markupSlots:{containerNode:function(){return this.domNode;}},markupMethods:{onwidthChange:function(){if(this.dicWidget&&this.width){this.dicWidget.set("width",this.width);}},onheightChange:function(){if(this.dicWidget&&this.height){this.dicWidget.set("height",this.height);}}},init:function(props){this._super(props);this.style=this.dic.st;this.items=this.getItems();this.set("children",[mstrmojo.hash.copy(getDICWidget(this.style,this.dic,this.items,this.dic.ipt===DATA_DRIVEN_CONTROL),{alias:"dicWidget",value:this.value,onvalueChange:function(){if(this.value!=this.parent.value){this.parent.set("value",this.value);}},itemName:function itemName(item,idx,w){return item[w.itemField];}})]);if(this.dicWidget.setDirtyFlag){this.setDirtyFlag=function(c,d){this.dicWidget.setDirtyFlag(c,d);};}},getDisplayValue:function getDisplayValue(){var dv=this.dicWidget.getDisplayValue();return(dv!=null)?dv:this.dv;},onfocus:function(evt){this.focus();},focus:function(){var me=this;if(mstrmojo.dom.isIE){setTimeout(function(){me.dicWidget.focus&&me.dicWidget.focus();},10);}else{me.dicWidget.focus&&me.dicWidget.focus();}},postBuildRendering:function(){this._super();if(!mstrmojo.isDescendant(this.owner,this)&&this.showByDefault){this.dicWidget.set("height",(this.openerStyle.ih||0)+"px");this.dicWidget.set("width",(this.openerStyle.iw||0)+"px");}},applyChanges:function(){var ret=this._super();if(this.canSlice){var params={type:parseInt(this.dic.ct,10),src:this.dic.k,ctlKey:this.dic.ckey,include:this.dic.include,tks:this.dic.tks,ck:this.dic.ck,disablePU:false};var me=this;window.setTimeout(function(){me.owner.model.sendTransactionUpdates(params);},0);}return this.style?ret:this.dicWidget.isPopupClosed();},cleanup:function cleanup(){if(!this.style){this.dicWidget.closePopup();}},isDicWidgetReady:function(){return this.dicWidget;}});})();