(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapUtils","mstrmojo.hash","mstrmojo.gmaps.MapEnums","mstrmojo.gmaps.graphic.Graphic","mstrmojo.gmaps.geometry.Circle","mstrmojo.gmaps.geometry.PieSlice");var $GEOMETRY=mstrmojo.gmaps.geometry,$MAPUTIL=mstrmojo.gmaps.MapUtils,$HASH=mstrmojo.hash;mstrmojo.gmaps.graphic._HasPieSlices=mstrmojo.provide("mstrmojo.gmaps.graphic._HasPieSlices",{_mixinName:"mstrmojo.gmaps.graphic._HasPieSlices",getTotalValue:function getTotalValue(){var totalValue=this.totalValue,points=this.points,pointCnt=points&&points.length,point,pAttributs,angleByMetricVal,i;if(!$MAPUTIL.checkVal(totalValue)){totalValue=0;for(i=0;i<pointCnt;i++){point=points[i];pAttributs=point&&point.attributes;angleByMetricVal=pAttributs&&pAttributs.absAngleMetricVal;if($MAPUTIL.checkVal(angleByMetricVal)){totalValue+=angleByMetricVal;}}this.totalValue=totalValue;}return totalValue;},createPieSliceGraphics:function createPieSliceGraphics(isRing,outterR,innerR,x,y){var i,point,pAttributes,slice,angleMetricValue,proportion,startDegree=0,endDegree,threshold,points=this.points||[],totalValue=this.getTotalValue();this.pieSlices=[];var pieSliceShapeFormatProp=(this.parent&&this.parent.getLayerFmts())||{},sliceCnt=points.length;for(i=0;i<sliceCnt;i++){point=points[i];pAttributes=point.attributes;angleMetricValue=pAttributes&&pAttributes.absAngleMetricVal;threshold=pAttributes&&pAttributes.threshold;if(threshold&&threshold.colorStr){pieSliceShapeFormatProp.fillColor=threshold.colorStr;}if(sliceCnt===1){slice=new mstrmojo.gmaps.graphic.Graphic({geometry:new $GEOMETRY.Circle($HASH.copy({radius:outterR,x:x,y:y},pieSliceShapeFormatProp)),attributes:pAttributes,geoData:this.geoData});}else{proportion=totalValue===0?(1/this.clusterCount):($MAPUTIL.checkVal(angleMetricValue)?(angleMetricValue/totalValue):0);if(proportion===0){continue;}endDegree=startDegree+360*proportion;if(startDegree===0&&endDegree===360){endDegree=359.9999;}slice=new mstrmojo.gmaps.graphic.Graphic({geometry:new $GEOMETRY.PieSlice($HASH.copy({startDegree:startDegree,endDegree:endDegree,innerR:innerR,outterR:outterR,isRing:isRing,x:x,y:y},pieSliceShapeFormatProp)),attributes:pAttributes,geoData:this.geoData});startDegree=endDegree;}this.pieSlices.push(slice);if(this.addSubGraphic instanceof Function){this.addSubGraphic(slice);}}},destroy:function destroy(){if(this.pieSlices){delete this.pieSlices;}if(this._super){this._super();}}});}());