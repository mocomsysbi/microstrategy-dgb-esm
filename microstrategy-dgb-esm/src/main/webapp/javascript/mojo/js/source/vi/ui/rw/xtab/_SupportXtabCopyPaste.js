(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.dom");var $DOM=mstrmojo.dom,$ARR=mstrmojo.array,$HASH=mstrmojo.hash;function getExtraColSpanCount(row){var colSpans=0,rowChildNodes=row.childNodes;$ARR.forEach(rowChildNodes,function(child){colSpans+=(child.colSpan||1)-1;});return colSpans;}function initializeData(isRMC){var me=this;me.selectedRows=[];me.headersData="";me.rowsData="";if(isRMC){me.clipBoardTextRMC="";}else{me.clipBoardText="";}me.globalRowCounter=0;me.allRows=[];}function extractRows(selectedCells,isRMC){initializeData.call(this,isRMC);var i,tdCount=selectedCells.length;var headerInfo=populateHeaderInfo.call(this,$DOM.findAncestorByName(selectedCells[0],"tr",true,this.domNode)),headerRowCount=headerInfo.headerRowCount,maxHeaderChildCount=headerInfo.maxHeaderChildCount,gridOffset=headerInfo.gridOffset;for(i=0;i<tdCount;i++){findAncestorsByRowSpan.call(this,selectedCells[i],"tr",true,this.domNode,headerRowCount,maxHeaderChildCount,gridOffset);}}function populateHeaderInfo(currentRow){var hRC=this.rhsCP.startIndexInContainer||0,mHcc=0;var i,offset=0,tbody=currentRow&&currentRow.parentNode;while(tbody.hasAttribute("n")&&parseInt(tbody.getAttribute("n"),10)>0){tbody=tbody.previousElementSibling;}var firstRowInContainer=tbody.firstChild,headerChildNodes=firstRowInContainer.childNodes;for(i=0;i<headerChildNodes.length;i++){mHcc+=parseInt(headerChildNodes[i].getAttribute("colspan"));}var headerAndFirstRowObj=getHeaderData(firstRowInContainer,hRC,mHcc);this.headersData=headerAndFirstRowObj.headerText;var firstDataRow=headerAndFirstRowObj.firstDataRow;if(firstDataRow&&firstDataRow.childElementCount>mHcc){offset=1;}return{headerRowCount:hRC,maxHeaderChildCount:mHcc,gridOffset:offset};}function getHeaderData(headerRow,headerRowCount,maxHeaderChildCount){var i=0,it,headerText="",headerRowCounter=0,currHeaderRowChildCount,colSpan,currHeaderChildNodes;while(headerRowCounter<headerRowCount){currHeaderChildNodes=headerRow.childNodes;currHeaderRowChildCount=currHeaderChildNodes.length;if(headerRowCounter!==0){headerText+="\n";for(i=0;i<(maxHeaderChildCount-currHeaderRowChildCount);i++){headerText+="\t";}}for(i=0;headerRow&&i<currHeaderRowChildCount;i++){it=currHeaderChildNodes[i].innerText||currHeaderChildNodes[i].textContent;headerText+=it?(it+"\t"):"";colSpan=currHeaderChildNodes[i].getAttribute("colspan");while(colSpan>1){headerText+="\t";colSpan--;}}headerRow=headerRow.nextSibling;headerRowCounter++;}return{headerText:headerText,firstDataRow:headerRow};}function getPreviousRowCell(cellIndex){return this.allRows[this.globalRowCounter>0?this.globalRowCounter-1:0][cellIndex];}function findAncestorsByRowSpan(td,nodeName,inclusive,elLimit,headerRowCount,maxHeaderChildCount,gridOffset){var umCells=[],umObjs=[],rowSpanCount=td.rowSpan,i=0,currentRowText="",cellCounter=0,cell="",currentRow=$DOM.findAncestorByName(td,nodeName,inclusive,elLimit),me=this,allRows=me.allRows,colSpanCount;if((currentRow.childElementCount-gridOffset)<maxHeaderChildCount){umObjs=me.rhsCP.getUnmergedCells(td.getAttribute("r")-headerRowCount);for(i=0;i<umObjs.length;i++){umCells[i]=(umObjs[i]._e)?umObjs[i]._e.n:" ";}}if(rowSpanCount===1){allRows[me.globalRowCounter]=new Array(maxHeaderChildCount);cellCounter=0;if(umCells.length>0){umCells.forEach(function(umCell){currentRowText+=umCell+"\t";allRows[me.globalRowCounter][cellCounter++]=umCell;});}currentRowText=extractCellsFromRow.call(me,currentRow,currentRowText,cellCounter);saveSelectedRow.call(me,currentRowText);this.globalRowCounter++;}else{while(rowSpanCount>0){cellCounter=0;allRows[me.globalRowCounter]=new Array(maxHeaderChildCount);currentRowText="";colSpanCount=getExtraColSpanCount(currentRow);i=maxHeaderChildCount-(currentRow.childElementCount-gridOffset)-colSpanCount;while(i>0){cell=umCells[cellCounter]?umCells[cellCounter]:getPreviousRowCell.call(me,cellCounter);currentRowText+=cell+"\t";allRows[me.globalRowCounter][cellCounter++]=cell;i--;}currentRowText=extractCellsFromRow.call(me,currentRow,currentRowText,cellCounter);saveSelectedRow.call(me,currentRowText);me.globalRowCounter++;currentRow=currentRow.nextSibling;rowSpanCount--;}}}function extractCellsFromRow(currentRow,currentRowText,cellCounter){var i,it,currentRowChildNodes=currentRow.childNodes,globalRow=this.allRows[this.globalRowCounter],colSpan;for(i=0;i<currentRowChildNodes.length;i++){var currentTd=currentRowChildNodes[i];it=currentTd.innerText||currentTd.textContent;currentRowText+=it?(it+"\t"):"";globalRow[cellCounter++]=it?(it):"";colSpan=currentTd.colSpan;while(colSpan-->1){currentRowText+="\t";globalRow[cellCounter++]="\t";}}return currentRowText;}function saveSelectedRow(_tr){if($ARR.indexOf(this.selectedRows,_tr)<0){this.selectedRows.push(_tr);this.rowsData+=_tr+"\n";}}function updateClipBoardData(){this.clipBoardText=(this.headersData)?this.headersData+"\n"+this.rowsData:this.rowsData;}function updateClipBoardDataRMC(){this.clipBoardTextRMC=(this.headersData)?this.headersData+"\n"+this.rowsData:this.rowsData;}function updateXtabHiddenTxtArea(){var xha=this.xTabHiddenTextArea;xha.readOnly=false;xha.value=this.clipBoardText;xha.readOnly=true;xha.focus();xha.select();}function updateXtabHiddenTxtAreaRMC(){var xha=this.xTabHiddenTextArea;xha.readOnly=false;xha.value=this.clipBoardTextRMC;xha.readOnly=true;xha.focus();xha.select();}function copyToClipBoard(){try{document.execCommand("copy");}catch(ex){console.log("Exception while copying data"+ex);}}function cleanUp(){var me=this;me.selectedRows=null;me.allRows=null;me.headersData=null;me.rowsData=null;}mstrmojo.vi.ui.rw.xtab._SupportXtabCopyPaste=mstrmojo.provide("mstrmojo.vi.ui.rw.xtab._SupportXtabCopyPaste",{_mixinName:"mstrmojo.vi.ui.rw.xtab._SupportXtabCopyPaste",xTabHiddenTextArea:undefined,isCopySupported:false,selectedRows:[],headersData:"",rowsData:"",clipBoardText:"",clipBoardTextRMC:"",globalRowCounter:0,allRows:undefined,init:function init(props){this._super(props);this.isCopySupported=!(mstrApp.isSingleTier&&$DOM.isMac()||$DOM.isSafari||$DOM.isFF);},onclick:function onclick(e){this._super(e);var isOutLineMode=$HASH.walk("node.data.olm",this)&&!($HASH.walk("node.data.rw.row.bc",this)>0);if(this.cmSelCells.length>0&&!$DOM.isMobile&&!isOutLineMode){this.prepareClipBoardDataRMC.call(this,this.cmSelCells);}if(this.selCells.length>0&&!$DOM.isMobile&&!isOutLineMode){this.prepareClipBoardData.call(this,this.selCells);}},prepareClipBoardData:function prepareClipBoardData(tds){extractRows.call(this,tds,false);updateClipBoardData.call(this);updateXtabHiddenTxtArea.call(this);cleanUp.call(this);},prepareClipBoardDataRMC:function prepareClipBoardDataRMC(tds){extractRows.call(this,tds,true);updateClipBoardDataRMC.call(this);},copyRowsFromXtab:function copyRowsFromXtab(contextCell,tds){if(tds.length<1){return ;}if(this.isCopySupported){updateXtabHiddenTxtAreaRMC.call(this);copyToClipBoard.call(this);}cleanUp.call(this);}});}());