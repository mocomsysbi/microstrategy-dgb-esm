(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapUtils","mstrmojo.PerformanceLogOutput");var $MOJO=mstrmojo,$MUTLS=$MOJO.gmaps.MapUtils,$PerfLog=$MOJO.PerformanceLogOutput;mstrmojo.gmaps.basemap._CanLoadMapExternalScript=mstrmojo.provide("mstrmojo.gmaps.basemap._CanLoadMapExternalScript",{_mixinName:"mstrmojo.gmaps.basemap._CanLoadMapExternalScript",callback:null,jsURL:null,loadJsScript:function loadJsScript(url,callBackFunc,mapCache){var me=this;this.callback=callBackFunc;if(!url){return ;}$MUTLS.loadExternalScript(url,function onSuccess(){$PerfLog.endTimer("timerid_callback_LoadMainModule");$PerfLog.visPrint("Load Map modules start");var timerid=$PerfLog.startTimer({functionName:"_CanLoadMapExternalScript.loadMainModule: "+url,purpose:"Load Map Modules"});me.loadMainModule();$PerfLog.endTimer(timerid);$PerfLog.visPrint("Load Map modules end");},function onError(){if(mapCache){me.loadMap(mapCache);}});},getURL:function getURL(rawUrl){var protocol=mstrApp.isSingleTier?"http:":window.location.protocol;return protocol+rawUrl;},loadMap:function loadMap(mapCache){if(!mapCache){return ;}$PerfLog.visPrint("Load and create map start");var timerid_loadMap=$PerfLog.startTimer({functionName:"_CanLoadMapScript.loadMap: ",purpose:"Load map, and create map, sync"});var i,j,finishedCallbacks=[],finishedCallback,listener,found,listenerCount=mapCache.loadScriptListeners.length;this.callback.call(this);finishedCallbacks.push({caller:this,method:this.callback});for(i=0;i<listenerCount;i++){listener=mapCache.loadScriptListeners[i];found=false;for(j=0;j<finishedCallbacks.length;j++){finishedCallback=finishedCallbacks[j];if(listener.caller===finishedCallback.caller&&listener.method===finishedCallback.method){found=true;break;}}if(!found){listener.method.call(listener.caller);finishedCallbacks.push({caller:listener.caller,method:listener.method});}}$PerfLog.endTimer(timerid_loadMap);$PerfLog.visPrint("Load and create map end");$PerfLog.startTimer({functionName:"_CanLoadMapScript.loadMap: ",purpose:"time gap between map creation and render graphics"},"timerid_callback_handleExtentChange");}});}());