(function(){mstrmojo.requiresCls("mstrmojo.array");var $ARR=mstrmojo.array,FontLoaded={},FontMissing={},FONT_SIZE="72px",MEASURE_STRING="abcdefghijklmnopqrstuvwxyz0123456789";function getFontNameWithStyle(font){return font.name+":"+(font.isItalic?"i":"n")+(font.isBold?"7":"4");}mstrmojo.util.FontLoader=mstrmojo.provide("mstrmojo.util.FontLoader",{load:function load(fontConfig,callback){var me=this,fontsToFetch=[],fontName;$ARR.forEach(fontConfig,function(font){if(!me.isFontInstalled(font)){fontName=getFontNameWithStyle(font);if(!FontLoaded[fontName]&&!FontMissing[fontName]){fontsToFetch.push(fontName);}}});if(!window.WebFont||fontsToFetch.length===0){return true;}window.WebFont.load({custom:{families:fontsToFetch},fontactive:function(fn,fvd){FontLoaded[fn+":"+fvd]=true;},fontinactive:function(fn,fvd){FontMissing[fn+":"+fvd]=true;},active:function active(){callback.success();},inactive:function inactive(){callback.failure();}});return false;},isFontInstalled:function isFontInstalled(font){var canvas=document.createElement("canvas"),context=canvas.getContext("2d"),fontStyle=font.isItalic?"italic":"normal",fontWeight=font.isBold?"bold":"normal",fontSetting=fontStyle+" "+fontWeight+" "+FONT_SIZE,defaultSize,targetSize;context.font=fontSetting+" monospace";defaultSize=context.measureText(MEASURE_STRING).width;context.font=fontSetting+" '"+font.name+"', monospace";targetSize=context.measureText(MEASURE_STRING).width;canvas=null;return defaultSize!==targetSize;}});})();