(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo._FillsBrowser","mstrmojo.Container","mstrmojo.EnumRWUnitType","mstrmojo.Label","mstrmojo.ui.PopupButton","mstrmojo.ui.Pulldown","mstrmojo.vi.ui.TargetSelector","mstrmojo.vi.ui.TruncatedList");var $H=mstrmojo.hash,$ARR=mstrmojo.array,$CSS=mstrmojo.css,$DOM=mstrmojo.dom,$NWB=mstrmojo.Button.newWebButton,$RW_TYPE=mstrmojo.EnumRWUnitType,cachedShowAll=null,clearActiveTargets=function(evt){var model=this.vis.model,panelKey=evt.panelKey,currentPanelKey=this.currentPanelKey||model.getVizContentPanel().k;if(panelKey===currentPanelKey){return ;}if(this.targetContainer.getTargetChildren().length===0){this.goToPage(evt);return ;}this._tocNavWarn(evt);},storePanelInfo=function(){var rootControl=mstrApp.rootCtrl,view=rootControl.view,toggleViewBar=rootControl.toggleViewBar,tocPanel=rootControl.tocPanel,galleryPanel=rootControl.galleryPanel,datasetsPanel=rootControl.datasetsPanel,model=this.vis.model,panelsIsOpen=[],panels,isCPVisible;panels=[toggleViewBar,datasetsPanel,galleryPanel];this.isCPVisible=isCPVisible=view.isCPVisible;$ARR.forEach(panels,function(panel){panelsIsOpen.push(panel&&panel.getOpenStatus());});this.panelsIsOpen=panelsIsOpen;this.panels=panels;if(this.tocEnabled){if(!isCPVisible){view.setIsCPVisible(true,true);}this.isTocNav=tocPanel.visible;tocPanel.set("isMasked",false);this.setNavIcon(true,true);}if(model.attachEventListener){this.layoutSelectedSubscription=model.attachEventListener("targetLayoutSelected",this.id,clearActiveTargets.bind(this));}},restorePanelInfo=function(){var model=this.vis.model,view=mstrApp.rootCtrl.view,panelsIsOpen=this.panelsIsOpen,isCPVisible=this.isCPVisible;$ARR.forEach(this.panels,function(panel,index){panel.setOpenStatus(panelsIsOpen[index],true,undefined,false);});if(this.tocEnabled){if(!isCPVisible){view.setIsCPVisible(isCPVisible,true);}this.setNavIcon(false,true);}if(model.detachEventListener){model.detachEventListener(this.layoutSelectedSubscription);}},getKeyDifference=function(keys){var keyLength=keys.length,children=this.targetContainer.getTargetChildren(),childKeys=children.map(function(child){return child.key;}).sort($ARR.stringSorter),childKeysLength=childKeys.length,length,longArray,idx,shouldAddKey,key,finalKeys=[];if(keyLength>childKeysLength){length=childKeysLength;longArray=keys;shouldAddKey=true;}else{length=keyLength;longArray=childKeys;shouldAddKey=false;}for(idx=0;idx<length;idx++){if(keys[idx]!==childKeys[idx]){this.targetContainer.addAndRemoveKeys([this.targetKeys[longArray[idx]]],shouldAddKey);return ;}}for(idx;idx<longArray.length;idx++){key=this.targetKeys[longArray[idx]];if(key){finalKeys.push(key);}}if(finalKeys.length){this.targetContainer.addAndRemoveKeys(finalKeys,shouldAddKey);}},notifyApply=function(model){var tgtSelector=model.getVizContentPanel()._tgtSelections;if(tgtSelector){tgtSelector.notify();}},enableOptions=function(isEnabled){if(this.options){this.csl.set("enabled",isEnabled);this.options.set("enabled",isEnabled);}};function showTargetSelector(){var model=this.vis.model,unitKey=this.vis.k,layoutKey;if(!this.targetSelector){this.targetSelector=this._createTargetSelector();}else{this.targetSelector.set("hostId",this.id);if(!mstrmojo.all[this.vis.id]){layoutKey=model.getLayoutKeyByUnitKey(unitKey);if(layoutKey===model.getCurrentLayoutKey()){this.targetSelector.setSourceByKey(unitKey);}}}this.showControlOverlay([this.targetSelector]);this.targetSelector.enterSelectMode();}function resetDialog(){var keys,sc=this.sc,targetPanel=sc&&sc.isNavigation&&sc.navPage,options=this.options;if(this.vis.model.getVizContentPanel().children){if(options){options.closeDialog();}delete this.children;this.refresh();if(!targetPanel||targetPanel===this.currentPanelKey){keys=$H.valarray(this.targetKeys).filter(function(tgt){return tgt.v;}).map(function(tgt){return tgt.k;}).sort($ARR.stringSorter);if(keys.length){getKeyDifference.call(this,keys);}}}}function setSelectors(vis){var boxContent=vis.boxContent,isVisMap=boxContent.isVisMap,defn=isVisMap?boxContent.getWidgetForTemplateSelection().node.defn:vis.defn,visModel=boxContent.model,isSamePage=(this.srcPanelKey===vis.model.getVizContentPanel().k),sc,an,cgbs;this.cgbs=cgbs=(visModel&&visModel.getSelectorControlMapInfo?visModel.getSelectorControlMapInfo():[]);if(cgbs.length>0){sc=cgbs[0].sc;this.unitId=cgbs[0].did;this.singleUnit=true;}else{an=defn.an;sc=boxContent.selectorControl||(visModel&&boxContent.findSelectorControl&&boxContent.findSelectorControl());this.singleUnit=false;}this.cachedFiltertypeIndex=(!!an&&an.length>0)&&!this.singleUnit&&!sc?1:0;if(cachedShowAll===null){cachedShowAll=isSamePage&&(sc?sc.showall:true);}this.sc=sc;this.an=an;}mstrmojo.vi.ui.InlineDialogBase=mstrmojo.declare(mstrmojo.Container,[mstrmojo._FillsBrowser],{scriptClass:"mstrmojo.vi.ui.InlineDialogBase",cssClass:"mstrmojo-inline-dialog",title:mstrmojo.desc(12136,"Filtering options"),targetKeys:null,vis:null,buttons:null,origTargetKeys:[],changes:{},sc:null,singleUnit:null,cgbs:null,unitId:null,an:null,panelsIsOpen:null,panels:null,isCPVisible:null,srcPanelKey:null,shouldNavigate:true,cachedFiltertypeIndex:0,numBoxesChecked:0,optionsStateForRefresh:{openOnRefresh:false,showAll:false},layoutSelectedSubscription:null,tocEnabled:true,isTocNav:false,isOnTocChange:false,selectFilters:false,targetSelector:null,markupString:'<div id="{@id}" class="mstrmojo-Dialog-Bar {@cssClass}" tabindex="0" mstrAttach:click><div class="win mstrmojo-bar"><div class="mstrmojo-bar-content"></div><div class="mstrmojo-bar-buttons"></div></div></div>',markupSlots:{editorNode:function(){return this.domNode.firstChild;},containerNode:function(){return this.domNode.firstChild.childNodes[0];},buttonNode:function(){return this.domNode.firstChild.lastChild;}},init:function init(props){if(this._super){this._super(props);}this.srcPanelKey=this.vis.parent.k;var model=this.vis.model;if(model.attachEventListener){model.attachEventListener("buildBoxLayoutComplete",this.id,this.buildBoxLayoutComplete);}},buildBoxLayoutComplete:function buildBoxLayoutComplete(){var model=this.vis.model;if(this.tocEnabled&&!this.isTocNav){this.setNavIcon(true,true);}resetDialog.call(this);if(this.isOnTocChange){var tgtSelector=model.getVizContentPanel()._tgtSelections,keys=$H.valarray(this.targetKeys).filter(function(tgt){return tgt.v;}).map(function(tgt){return tgt.k;});if(tgtSelector){$ARR.forEach(keys,function(id){model.getUnitInstance(id,1).parent.toggleBoxSelection(true);if(!tgtSelector.toggleSelection(id)){tgtSelector.toggleSelection(id);}});this.isOnTocChange=false;}}notifyApply(model);},_createTargetSelector:function _createTargetSelector(){return new mstrmojo.vi.ui.TargetSelector({alias:"targetSelector",orientation:"h",hostId:this.id,srcId:this.vis.id});},_createOptionsButton:function _createOptionsButton(){var me=this,myVis=me.vis,model=myVis.model,isSamePage=(this.srcPanelKey===(this.currentPanelKey||model.getVizContentPanel().k));return{scriptClass:"mstrmojo.ui.PopupButton",alias:"options",cssDisplay:"inline-block",isHostedWithin:false,anchorSlot:"btnNode",markupString:'<div id="{@id}" class="mstrmojo-ui-OptionsButton {@cssClass}" style="{@cssText}"><div class="opts" mstrAttach:click></div></div>',markupSlots:{btnNode:function(){return this.domNode.firstChild;}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},onRender:function(){if(this._super){this._super();}$CSS.toggleClass(this.domNode,"disabled",!this.enabled);},onenabledChange:function(){$CSS.toggleClass(this.domNode,"disabled",!this.enabled);},getPopupWidget:function getPopupWidget(){return this.optionEditor;},getPopupConfig:function getPopupConfig(){var enum_cfg=mstrmojo.ui.PopupConfig.ENUM_CORNERS,cfg=this.constructor.prototype.getPopupConfig.call(this);cfg.alignment={host:enum_cfg.BOTTOM_RIGHT,popup:enum_cfg.TOP_RIGHT};return cfg;},openDialog:function(){var optState=me.optionsStateForRefresh,optEd=this.optionEditor;if(optState.openOnRefresh){optState.openOnRefresh=false;optEd.clrSel.set("checked",optState.showAll);optEd.open();}},closeDialog:function(){var optState=me.optionsStateForRefresh,optEd=this.optionEditor;if(optEd.visible){optState.openOnRefresh=true;optState.showAll=optEd.clrSel.checked;optEd.close();}},children:[{scriptClass:"mstrmojo.ui.PopupWidget",alias:"optionEditor",visible:false,onClose:function(){this.clrSel.set("checked",cachedShowAll);this.buttons.enableApply(false);},handleSelectionSubmit:function(isApply){var changes=me.changes;if(isApply){if(changes.clearAll!==undefined){delete changes.clearAll;}else{changes.clearAll=me.csl.checked;}cachedShowAll=me.csl.checked;notifyApply(model);}this.close();},children:[{scriptClass:"mstrmojo.CheckBox",cssClass:"mstrmojo-clear-check",cssDisplay:"inline-block",alias:"clrSel",enabled:false,checked:cachedShowAll,label:mstrmojo.desc(11957,"Allow users to clear all selections"),onenabledChange:function(){if(!isSamePage){this.enabled=false;this.set("checked",false);}else{if(!me.filterType.isFilter){this.set("checked",true);}else{this.set("checked",cachedShowAll);}}},oncheckedChange:function(){var popup=this.parent;if(popup){popup.buttons.enableApply(this.enabled&&this.checked!==cachedShowAll);}}},{scriptClass:"mstrmojo.Box",alias:"buttons",cssClass:"buttonBox",children:[$NWB(mstrmojo.desc(8473,"Done"),function(){var popup=this.parent.parent;popup.handleSelectionSubmit(true);},true,{cssDisplay:"inline-block",enabled:false}),$NWB(mstrmojo.desc(221,"Cancel"),function(){var popup=this.parent.parent;popup.handleSelectionSubmit(false);},false,{cssDisplay:"inline-block"})],enableApply:function(isEnabled){this.children[0].set("enabled",isEnabled);}}]}]};},validT:function validT(def){if(def){var t=def.t;if(this.selectFilters){return Math.round(t/10)===52||t===$RW_TYPE.SELECTOR||t===$RW_TYPE.MOJOVISUALIZATION;}else{return Math.round(t/10)===52||t===$RW_TYPE.MOJOVISUALIZATION;}}return false;},setNavIcon:function setNavIcon(shouldShow,isSource){var viz=this.vis,model=viz.model,panelSelector=model.getVizContentPanel().parent.selector,docView=model.controller.view,layoutSelector=docView.layoutViewer.docLayout.selector,rootControl=mstrApp.rootCtrl,tocPanel=rootControl.tocPanel,vizKey=viz.k;if(this.isTocNav){tocPanel.setTOCIcon(shouldShow,isSource);}else{if(isSource||!shouldShow){layoutSelector.setLinkIcon(shouldShow,isSource?model.getLayoutKeyByUnitKey(vizKey):null);}panelSelector.setLinkIcon(shouldShow,isSource&&viz.defn.pnk);}},getTargetKeys:function(){var origTargetKeys=[];$H.forEach(this.targetKeys,function(value,key){if(value.v){origTargetKeys.push(key);}});origTargetKeys.sort($ARR.stringSorter);return this.origTargetKeys=origTargetKeys;},setTargets:function(keys){var targetKeys=this.targetKeys,vis=this.vis,visModel=vis.model,currPanelKey=this.currentPanelKey||visModel.getVizContentPanel().k,filterKeys=[],changes=this.changes,singleUnit=this.singleUnit,srcPanelKey=this.srcPanelKey,filterType=this.filterType;keys=visModel.updateFilterTargetsForSdp(keys);$ARR.forEach(this.an,function(node){if(!targetKeys[node.k]){targetKeys[node.k]={c:false,v:true};}});$H.forEach(targetKeys,function(value,key){if($ARR.some(keys,function(k){return k===key;})){filterKeys.push(key);if(!value.v){value.v=true;value.c=true;}}else{if(value.v){value.v=false;value.c=true;}}});changes.filterKeys=filterKeys;changes.targetKeys=targetKeys;changes.singleUnit=singleUnit;if(singleUnit){changes.unitId=this.unitId;}if(srcPanelKey!==currPanelKey){changes.isNav=true;changes.navPage=currPanelKey;changes.srcKey=srcPanelKey;}changes.sc=this.sc;changes.isFilter=filterType&&filterType.isFilter;var $APP_STATES=mstrmojo.vi.VisualInsightApp.APP_STATES;mstrApp.set("appState",mstrApp.isAppStatePause()?($APP_STATES.PAUSE|$APP_STATES.SELECTOR_TARGETING):$APP_STATES.SELECTOR_TARGETING);this._setTargetsFunc();},_setTargetsFunc:mstrmojo.emptyFn,isSelectionDirty:function isSelectionDirty(keys){var ret=false,keyLength=keys.length,origTargetKeys=this.origTargetKeys,changes=this.changes;keys.sort($ARR.stringSorter);getKeyDifference.call(this,keys);if(keyLength===origTargetKeys.length){$ARR.forEach(keys,function(key,idx){if(key!==origTargetKeys[idx]){ret=true;return false;}});if(ret){return ret;}if(keyLength>0){if(this.cachedFiltertypeIndex!==this.filterType.selectedIndex){return true;}if(changes.isLayerChanged){return true;}if(changes.clearAll!==undefined){return true;}}return false;}return true;},goToPage:function goToPage(evt){var model=this.vis.model,layoutKey=evt.layoutKey,panelKey=evt.panelKey;model.raiseEvent({name:"layoutSelected",panelKey:panelKey,layoutKey:layoutKey});},_tocNavWarn:mstrmojo.emptyFn,onTocPageChange:function(evt){var viss,idx;if(this._super){this._super(evt);}if(this.visible){if(this.srcPanelKey===this.currentPanelKey){viss=this.vis.model.getVizContentPanel().children;if(viss){idx=$ARR.find(viss,"k",this.vis.k);if(idx!==-1){this.vis=viss[idx];}}else{return ;}}this.setNavIcon();if(!this.isTocNav){this.setNavIcon(true,true);}this.isOnTocChange=true;resetDialog.call(this);}},open:function onOpen(){var vis=this.vis;this.shouldNavigate=false;showTargetSelector.call(this);storePanelInfo.call(this);if(vis.setSelectTargetsState){vis.setSelectTargetsState(false);}},close:function close(){var vis=this.vis;mstrApp.rootCtrl.view.closeInlineDialog();restorePanelInfo.call(this);this.targetContainer.addAndRemoveKeys(this.targetContainer.getTargetChildren());var $APP_STATES=mstrmojo.vi.VisualInsightApp.APP_STATES;mstrApp.set("appState",mstrApp.isAppStatePause()?$APP_STATES.PAUSE:$APP_STATES.DEFAULT);cachedShowAll=null;if(vis.setSelectTargetsState){vis.setSelectTargetsState(true);}},cancel:function onCancel(){var model=this.vis.model,layoutKey=model.getLayoutKeyByUnitKey(this.vis.k);var $APP_STATES=mstrmojo.vi.VisualInsightApp.APP_STATES;mstrApp.set("appState",mstrApp.isAppStatePause()?($APP_STATES.PAUSE|$APP_STATES.SELECTOR_TARGETING):$APP_STATES.SELECTOR_TARGETING);model.raiseEvent({name:"layoutSelected",panelKey:this.srcPanelKey,layoutKey:layoutKey});},onwidthChange:function(){if(this.editorNode){this.editorNode.style.width=this.width;}},updateViz:function updateViz(visualization){this.vis=visualization;this.srcPanelKey=this.vis.parent.k;this.targetSelector.set("srcId",this.vis.id);this.shouldNavigate=true;resetDialog.call(this);this.shouldNavigate=false;},toggleFields:function toggleFields(){var filterTypePulldown=this.filterType,cgbs=this.cgbs;if(cgbs.length!==0){this.forType.set("visible",true);}if(this.sc){enableOptions.call(this,true);}if(this.srcPanelKey===(this.currentPanelKey||this.vis.model.getVizContentPanel().k)&&($H.keyarray(this.targetKeys).length>0||cgbs.length!==0)){filterTypePulldown.set("enabled",true);}else{filterTypePulldown.set("enabled",false);filterTypePulldown.set("selectedIndex",0);}},_createTruncatedList:function _createTruncatedList(){var me=this;return{scriptClass:"mstrmojo.vi.ui.TruncatedList",alias:"targetContainer",cssDisplay:"inline-block",items:[{alias:"defaultItem",cls:"tgtDefault",n:mstrmojo.desc(15090,"Please click on visualizations to select targets"),key:"-1"}],padding:12,overflowCls:"truncMore",cmCssClass:"mstrmojo-bar-overflow",setWidth:function setWidth(){var parent=this.parent,myID=this.id,node,padding=this.padding,width=parseInt(parent.width,10);if(!this.width&&$DOM.position(parent.buttonNode).w){$ARR.forEach(parent.children,function(child){node=child.domNode;if(node&&child.id!==myID){width-=Math.ceil($DOM.position(node).w+(child.scriptClass==="mstrmojo.ui.Pulldown"||child.alias==="ctrlOverlay"?0:padding));}});if($DOM.isMac()&&($DOM.isSafari||mstrApp.isWorkstation)){width-=padding;}this.width=width+"px";}this.domNode.style.width=this.width;},getAdditionalProperties:function getItemProperties(item,idx){if(idx===0&&this.items.length>2){item.addCls("hide");}return item;},updateFields:function(){var hasSelection,isFilter=me.filterType&&me.filterType.isFilter;me.numBoxesChecked=this.items.length-1;hasSelection=me.numBoxesChecked>0;me.forType.set("enabled",hasSelection&&isFilter);enableOptions.call(me,hasSelection&&isFilter);},getTargetChildren:function(){return this.items.slice(1);},addAndRemoveKeys:function(keys,shouldAddKeys){var idx,shouldRefresh=false,items=this.items;if(shouldAddKeys){shouldRefresh=true;$ARR.forEach(keys,function(key){if(!key.mp||key.mp===key.k){items.push({n:key.t,cls:"tgtItem",cssClass:"tgtItem",key:key.k});}});}else{$ARR.forEach(keys,function(key){idx=key?$ARR.find(items,"key",key.k||key.key):-1;if(idx>-1){shouldRefresh=true;items.splice(idx,1);}});}if(shouldRefresh){this.refresh();this.updateFields();me.setNavIcon(items.length!==1);}}};},_addVis:function _addVis(vis,targetKeys){var me=this,myVis=me.vis,contentVis=vis.boxContent,isVisMap=contentVis.isVisMap,cgbs=me.cgbs||[],an=me.an,checked,ft,singleCGB,allLayerKeys;if(an){checked=mstrmojo.array.find(an,"k",vis.k)!==-1;}else{if(cgbs.length>0){if(cgbs[0]&&cgbs[0].sc&&cgbs[0].sc.tks){checked=cgbs[0].sc.tks.indexOf(vis.k)>-1;}}}me.numBoxesChecked+=checked?1:0;if(vis!==myVis&&me.validT(vis.defn)){var isICS=vis.defn.t===$RW_TYPE.SELECTOR;if(!isICS){ft=contentVis.getFilterType();singleCGB=contentVis.model.getSelectorControlMapInfo();}if(isVisMap){allLayerKeys=contentVis.getAllLayerKeys(true);$ARR.forEach(allLayerKeys,function(key){targetKeys[key]={c:false,v:checked,ft:ft,cgbs:singleCGB,t:vis.title,k:key,mp:vis.k};});}else{targetKeys[vis.k]={c:false,v:checked,ft:ft,cgbs:singleCGB,t:vis.title,k:vis.k};}}},_addChildren:function _addChildren(){var me=this,myVis=me.vis,model=myVis.model,filterTypePulldown={scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-filter-type",cssDisplay:"inline-block",alias:"filterType",selectedIndex:me.filterType?me.filterType.selectedIndex:this.cachedFiltertypeIndex,isHostedWithin:true,isFilter:true,enabled:false,items:[{n:mstrmojo.desc(8689,"Filter"),v:true},{n:mstrmojo.desc(11953,"Highlight"),v:false}],onitemSelected:function(item){this.isFilter=item.v;enableOptions.call(me,me.numBoxesChecked>0&&this.isFilter);me.forType.set("enabled",this.isFilter);if(this.enabled){notifyApply(model);}},onenabledChange:function(){$CSS.toggleClass(this.domNode,"disabled",!this.enabled);}},cc=[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-title-label",cssDisplay:"inline",allowHTML:true,text:mstrmojo.desc(15031,"Use visualization <span>#</span> to").replace("#",myVis.title),visible:true},filterTypePulldown,{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-type-label",cssDisplay:"inline-block",text:mstrmojo.desc(15032,"data on selection in"),visible:true},me._createTruncatedList(),{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"mstrmojo-for-type",cssDisplay:"inline-block",alias:"forType",value:0,visible:false,selectedIndex:0,isHostedWithin:true,enabled:false,items:[{n:mstrmojo.desc(11955,"for #").replace("#",(this.cgbs[0]||{}).n),v:false},{n:mstrmojo.desc(11956,"for All Data"),v:true}],onitemSelected:function(item){me.changes.forAllData=item.v;},onenabledChange:function(){$CSS.toggleClass(this.domNode,"disabled",!this.enabled);}},me._createOptionsButton()],viss=model.getPanel(this.currentPanelKey,this.currentLayoutKey).children||[],i,targetKeys={};for(i=viss.length-1;i>=0;i--){me._addVis(viss[i],targetKeys);}var contentVis=myVis.boxContent,isVisMap=contentVis&&contentVis.mapViewer&&contentVis.isVisMap;if(isVisMap){var myVisTitle=myVis.title,defaultLine="Use % of <span>#</span> to % the following targets:",lineContent=mstrmojo.desc(15162,defaultLine),lineContents=lineContent.split("%")||[],filterSourceCtrl,layerInfo=$ARR.map(contentVis.getGraphicLayerNameArr(),function(pair){return{n:pair.n,v:pair.k};});if(lineContents.length!==3){lineContents=defaultLine.split("%");}filterSourceCtrl=[{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-title-label",cssDisplay:"inline",allowHTML:true,text:lineContents[0].replace("#",myVisTitle),visible:true},{scriptClass:"mstrmojo.ui.Pulldown",cssClass:"",cssDisplay:"inline-block",alias:"sourceLayer",selectedIndex:$ARR.find(layerInfo,"v",contentVis.getKeyForTemplateSelection()),isHostedWithin:true,enabled:true,items:layerInfo,onitemSelected:function(item){var changes=me.changes;changes.layerKey=item.v;changes.isLayerChanged=item.v!==contentVis.getKeyForTemplateSelection();notifyApply(model);}},{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-title-label",cssDisplay:"inline",allowHTML:true,text:lineContents[1].replace("#",myVisTitle),visible:true},filterTypePulldown,{scriptClass:"mstrmojo.Label",cssClass:"mstrmojo-title-label",cssDisplay:"inline",allowHTML:true,text:lineContents[2].replace("#",myVisTitle),visible:true}];cc.splice(0,3);cc=filterSourceCtrl.concat(cc);}this.addChildren(cc);this.targetKeys=targetKeys;this.csl=this.options.optionEditor.clrSel;},preBuildRendering:function preBuildRendering(){var that=this,myVis=that.vis,model=myVis.model,sc,an,layoutKey,panelKey;setSelectors.call(this,myVis);sc=this.sc;an=this.an;if(this.shouldNavigate&&an&&an.length){layoutKey=model.getLayoutKeyByUnitKey(an[0].k);panelKey=sc&&sc.isNavigation&&sc.navPage;if(panelKey&&panelKey!==this.currentPanelKey){this.shouldNavigate=false;model.raiseEvent({name:"layoutSelected",panelKey:panelKey,layoutKey:layoutKey});}}this._addChildren();this.addChildren([{scriptClass:"mstrmojo.Box",cssClass:"ctrlOverlay",alias:"ctrlOverlay",slot:"buttonNode"}]);this.toggleFields();this._super();},postBuildRendering:function postBuildRendering(){var tc=this.targetContainer,sc=this.sc;this.editorNode.style.width=this.width;this._super();this.changes={};if(cachedShowAll!==(sc?sc.showall:true)){this.changes.clearAll=cachedShowAll;notifyApply(this.vis.model);}showTargetSelector.call(this);if(tc&&!tc.width){tc.setWidth();}if(this.options){this.options.openDialog();}},showControlOverlay:function showControlOverlay(controls,cssClass){var overlay=this.ctrlOverlay,overlayDomNode=overlay.domNode;function clearOverlay(overlay){var children=overlay.children;if(children&&children.length){overlay.removeChildren();children.forEach(function(child){child.destroy();});}}if(overlayDomNode){var overlayCss=["ctrlOverlay","or-h"];if(cssClass){overlayCss.push(cssClass);}overlayDomNode.className=overlayCss.join(" ");}overlay.set("visible",true);clearOverlay(overlay);overlay.addChildren(controls);$CSS.addClass(this.domNode,"overlay");}});}());