(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.rw.selectors.Slider","mstrmojo.vi.ui.rw.selectors.SliderHelper","mstrmojo.hash","mstrmojo.dom","mstrmojo.tooltip","mstrmojo.css","mstrmojo.VisUtility");var $HASH=mstrmojo.hash,$D=mstrmojo.dom,$C=mstrmojo.css,$VISUTIL=mstrmojo.VisUtility;mstrmojo.mapbox.ui.selectors.OveralZoomSlider=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.Slider,null,{scriptClass:"mstrmojo.mapbox.ui.selectors.OveralZoomSlider",thumbWidth:3,cssBkBW:0,sliderDefaultWidth:140,multiSelect:true,disableDnD:false,worldLabel:mstrmojo.desc(8173,"World"),stateLabel:mstrmojo.desc(7676,"State"),cityLabel:mstrmojo.desc(7675,"City"),streetLabel:mstrmojo.desc(13821,"Street"),verticalLineHeight:"0px",markupString:'<div class="mstrmojo-VISlider mstrmojo-Slider {@cssClass} {@clsOrientation} mapbox-overal-zoom-slider" style="{@cssText}" ><div class="sl-title"></div><div class="sl-control"></div><div class="cont" style="position:relative;margin-top:21px;margin-bottom:10px"><div class="bk" style="{@bkCssText}"><div class="ruler" ></div><div class="ruler-label" >{@worldLabel}</div><div class="ruler-gap" ></div><div class="ruler" ></div><div class="ruler-label" >{@stateLabel}</div><div class="ruler-gap" ></div><div class="ruler" ></div><div class="ruler-label" >{@cityLabel}</div><div class="ruler-gap" ></div><div class="ruler" ></div><div class="ruler-label" >{@streetLabel}</div></div><div class="sdc" style="position:absolute;{@sdcCssText}"><div class="sd" style="{@sdCssText}" mstrAttach:click><div class="bk left" style="{@lowerRangeCssText}"></div><div class="t1" style="{@handle1CssText}" mstrAttach:mouseout></div><div class="bk middle" style="{@thumbCssText}"></div><div style="{@handel2CssText}"><div class="t3" mstrAttach:mouseout></div><div class="vertical-line" style="height:{@verticalLineHeight}"></div></div><div class="bk right" style="{@upperRangeCssText}"></div></div></div><div class="mstrmojo-Label subscript left">{@lowText}</div><div class="mstrmojo-Label subscript right">{@highText}</div></div></div>',markupSlots:{titleNode:function(){return this.domNode.firstChild;},controlNode:function(){return this.domNode.childNodes[1];},dndNode:function(){return this.domNode.childNodes[2];},bgNode:function(){return this.domNode.childNodes[2].firstChild;},sdcNode:function(){return this.domNode.childNodes[2].childNodes[1];},containerNode:function(){return this.domNode.childNodes[2].childNodes[1].firstChild;},lowerRange:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.firstChild;},handle1Node:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[1];},thumbNode:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[2];},handle2NodeContainer:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[3];},handle2Node:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[3].firstChild;},upperRange:function(){return this.domNode.childNodes[2].childNodes[1].firstChild.lastChild;},lowNode:function(){return this.domNode.childNodes[2].childNodes[2];},highNode:function(){return this.domNode.childNodes[2].childNodes[3];},tooltipNode:function(){return[this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[1],this.domNode.childNodes[2].childNodes[1].firstChild.childNodes[3]];}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.Widget.enabledMarkupMethod,onwidthChange:function(){this.synchronizeSlider();},onmultiSelectChange:function(){$C.toggleClass(this.domNode,"scm",this.multiSelect);$C.toggleClass(this.domNode,"sc1",!this.multiSelect);},oncurrentZoomLevelChange:function(){var T=this.typeHelper,itm;this.cs2Idx=this.getIndexByValue(this.currentZoomLevel);itm=this.items[this.cs2Idx];if(itm){this.cs2Vl=itm.v;this.cs2Nm=itm.n;}if(T&&T.updateThumb){T.updateThumb();}}},init:function init(p){p=$HASH.copy(p,{isHoriz:true,multiSelect:true,min:0,max:22});if(!p.baseLayer){throw new Error(this.scriptClass+" must be initialized with baseLayer.");}if(!p.items||!p.getIndexByValue){throw new Error(this.scriptClass+" must be initialized with items and getIndexByValue function.");}p.currentZoomLevel=p.baseLayer.getZoom();var currentZoomIndex=p.getIndexByValue(p.currentZoomLevel),selectedIndices={0:true};if(!p.multiSelect){p.selectedIndex=currentZoomIndex;}else{selectedIndices[currentZoomIndex]=true;p.selectedIndices=selectedIndices;}this._super(p);if(p.baseLayer){this.zoomLevelChangeListener=p.baseLayer.attachEventListener("zoomLevelChanged",this.id,function(e){this.set("currentZoomLevel",e.zoomLevel);});}},synchronizeSlider:function synchronizeSlider(){this._super();if(!this.hasRendered){return ;}var rulerScale=[0,5,9,14,22],halfSliderWidth=parseFloat(this.width)/2,unit=this._effectiveLength/22,bgNode=this.bgNode,rulerNodes=bgNode.children,i,leftPosition,style=$C.getComputedStyle(rulerNodes[1]),fontStyle={fontFamily:style.fontFamily,fontSize:style.fontSize,fontStyle:style.fontStyle,fontWeight:style.fontWeight},padding=parseFloat(style.paddingLeft)+parseFloat(style.paddingRight),labelWidth,labelActualWidth,hasLabelTruncated=false;for(i=0;i<4;i++){leftPosition=Math.round((i===0?0:this.thumbWidth/2)+rulerScale[i]*unit)+"px";if(i!==0){rulerNodes[3*i-1].style.left=leftPosition;}labelWidth=Math.round((rulerScale[i+1]-rulerScale[i])*unit+(i===0||i===3?this.thumbWidth/2:0));rulerNodes[3*i+1].style.left=leftPosition;rulerNodes[3*i+1].style.width=labelWidth+"px";labelActualWidth=$VISUTIL.measureTextWidth(rulerNodes[3*i+1].innerText,fontStyle,padding);if(!hasLabelTruncated){hasLabelTruncated=labelActualWidth>labelWidth;}rulerNodes[3*i].style.left="0px";rulerNodes[3*i].style.width=Math.round((rulerScale[i+1]-rulerScale[0])*unit+(i===3?this.thumbWidth:this.thumbWidth/2))+"px";}if(hasLabelTruncated){$C.toggleClass(rulerNodes[1],"left",true);rulerNodes[1].style.width=halfSliderWidth+"px";$C.toggleClass(rulerNodes[4],"hide",true);$C.toggleClass(rulerNodes[7],"hide",true);$C.toggleClass(rulerNodes[10],"right",true);rulerNodes[10].style.width=halfSliderWidth+"px";rulerNodes[10].style.left=halfSliderWidth+"px";}else{$C.toggleClass(rulerNodes[1],"left",false);$C.toggleClass(rulerNodes[4],"hide",false);$C.toggleClass(rulerNodes[7],"hide",false);$C.toggleClass(rulerNodes[10],"right",false);}},updateTypeHelper:function updateTypeHelper(){var Cls=$HASH.walk("mapbox.ui.selectors.OveralSliderHelper",mstrmojo);this.typeHelper=new Cls({slider:this});},createGhost:function createGhost(showGhost){var ghost=this._super(showGhost);ghost.handle2NodeContainer=ghost.handle2Node;ghost.handle2Node=ghost.handle2NodeContainer.firstChild;return ghost;},initDrag:function initDrag(e,hWin){if(this.enabled&&!this.disableDnD){this._super(e,hWin);}},_updateTooltip:function _updateTooltip(e,win){var tgt=$D.eventTarget(win,e),txt,descTxt,posType,tooltipClass,left=null,top=null,txtMarkup='<div class="name">{@content}</div>',descMarkup='<div class="dsc">{@description}</div>',tooltip,showTooltip=false,inDragging=this.dnd.initD!==null;switch(tgt){case this.handle2Node:txt=inDragging?String(this.cs2Nm).replace("$","$$$$"):Number(this.currentZoomLevel).toFixed(4);posType=mstrmojo.tooltip.POS_BOTTOMLEFT;tooltipClass="vi-tooltip-V ";top=0;left=-4;showTooltip=true;break;default:break;}if(showTooltip&&this.enabled){tooltip={cssClass:"mstrmojo-VISlider vi-regular "+tooltipClass+mstrApp.getThemeClassName(),content:txtMarkup.replace(/\{@content\}/g,txt)+(descTxt&&descTxt.length>0?descMarkup.replace(/\{@description\}/g,descTxt):""),contentNodeCssClass:"scm-tooltip",refNode:tgt,posType:posType,left:left,top:top};this.set("richTooltip",tooltip);}},destroy:function dst(skipCleanup){if(this.baseLayer){if(this.zoomLevelChangeListener){this.baseLayer.detachEventListener(this.zoomLevelChangeListener);}delete this.baseLayer;}this._super(skipCleanup);}});mstrmojo.mapbox.ui.selectors.OveralSliderHelper=mstrmojo.declare(mstrmojo.vi.ui.rw.selectors.SliderHelper,null,{scriptClass:" mstrmojo.mapbox.ui.selectors.OveralSliderHelper",updateSummary:function updateSummary(){},updateHandleNodeStyle:function updateHandleNodeStyle(ui,position,handle1,handle2,px){ui.handle1Node.style[position]=handle1+px;ui.handle2NodeContainer.style[position]=handle2+px;}});}());