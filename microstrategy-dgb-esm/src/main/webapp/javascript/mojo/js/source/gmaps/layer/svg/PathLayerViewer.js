(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.graphic.Graphic","mstrmojo.gmaps.geometry.Text","mstrmojo.gmaps.geometry.Polygon","mstrmojo.gmaps.geometry.TangentPath","mstrmojo.gmaps.layer.svg.BubbleLayerViewer");var $MOJO=mstrmojo,$ARR=$MOJO.array,$GMAPS=$MOJO.gmaps,$MUTIL=$GMAPS.MapUtils,$GEOMETRY=$GMAPS.geometry;mstrmojo.gmaps.layer.svg.PathLayerViewer=mstrmojo.declare(mstrmojo.gmaps.layer.svg.BubbleLayerViewer,null,{scriptClass:"mstrmojo.gmaps.layer.svg.PathLayerViewer",textLabelBox:null,textLabel:null,init:function init(props){this._super(props);var graphics=this.graphics=this.graphics||[],labelPosition=graphics[0]&&graphics[0].geoData;var labelGeometry=new $GEOMETRY.Polygon({fillColor:"white",fillOpacity:1,strokeColor:"#000000",strokeWidth:0.8,strokeOpacity:1}),textLabelBox=this.textLabelBox=new $GMAPS.graphic.Graphic({parent:this,attributes:{},geometry:labelGeometry,isText:true});graphics.push(textLabelBox);labelGeometry.getNode().setAttribute("cursor","pointer");if(labelPosition){var text=this.parent&&this.parent.data.n,textGeometry=new $GEOMETRY.Text({text:text,fontFamily:"Roboto",fontSize:"12px",fillColor:"#343434",fillOpacity:1,skipStrokeProperty:true,lat:labelPosition.lat,lng:labelPosition.lng}),textLabel=this.textLabel=new $GMAPS.graphic.Graphic({parent:this,attributes:{},geometry:textGeometry,isText:true});graphics.push(textLabel);textGeometry.getNode().setAttribute("cursor","pointer");}},buildGeometries:function buildGeometries(){$ARR.forEach(this.graphics,function(graphic){if(graphic.isPath){graphic.setGeometry(this.buildPathGeometry(graphic));}else{graphic.setGeometry(this.buildGeometry(graphic));}graphic.setSelection(graphic.isSelected());this.appendGraphicNode(graphic);},this);},buildPathGeometry:function buildPathGeometry(graphic){var geometryFrom=graphic.graphicFrom.geometry,geometryTo=graphic.graphicTo.geometry;if(!geometryFrom||!geometryTo){return ;}return new $GEOMETRY.TangentPath({fillColor:graphic.attributes.fillColor,radiusA:geometryFrom.radius||geometryFrom.outterR,radiusB:geometryTo.radius||geometryTo.outterR,strokeWidth:0,strokeOpacity:1,visibility:"hidden"});},update:function update(){this._super();$MUTIL.showWait();var TEXT_OFFSET_LEFT=-20,TEXT_OFFSET_TOP=10,BOX_OFFSET_LEFT=4,BOX_OFFSET_SIZE=8;var textGeometry=this.textLabel.geometry,textNode=textGeometry.node,x=textGeometry.x+TEXT_OFFSET_LEFT,y=textGeometry.y+TEXT_OFFSET_TOP,w=textNode.clientWidth,h=textNode.clientHeight;textGeometry.update({x:x+BOX_OFFSET_LEFT,y:y+h});this.textLabelBox.geometry.update({screenPolylineArr:[[{x:x,y:y},{x:x+w+BOX_OFFSET_SIZE,y:y},{x:x+w+BOX_OFFSET_SIZE,y:y+h+BOX_OFFSET_SIZE},{x:x,y:y+h+BOX_OFFSET_SIZE},{x:x,y:y}]]});$MUTIL.hideWait();},destroy:function destroy(){$MUTIL.destroyObj(this.textLabelBox);$MUTIL.destroyObj(this.textLabel);delete this.textLabelBox;delete this.textLabel;this._super();}});}());