(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Label","mstrmojo.ui.Checkbox","mstrmojo.RadioButton","mstrmojo.Table","mstrmojo.TextBox","mstrmojo.HBox","mstrmojo.Button","mstrmojo.vi.ui.rw.selectors._HasWarningMessage","mstrmojo.num","mstrmojo.css","mstrmojo.models.FormatModel");mstrmojo.requiresDescs(98,221,309,773,4571,8708,9077,10983,14390,14391,14426,15523,14674,14675,14676,14802,14803,14854,15523,15649);var $P=mstrmojo.vi.ui.rw.selectors.EnumWarningPosition,$CSS=mstrmojo.css,$DESC=mstrmojo.desc,$NM=mstrmojo.num,$ARR=mstrmojo.array,$FORMAT_MODEL=mstrmojo.models.FormatModel,$ENUM_XML_REFRESH=$FORMAT_MODEL.ENUM_PROPERTY_NAMES.REFRESH,$ENUM_XML_TAG_JOIN_ACROSS_DATASET=$FORMAT_MODEL.ENUM_PROPERTY_NAMES.JOIN_ACROSS_DATASET,$ENUM_XML_TAG_JOIN_DATA_COMBINATION=$FORMAT_MODEL.ENUM_PROPERTY_NAMES.MCE_JOIN_TO_GET_DATA_COMBINATION,$ENUM_XML_ON_DEMAND_EVALUATION=$FORMAT_MODEL.ENUM_PROPERTY_NAMES.ON_DEMAND_EVALUATION,CLASS_MULTILINE="multiLine ",CLASS_RADIOGROUP="radioGroup ",CLASS_TOPSPACE="topSpace ",CLASS_DISABLED="docPropsDisabled",CLASS_DATACOMBINATION_HIDDEN="dataComHidden",ENUM_MCE_JOIN={MAX:0,MIN:1},ENUM_JOIN_DATA_COMBINATION={MAX:0,MIN:1};var label=function(label,props){return mstrmojo.hash.copy(props,{scriptClass:"mstrmojo.Label",text:label,cssDisplay:"inline-block",onclick:function(){if(this.series){this.parent[this.series].onclick();}}});},buttonBar=function(label,props){return mstrmojo.hash.copy(props,{scriptClass:"mstrmojo.Button",text:label,cssClass:"mstrmojo-WebButton",bindings:{editor:"this.parent.parent"},postclick:function(){this.editor.close();}});},checkbox=function(props){return mstrmojo.hash.copy(props,{scriptClass:"mstrmojo.ui.Checkbox",cssDisplay:"inline-block"});},radiobutton=function(props){return mstrmojo.hash.copy(props,{scriptClass:"mstrmojo.RadioButton",cssDisplay:"inline-block"});};mstrmojo.vi.ui.editors.DocPropsEditor=mstrmojo.declare(mstrmojo.Editor,[mstrmojo.vi.ui.rw.selectors._HasWarningMessage],{scriptClass:"mstrmojo.vi.ui.editors.DocPropsEditor",cssClass:"mstrmojo-DocProps-Editor",help:"Dossier_Properties_dialog.htm",title:$DESC(15523,"Dossier Properties"),projectLevelMCEJoinSetting:0,dashboardlevelMCEJoinSetting:NaN,init:function init(props){this._super(props);if(!!mstrApp.isWSStyling){this.title=$DESC(14854,"Dossier Properties");}},postBuildRendering:function postBuildRendering(){this._super();this.bindWarningHandler(this);},children:[{scriptClass:"mstrmojo.Table",alias:"editorBody",layout:[{cells:[{},{},{}]},{cells:[{},{},{}],cssClass:CLASS_TOPSPACE+CLASS_MULTILINE},{cells:[{},{},{}],cssClass:CLASS_TOPSPACE+CLASS_MULTILINE},{cells:[{},{},{}],cssClass:CLASS_TOPSPACE+CLASS_MULTILINE+CLASS_RADIOGROUP},{cells:[{},{},{}],cssClass:CLASS_TOPSPACE+CLASS_MULTILINE+CLASS_RADIOGROUP},{cells:[{},{},{}],cssClass:CLASS_TOPSPACE+CLASS_MULTILINE}],children:[label($DESC(773,"Refresh"),{slot:"0,0",series:"enableAuto"}),checkbox({slot:"0,1",alias:"enableAuto",bindings:{checked:"this.parent.parent.propsModel.rf>0"}}),label($DESC(9077,"Automatically refresh every"),{slot:"0,2",series:"enableAuto"}),{scriptClass:"mstrmojo.TextBox",alias:"frequency",slot:"0,2",cssDisplay:"inline-block",validate:function(){var v=this.value,invalidInput=!$NM.isInt(v)||parseInt(v,10)<=0||!(/\S/.test(v));if(this.editor){this.editor.warn({refNode:this.domNode,invalid:this.enabled&&invalidInput});}return !invalidInput;},_set_value:function(n,v){var _changed=this.value!==v;this.value=v;if(this.editor&&this.editor.propsModel){if(this.enabled){if(this.validate()){this.editor.propsModel[$ENUM_XML_REFRESH]=v;}}else{this.editor.propsModel[$ENUM_XML_REFRESH]=0;}}return _changed;},onenabledChange:function(){var val=this.editor&&this.editor.propsModel&&this.editor.propsModel[$ENUM_XML_REFRESH];this.set("value",val||30);},bindings:{enabled:"this.parent.enableAuto.checked",editor:"this.parent.parent",value:"this.parent.parent.propsModel.rf"}},label($DESC(98,"seconds")+" "+$DESC(14802,"(Presentation mode only)"),{slot:"0,2",series:"enableAuto",cssDisplay:"inline"}),label($DESC(4571,"Join Behavior"),{slot:"1,0",series:"allowJoin"}),checkbox({slot:"1,1",alias:"allowJoin",bindings:{checked:"this.parent.parent.propsModel.jad>0"},oncheckedChange:function(){var dm=this.parent.parent.propsModel;if(dm){dm[$ENUM_XML_TAG_JOIN_ACROSS_DATASET]=this.checked?1:0;}}}),label($DESC(14390,"Allow joins across datasets based on unrelated common attributes"),{slot:"1,2",series:"allowJoin",cssClass:"wrap"}),label($DESC(14803,"Data Combination"),{slot:"2,0",series:"inheritDataCombination"}),checkbox({slot:"2,1",alias:"inheritDataCombination",bindings:{enabled:"!mstrApp.isSingleTier",checked:"this.enabled && (this.parent.parent.propsModel.jdc === undefined || this.parent.parent.propsModel.jdc === -1)"},oncheckedChange:function(){var editor=this.parent.parent,dm=editor.propsModel;if(dm&&this.enabled){if(isNaN(editor.dashboardlevelMCEJoinSetting)){editor.dashboardlevelMCEJoinSetting=Math.max(dm[$ENUM_XML_TAG_JOIN_DATA_COMBINATION]||0,0);}}},onclick:function(){if(this.enabled){this.set("checked",!this.checked);}}}),label($DESC(10983,"Inherit value from project-level setting"),{slot:"2,2",alias:"inheritLabel",series:"inheritDataCombination",bindings:{cssClass:'this.parent.inheritDataCombination.enabled ? "wrap" : "wrap docPropsDisabled"'}}),radiobutton({slot:"3,2",alias:"maxRelations",name:"relations",bindings:{enabled:"!this.parent.inheritDataCombination.checked",checked:"(this.enabled && this.parent.parent.propsModel.jdc === 0) || (!this.enabled && this.parent.parent.projectLevelMCEJoinSetting === 0) || !this.parent.inheritDataCombination.enabled"},onenabledChange:function(){var maxRelationsLabel=this.parent.maxRelationsLabel;if(maxRelationsLabel){var cssFunction=this.enabled?$CSS.removeClass:$CSS.addClass;cssFunction.call(this,maxRelationsLabel.domNode,CLASS_DISABLED);}var editor=this.parent.parent,dm=editor.propsModel;if(dm){var propsModelMCEJoinSetting=dm[$ENUM_XML_TAG_JOIN_DATA_COMBINATION]=this.parent.inheritDataCombination.checked?undefined:editor.dashboardlevelMCEJoinSetting;this.set("checked",propsModelMCEJoinSetting?false:true);}},onclick:function(){if(this.enabled){this.set("checked",true);var dm=this.parent.parent.propsModel;if(dm){dm[$ENUM_XML_TAG_JOIN_DATA_COMBINATION]=0;}}}}),label($DESC(14675,"Use maximum relations to join attributes and get complete data combinations (higher memory usage)")+" ("+$DESC(14426,"Deprecated")+")",{slot:"3,2",alias:"maxRelationsLabel",series:"maxRelations",cssClass:"wrap radioText",}),radiobutton({slot:"4,2",alias:"minRelations",name:"relations",bindings:{enabled:"!this.parent.inheritDataCombination.checked",checked:"(this.enabled && this.parent.parent.propsModel.jdc === 1) || (!this.enabled && this.parent.parent.projectLevelMCEJoinSetting === 1)"},onenabledChange:function(){var minRelationsLabel=this.parent.minRelationsLabel;if(minRelationsLabel){var cssFunction=this.enabled?$CSS.removeClass:$CSS.addClass;cssFunction.call(this,minRelationsLabel.domNode,CLASS_DISABLED);}var editor=this.parent.parent,dm=editor.propsModel;if(dm){var propsModelMCEJoinSetting=dm[$ENUM_XML_TAG_JOIN_DATA_COMBINATION]=this.parent.inheritDataCombination.checked?undefined:editor.dashboardlevelMCEJoinSetting;this.set("checked",propsModelMCEJoinSetting?true:false);}},onclick:function(){if(this.enabled){this.set("checked",true);var dm=this.parent.parent.propsModel;if(dm){dm[$ENUM_XML_TAG_JOIN_DATA_COMBINATION]=1;}}}}),label($DESC(14676,"Use minimum relations to join attributes using mostly binary relations (faster, less memory usage)"),{slot:"4,2",alias:"minRelationsLabel",series:"minRelations",cssClass:"wrap radioText"}),label($DESC(309,"Execution mode"),{slot:"5,0",series:"executionMode",}),checkbox({slot:"5,1",alias:"executionMode",bindings:{checked:"this.parent.parent.propsModel.ode > 0"},oncheckedChange:function(){var dm=this.parent.parent.propsModel;if(dm){dm[$ENUM_XML_ON_DEMAND_EVALUATION]=this.checked?1:0;}}}),label($DESC(15649,"Load chapters on demand"),{slot:"5,2",series:"executionMode",cssClass:"wrap"})]},{scriptClass:"mstrmojo.HBox",alias:"btnHBox",slot:"buttonNode",cssClass:"mstrmojo-Editor-buttonBar",children:[buttonBar($DESC(8708,"OK"),{alias:"okBtn",cssClass:"mstrmojo-WebButton hot",onclick:function(){this.editor.onOK();}}),buttonBar($DESC(221,"Cancel"))]}],warn:function warn(error){this.set("validation",mstrmojo.hash.copy(error,{refNode:this.domNode,position:$P.TOP,invalid:true,errorCode:"invalidValueVIWarning"}));var btnHBox=this.btnHbox;if(btnHBox){btnHBox.okBtn.set("enabled",!this.validation.invalid);}},onOpen:function onOpen(){var docModel=this.docModel;this.projectLevelMCEJoinSetting=docModel.isProjectLevelMCEJoinMin()?ENUM_MCE_JOIN.MIN:ENUM_MCE_JOIN.MAX;this.set("propsModel",{rf:docModel[$ENUM_XML_REFRESH],jad:docModel[$ENUM_XML_TAG_JOIN_ACROSS_DATASET],jdc:docModel[$ENUM_XML_TAG_JOIN_DATA_COMBINATION],ode:docModel[$ENUM_XML_ON_DEMAND_EVALUATION]});var editorBody=this.editorBody;var refreshTableElement=editorBody["0,2"];if(refreshTableElement.clientHeight<40){editorBody["0,0"].style.paddingTop="5px";editorBody["0,1"].style.paddingTop="4px";}else{refreshTableElement.style.paddingTop="14px";}var heightOfFirstCheckbox=this.editorBody.maxRelationsLabel.domNode.clientHeight-36;this.editorBody["3,2"].style.paddingBottom=heightOfFirstCheckbox+"px";var hiddenItems=[];if(docModel[$ENUM_XML_TAG_JOIN_DATA_COMBINATION]===ENUM_JOIN_DATA_COMBINATION.MIN){hiddenItems=[editorBody["row-2"],editorBody["row-3"],editorBody["row-4"]];}else{if(docModel[$ENUM_XML_TAG_JOIN_DATA_COMBINATION]===ENUM_JOIN_DATA_COMBINATION.MAX){var dcCheckBox=editorBody.inheritDataCombination,dcLabel=editorBody.inheritLabel;hiddenItems=[dcCheckBox&&dcCheckBox.domNode,dcLabel&&dcLabel.domNode];}}$ARR.forEach(hiddenItems,function(row){$CSS.toggleClass(row,CLASS_DATACOMBINATION_HIDDEN,true);});},onOK:function(){var dm=this.docModel,docCtrl=dm.controller,m=this.propsModel,rf=m[$ENUM_XML_REFRESH],jad=m[$ENUM_XML_TAG_JOIN_ACROSS_DATASET],jdc=m[$ENUM_XML_TAG_JOIN_DATA_COMBINATION],jdcNum=isNaN(jdc)?-1:jdc,ode=m[$ENUM_XML_ON_DEMAND_EVALUATION],formatObject,requestData;if(dm[$ENUM_XML_REFRESH]!==rf){dm[$ENUM_XML_REFRESH]=rf;formatObject=$FORMAT_MODEL.getFormatUpdate($ENUM_XML_REFRESH,rf,formatObject);}if(dm[$ENUM_XML_TAG_JOIN_ACROSS_DATASET]!==jad){dm[$ENUM_XML_TAG_JOIN_ACROSS_DATASET]=jad;formatObject=$FORMAT_MODEL.getFormatUpdate($ENUM_XML_TAG_JOIN_ACROSS_DATASET,jad,formatObject);requestData=true;}if(!mstrApp.isSingleTier||jdcNum!==-1){if(dm[$ENUM_XML_TAG_JOIN_DATA_COMBINATION]!==jdc){dm[$ENUM_XML_TAG_JOIN_DATA_COMBINATION]=jdcNum;formatObject=$FORMAT_MODEL.getFormatUpdate($ENUM_XML_TAG_JOIN_DATA_COMBINATION,jdcNum,formatObject);requestData=true;}}if(dm[$ENUM_XML_ON_DEMAND_EVALUATION]!==ode){dm[$ENUM_XML_ON_DEMAND_EVALUATION]=ode;formatObject=$FORMAT_MODEL.getFormatUpdate($ENUM_XML_ON_DEMAND_EVALUATION,ode,formatObject);}if(formatObject){dm.saveDocProps(formatObject,null,requestData,requestData?docCtrl.getRefreshCallback():null);}}});}());