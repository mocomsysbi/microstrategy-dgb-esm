(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.hash","mstrmojo._HasMarkup");var $DOM=mstrmojo.dom,$HASMARKUP=mstrmojo._HasMarkup,$TAPHOLD,$DOC=mstrmojo.global.document,pressTimer,EVT_TOUCH_START="touchstart",EVT_TOUCH_MOVE="touchmove",EVT_TOUCH_END="touchend",EVT_CONTEXT_MENU="contextmenu";function findSupportContextMenu(nd){var w=$DOM.findWidget(nd);while(w){if(w.hasContextMenuEvent){return w;}w=w.parent;}return null;}function getVerifiedContextMenuWidget(context){var src=context.src,widget=findSupportContextMenu(src&&src.node);if(!widget){return null;}return widget;}onTouchStart:function onTouchStart(e){if(e&&e.touches.length===1){$TAPHOLD.startTapHoldCheck(self,e);}}onMoveDuringCheck:function onMoveDuringCheck(){var c=++$TAPHOLD.ctxt.moveCount;if(c>$TAPHOLD.minMoves){$TAPHOLD.stopTapHoldCheck();if(pressTimer){window.clearTimeout(pressTimer);}}}onEndDuringCheck:function onEndDuringCheck(){$TAPHOLD.stopTapHoldCheck();if(pressTimer){window.clearTimeout(pressTimer);}}mstrmojo.taphold=mstrmojo.taphold||mstrmojo.provide("mstrmojo.taphold",{timeThreshold:750,minMoves:3,startTapHoldCheck:function startTapHoldCheck(hWin,e){delete this.ctxt;var src=$DOM.captureEventInfo({hWin:hWin,e:e});this.ctxt={src:src,moveCount:0};$DOM.attachEvent($DOC,EVT_TOUCH_MOVE,onMoveDuringCheck);$DOM.attachEvent($DOC,EVT_TOUCH_END,onEndDuringCheck);e.name=EVT_CONTEXT_MENU;pressTimer=window.setTimeout(function(){$TAPHOLD.stopTapHoldCheck();var newDOMEvent=$HASMARKUP.newDomEvent(EVT_CONTEXT_MENU,window,e),n;for(n in e){if(!newDOMEvent[n]){newDOMEvent[n]=e[n];}}newDOMEvent.type=EVT_CONTEXT_MENU;$TAPHOLD.triggerContextMenu(newDOMEvent);},this.timeThreshold);},triggerContextMenu:function triggerContextMenu(contextMenuEvent){var context=this.ctxt,widget=getVerifiedContextMenuWidget(context);if(!widget){return ;}if(widget.raiseEvent){widget.raiseEvent(contextMenuEvent);}},stopTapHoldCheck:function stopTapHoldCheck(){$DOM.detachEvent($DOC,EVT_TOUCH_MOVE,onMoveDuringCheck);$DOM.detachEvent($DOC,EVT_TOUCH_END,onEndDuringCheck);},enable:function(){if($DOM.isIOSTouch){$DOM.attachEvent($DOC,EVT_TOUCH_START,onTouchStart);}},disable:function(){$DOM.detachEvent($DOC,EVT_TOUCH_START,onTouchStart);}});$TAPHOLD=mstrmojo.taphold;$TAPHOLD.enable();}());