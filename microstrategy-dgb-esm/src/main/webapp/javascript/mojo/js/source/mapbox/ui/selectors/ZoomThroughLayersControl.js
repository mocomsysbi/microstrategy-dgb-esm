(function(){mstrmojo.requiresCls("mstrmojo.Container","mstrmojo._HasLayout","mstrmojo.mapbox.ui.selectors.OveralZoomSlider","mstrmojo.mapbox.ui.selectors.LayerZoomSlider","mstrmojo.mapbox.ui.selectors._SliderCommon","mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.MapEnums","mstrmojo.tooltip");var $GMAPS=mstrmojo.gmaps,$MUTIL=$GMAPS.MapUtils,$EnumPropertyType=$GMAPS.EnumPropertyType,AUTO_ALIGN_MIN_PX=3,getIndexByValue=mstrmojo.mapbox.ui.selectors._SliderCommon.getIndexByValue;mstrmojo.mapbox.ui.selectors.ZoomThroughLayersControl=mstrmojo.declare(mstrmojo.Container,[mstrmojo._HasLayout,mstrmojo.mapbox.ui.selectors._SliderCommon],{scriptClass:"mstrmojo.mapbox.ui.selectors.ZoomThroughLayersControl",cssClass:"mapbox-control-container mapbox-zoom-through-layers-container",layoutConfig:{w:{containerNode:"100%",leftPadding:"7px",rightPadding:"7px"},xt:true},markupString:'<div class="{@cssClass}" style="{@cssText}" ></div>',markupSlots:{containerNode:function(){return this.domNode;},tooltipNode:function(){return[];}},markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onenabledChange:mstrmojo.mapbox.ui.selectors._SliderCommon.enabledMarkupMethod},init:function init(p){if(!p.host){throw new Error(this.scriptClass+"must be initialized with a host which is a mapbox");}var me=this,host=p.host,mapViewer=host.mapViewer,baseLayer=mapViewer&&mapViewer.baseLayer,children,minZoom=baseLayer.minZoom,maxZoom=baseLayer.maxZoom;children=[{scriptClass:"mstrmojo.mapbox.ui.selectors.OveralZoomSlider",alias:"overalSlider",baseLayer:baseLayer,items:me.generateItems(minZoom,maxZoom),getIndexByValue:getIndexByValue,verticalLineHeight:(8+mapViewer.getGraphicLayerCount()*22)+"px",onselectionChange:function(){var zoomLevel=this.cs2Vl;baseLayer.setZoom(zoomLevel);}}];mapViewer.forEachGraphicLayer(function(graphicLayer){children.push({scriptClass:"mstrmojo.mapbox.ui.selectors.LayerZoomSlider",host:host,layer:graphicLayer,items:me.generateItems(minZoom,maxZoom),getIndexByValue:getIndexByValue,minZoom:minZoom,maxZoom:maxZoom});},true,true);this.children=children;this._super(p);},onLayerSelectionChange:function onLayerSelectionChange(currlayerSlider){if(!currlayerSlider){return null;}var host=this.host,items=currlayerSlider.items,currlayerKey=currlayerSlider.layer.key,lastMinValue,minChanged,currentIdx,children=this.children,layerSlider,layerKey,layer,i,propsToChange={},sliderHelper=currlayerSlider.typeHelper,unit=sliderHelper&&sliderHelper.getUnit(),minDiff=unit>0?AUTO_ALIGN_MIN_PX/unit:AUTO_ALIGN_MIN_PX,shouldAlignToIdx;lastMinValue=currlayerSlider.minLayerZoomLvl;minChanged=lastMinValue!==items[currlayerSlider.min].v;currentIdx=minChanged?currlayerSlider.min:currlayerSlider.max;for(i=1;i<children.length;i++){layerSlider=children[i];layer=layerSlider.layer;layerKey=layer&&layer.key;if(layerKey!==currlayerKey){if(Math.abs(currentIdx-layerSlider.min)<=minDiff){shouldAlignToIdx=layerSlider.min;minDiff=Math.abs(currentIdx-layerSlider.min);}if(Math.abs(currentIdx-layerSlider.max)<=minDiff){shouldAlignToIdx=layerSlider.max;minDiff=Math.abs(currentIdx-layerSlider.max);}}}if($MUTIL.checkDefined(shouldAlignToIdx)){currentIdx=shouldAlignToIdx;}if(currentIdx>=0&&currentIdx<items.length){propsToChange[currlayerKey]={};propsToChange[currlayerKey][minChanged?$EnumPropertyType.minLayerZoomLvl:$EnumPropertyType.maxLayerZoomLvl]=items[currentIdx].v;host.writeMultipleProperties(propsToChange,true);}}});}());