(function(){mstrmojo.requiresCls("mstrmojo.css","mstrmojo.dom","mstrmojo.hash","mstrmojo.tooltip","mstrmojo.vi._MonitorsAppState","mstrmojo.vi.ui.PanelPortlet");var $MOJO=mstrmojo,$CSS=$MOJO.css,$DOM=$MOJO.dom,$HASH=$MOJO.hash,$TOOLTIP=$MOJO.tooltip;function hideCollapseIcon(){$CSS.toggleClass(this.titleBar.leftToolNode,"hidden",this.hideCollapse);}mstrmojo.gmaps.MapLayerPortlet=mstrmojo.declare(mstrmojo.vi.ui.PanelPortlet,[mstrmojo.vi._MonitorsAppState],{scriptClass:"mstrmojo.gmaps.MapLayerPortlet",cssClass:"map-layer-portlet",showTitleBarContextMenu:true,zoomLevelSub:null,getTitleBarCfg:function getTitleBarCfg(){var cfg=this._super(),me=this;if(this.isVisFilterSource){cfg.getTitleChildren=function(){return(this.constructor.prototype.getTitleChildren.call(this)).concat([{scriptClass:"mstrmojo.Button",slot:"textNode",iconClass:"source-vis",useRichTooltip:true,customTooltipHandler:function(e){e.stopPropagation();},updateTooltipConfig:function(){var position=$DOM.position(this.domNode);this.richTooltip={content:mstrmojo.desc(15709,"This layer is used to target other visualizations."),posType:$TOOLTIP.POS_TOPLEFT,cssClass:"vi-regular vi-tooltip-C",top:position.y-position.h+1,left:position.x+position.w+6};}}]);};}cfg.useRichTooltip=true;cfg.shouldShowTooltip=function(){return this.useRichTooltip;};cfg.updateTooltipConfig=function(){if(me.canShowLayer()){this.richTooltip=null;return ;}var position=$DOM.position(this.domNode);this.richTooltip={content:mstrmojo.desc(15710,"This layer is not visible at the current zoom level due to the zoom through layer setting."),posType:$TOOLTIP.POS_TOPLEFT,cssClass:"vi-warning vi-regular vi-tooltip-C",top:position.y-5,left:position.x+position.w+3};};return cfg;},postBuildRendering:function(){this._super();var children=this.children,mapViewer,baseLayer,me=this;if(!children||children.length<2){this.disableExpand();}hideCollapseIcon.call(this);mapViewer=this.getMapViewer();baseLayer=mapViewer&&mapViewer.baseLayer;if(baseLayer){this.zoomLevelSub=baseLayer.attachEventListener("zoomLevelChanged",this.id,function(){me.refreshNodeStatus();});}this.refreshNodeStatus();},refreshNodeStatus:function refreshNodeStatus(){var showCls="state-show",hideCls="state-hide",invisibleCls="state-invisible",eye=$HASH.walk("titleBar.tbToolbar.itemsNode",this),display=this.isLayerVisible&&this.canShowLayer();if(display){this.enableExpand();if(eye){$CSS.removeClass(eye,hideCls);$CSS.removeClass(eye,invisibleCls);$CSS.addClass(eye,showCls);}}else{this.disableExpand();if(eye){$CSS.removeClass(eye,showCls);$CSS.addClass(eye,hideCls);$CSS.toggleClass(eye,invisibleCls,!this.canShowLayer());}}},disableExpand:function disableExpand(){this.togglePortlet(true);this.canCollapse=false;this.titleBar.canCollapse=false;$CSS.addClass(this.domNode,"disableExpand");},enableExpand:function enableExpand(){this.canCollapse=true;this.titleBar.canCollapse=true;$CSS.removeClass(this.domNode,"disableExpand");},destroy:function destroy(){var mapViewer=this.getMapViewer(),baseLayer=mapViewer&&mapViewer.baseLayer,zoomLevelSub=this.zoomLevelSub;if(baseLayer&&zoomLevelSub){baseLayer.detachEventListener(this.zoomLevelSub);}delete this.zoomLevelSub;},getMapViewer:function getMapViewer(){return $HASH.walk("parent.parent.parent.parent.parent.parent.parent.parent",this);},onclick:function onclick(evt){var mapViewer=this.getMapViewer(),host=mapViewer&&mapViewer.parent;if(mstrApp&&mstrApp.isDossier&&host&&host.isInFilterPanel()&&evt){evt.cancel();}}});mstrmojo._HasMarkup.addMarkupMethods(mstrmojo.gmaps.MapLayerPortlet,{onhideCollapseChange:function(){hideCollapseIcon.call(this);}});}());