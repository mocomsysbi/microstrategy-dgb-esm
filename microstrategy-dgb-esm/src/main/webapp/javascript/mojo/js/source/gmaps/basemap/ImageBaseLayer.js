(function(){mstrmojo.requiresCls("mstrmojo.gmaps.MapUtils","mstrmojo.gmaps.layer.BaseLayer","mstrmojo.gmaps.basemap.ImageMap");var $MOJO=mstrmojo,emptyFn=$MOJO.emptyFn,$GMAPS=$MOJO.gmaps,$MUTIL=$GMAPS.MapUtils,ImageMap=$GMAPS.basemap.ImageMap,EVENTS={"extent-change":"extent-change","zoom-start":"zoom-start","zoom-end":"zoom-end",load:"load"};mstrmojo.gmaps.basemap.ImageBaseLayer=mstrmojo.declare(mstrmojo.gmaps.layer.BaseLayer,null,{scriptClass:"mstrmojo.gmaps.basemap.ImageBaseLayer",initBaseMap:function initBaseMap(){this._baseMap=new ImageMap({containerId:this.div_.id});this._baseMap.hide();this.setMapStyle(this.mapStyle);this.addEventListeners();},addEventListeners:function addEventListeners(){this._super(EVENTS);var me=this,_baseMap=this._baseMap,eventListenerArr=me.eventListenerArr=me.eventListenerArr||[];if(!_baseMap){return ;}eventListenerArr.push(_baseMap.on("resize",function(){me.updateForResizing();}));eventListenerArr.push(_baseMap.on("error",function(){me.handleNoInternet();me.updateMapExtent();$MUTIL.hideWait();}));},handleOnLoad:function handleOnLoad(){this._super();var vismap=this.map;if(vismap){vismap.clearMapError();}this.loadBaseMap();$MUTIL.hideWait();this.updateMapExtent();},setExtent:function setExtent(bounds){if(!this._baseMap||!this.map){return ;}this._super(bounds);var _baseMap=this._baseMap;if(_baseMap){_baseMap.setExtent(bounds);}},setMapStyle:function setMapStyle(dv){var _baseMap=this._baseMap,mapViewer=this.parent;if(!dv){this.displayError(mstrmojo.desc(null,"Please configure a valid image URL"));return ;}if(mapViewer&&_baseMap&&dv){mapViewer.hasInit=false;$MUTIL.showWait();_baseMap.setStyle(dv);this.mapStyle=dv;}},getMapStyles:function getMapStyles(){return[this.mapStyle];},getMapStyleData:emptyFn,panBy:function panBy(offset){var _baseMap=this._baseMap;if(_baseMap){_baseMap.panBy(offset);}},handleMouseWheel:function handleMouseWheel(params){if(!params){return ;}var position=params.position,_zoomStep=this._baseMap&&this._baseMap._zoomStep,zoomDelta=(params.zoomDelta>0)?_zoomStep:-_zoomStep,currentZoom=this.getZoom(),newZoom;if(!position||!$MUTIL.checkVal(zoomDelta)||!$MUTIL.checkVal(position.x)||!$MUTIL.checkVal(position.y)||!$MUTIL.checkVal(zoomDelta)){console.log("ImageBaseLayer.handleMouseWheel(): invalid params.");return ;}newZoom=this.validateZoomLevel(currentZoom+zoomDelta);if(newZoom!==currentZoom){this.setZoom(newZoom,position);}},setZoom:function setZoom(level,around){if(!this.isProjectionReady()){return ;}var _baseMap=this._baseMap;if(_baseMap){_baseMap.setZoom(level,around);}},setCenter:function setCenter(rawPoint){var _baseMap=this._baseMap;if(!_baseMap||!rawPoint){return ;}rawPoint.x=$MUTIL.checkVal(rawPoint.x)?rawPoint.x:rawPoint.lng;rawPoint.y=$MUTIL.checkVal(rawPoint.y)?rawPoint.y:rawPoint.lat;_baseMap.setCenter(rawPoint);},isSameCenter:function isSameCenter(prev,curt){return prev.x===curt.x&&prev.y===curt.y;},getLngLatCenter:function getLngLatCenter(){var _baseMap=this._baseMap;if(_baseMap){return _baseMap.getCenter();}},latLngToPixelXY:function latLngToPixelXY(point){var _baseMap=this._baseMap;if(!this.isProjectionReady()||!_baseMap||!point){$MUTIL.log("Catch invalid point");return ;}return _baseMap.toScreen({x:point.lng,y:point.lat});},pixelXYtoLatLng:function pixelXYtoLatLng(pixel){var _baseMap=this._baseMap,rawPoint=_baseMap&&_baseMap.toRaw(pixel);if(this.isProjectionReady()&&rawPoint){return{lng:rawPoint.x,lat:rawPoint.y};}},isProjectionReady:function isProjectionReady(){return !!this.mapStyle;},resize:function resize(width,height){this._super(width,height);var _baseMap=this._baseMap;if(_baseMap){_baseMap.trigger("resize");}},updateXCoordsRange:emptyFn,destroy:function destroy(){var _baseMap=this._baseMap;if(_baseMap){_baseMap.destroy();}this._super();}});})();