(function(){mstrmojo.requiresCls("mstrmojo.qb.EmmaController","mstrmojo.DI.DIConstants","mstrmojo.AS.ASFFSQLRootController");var $DI_CONSTANTS=mstrmojo.DI.DIConstants;mstrmojo.AS.ASQbFFSQLController=mstrmojo.declare(mstrmojo.qb.EmmaController,[mstrmojo.AS.ASFFSQLRootController],{scriptClass:"mstrmojo.AS.ASQbFFSQLController",onFinishButtonClick:function onFinishButtonClick(){var model=mstrApp.rootController.model,dbrs=model.dbrs,tableId=model.tableID,dbr,sql,seq,result;sql=mstrApp.getRootController().rootView.getSQLStatement();seq=sql.split(".");seq=seq[seq.length-1];dbr=dbrs.find(function(obj){return obj.did===model.SelDBRoleID;});result={ns:model.SelNameSpaceID,id:dbr.mdDBRole.did,type:dbr.mdDBRole.db_type,dbr:dbr.mdDBRole.did,dbrn:dbr.mdDBRole.n,sql:sql,dbtn:"Custom Query",n:"Custom Query",name:"Custom Query"};result.connection={connectionType:dbr.mdDBRole.db_type,connectionName:dbr.mdDBRole.n};result.tables=[];result.tables.push({dbr:dbr.mdDBRole.did,dbrn:dbr.mdDBRole.n,ns:model.SelNameSpaceID,type:dbr.mdDBRole.db_type,sql:sql,name:"Custom Query"});this._super(result);},autoMapFFSQL:function autoMapFFSQL(sqlstatement){var controller=mstrApp.getRootController(),model=controller.model;if(sqlstatement===""){model.raiseEvent({name:"dataPreview",mappings:null,dataset:null,selectedColumns:null,isRefined:false});return ;}var clientId=window.mstrAppSchema.workspaceManager.currentClientId,workspaceId=window.mstrAppSchema.workspaceManager.initialWorkspaceId,piplineId="",dbRoleId=model.SelDBRoleID;var formData={clientId:clientId,requestId:"",workspaceId:workspaceId,pipelineId:piplineId,datasource:{dbRoleId:dbRoleId,sql:sqlstatement}};this._super(formData);}});}());