(function(){mstrmojo.requiresCls("mstrmojo.Slider");var $DOM=mstrmojo.dom,$PX="px";function SingleSlider(sl){this.getUnit=function getUnit(){var itemLength=sl.items.length;return itemLength>1?sl._effLen/(itemLength-1):1;};this.calcMinMax=function(pxMin,pxMax){var p=Math.round((pxMin/sl.unit+pxMax/sl.unit)/2);return{min:p,max:p};};this.preUpdateThumb=function(){sl.start=Math.min(sl.min*sl.unit,sl._effLen)+$PX;sl.sdCssText=sl.orCfg.posCssP+":"+sl.start+";";};this.updateThumb=function(){sl.containerNode.style[sl.orCfg.posCssP]=sl.start=Math.min(Math.round(sl.min*sl.unit),sl._effLen)+$PX;sl.moveProgress(parseInt(sl.start,10)+5+"px");};return this;}mstrmojo.Refine.SampleSlider=mstrmojo.declare(mstrmojo.Slider,null,{scriptClass:"mstrmojo.Refine.SampleSlider",markupString:'<div id="{@id}" class="mstrmojo-Slider {@cssClass} {@clsType} {@clsOrientation}" style="{@cssText}" ><div class="cont"><div class="bk" style="{@bkCssText}"><div class="progress" style=""></div></div><div class="sdc" style="position:absolute;{@sdcCssText}" mstrAttach:mouseout><div class="sd" style="{@sdCssText}"><div class="t1"></div><div class="t2"></div><div class="t3"></div></div></div></div></div>',markupSlots:{progressNode:function(){return this.domNode.firstChild.firstChild.firstChild;},dndNode:function(){return this.domNode.firstChild;},bgNode:function(){return this.domNode.firstChild.firstChild;},sdcNode:function(){return this.domNode.firstChild.lastChild;},containerNode:function(){return this.domNode.firstChild.lastChild.firstChild;},frontNode:function(){return this.domNode.firstChild.lastChild.firstChild.firstChild;},thumbNode:function(){return this.domNode.firstChild.lastChild.firstChild.childNodes[1];},endNode:function(){return this.domNode.firstChild.lastChild.firstChild.lastChild;},tooltipNode:function(){return this.domNode.firstChild.lastChild;}},_total:null,init:function init(p){this._super(p);if(p.isHoriz){this.orCfg={posCssP:"left",marginCssP:"marginLeft",lenCssP:"width",lenP:"clientWidth",opPosCssP:"top",thickP:"clientHeight",offsetP:"x"};this.clsOrientation=" sc-h";this._tooltip_pos=mstrmojo.tooltip.POS_BOTTOMLEFT;}else{this.orCfg={posCssP:"top",marginCssP:"marginTop",lenCssP:"height",lenP:"clientHeight",opPosCssP:"left",thickP:"clientWidth",offsetP:"y"};this._tooltip_pos=mstrmojo.tooltip.POS_TOPRIGHT;this.titleHeight=(p.docSelector.fmts.ttl&&p.docSelector.fmts.ttl.height)?parseInt(p.docSelector.fmts.ttl.height,10):0;}this._exRoom=this.thumbWidth;if(this.multiSelect){this._exRoom*=2;}if(p.multiSelect){this.typeHelper=new MultiSlider(this);}else{this.clsType="sc1";this.typeHelper=new SingleSlider(this);}},postBuildRendering:function postBuildRendering(){this._super();this.moveProgress(parseInt(this.start,10)+5+"px");},moveProgress:function(left){var pN=this.progressNode;pN.style.width=left;},ondrag:function ondrag(e,hWin){hWin=hWin||window;var initD=this.dnd.initD,ghostContainerNode=this.ghost.containerNode,minPx,maxPx,lenPx,min=this.min,max=this.max,orientationCfg=this.orCfg,lengthProp=orientationCfg.lenCssP,positionProp=orientationCfg.posCssP;var diff=$DOM.getMousePosition(e,hWin)[orientationCfg.offsetP]-initD.offset;switch(initD.td){case this.thumbNode:minPx=Math.max(Math.min(initD.tP+diff,initD.sL-initD.contL),0);maxPx=minPx+initD.contL;ghostContainerNode.style[positionProp]=minPx+$PX;this.moveProgress(minPx+5+$PX);var minmax=this.typeHelper.calcMinMax(minPx,maxPx);min=minmax.min;max=minmax.max;break;case this.frontNode:minPx=Math.max(Math.min(initD.tP+diff,initD.tP+initD.contL),0);lenPx=Math.max(Math.min(initD.contL-diff,initD.tP+initD.contL),0);ghostContainerNode.style[positionProp]=minPx+$PX;ghostContainerNode.style[lengthProp]=lenPx+$PX;this.moveProgress(minPx+5+$PX);min=Math.min(Math.floor(minPx/this.unit+0.5),this.max);break;case this.endNode:lenPx=Math.max(Math.min(initD.contL+diff,initD.sL-initD.tP),0);maxPx=initD.tP+lenPx;ghostContainerNode.style[lengthProp]=lenPx+$PX;max=Math.max(Math.floor(maxPx/this.unit-0.5),this.min);break;default:return ;}if(min!==this.min||max!==this.max){this.min=min;this.max=max;this.typeHelper.updateThumb();}this._updateTooltip();},onselectionChange:function(){this._super();this.moveProgress(parseInt(this.containerNode.style.left,10)+5+"px");},preBuildRendering:function(){var item_arr=[],sI={},i;for(i=1000;i<=this.max;i++){item_arr[i-1000]={n:i.toString()};}this.items=item_arr;sI[this.initValue-1000]=true;this.selectedIndices=sI;this._super();}});})();