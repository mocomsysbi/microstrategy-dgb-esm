(function(){mstrmojo.requiresCls("mstrmojo.EnumRWUnitType","mstrmojo.vi.viz.EnumVizStyles","mstrmojo.hash","mstrmojo.Button","mstrmojo.vi.ui.rw._IsOutlineXtab","mstrmojo.css");mstrmojo.requiresDescs(619,1442,15963,16112,16113);var $UNIT_TYPES=mstrmojo.EnumRWUnitType,ENUM_VIZ_STYLES=mstrmojo.vi.viz.EnumVizStyles,$HASH=mstrmojo.hash,clsMap={},$ARR=mstrmojo.array,$CFC=mstrmojo.DynamicClassFactory.newComponent;clsMap[$UNIT_TYPES.HEADER]=clsMap[$UNIT_TYPES.FOOTER]=clsMap[$UNIT_TYPES.PAGEHEADER]=clsMap[$UNIT_TYPES.PAGEFOOTER]=clsMap[$UNIT_TYPES.DETAILS]={n:"Section"};clsMap[$UNIT_TYPES.HTMLCONTAINER]={n:"HTMLContainer"};clsMap[$UNIT_TYPES.SELECTOR]={n:"Selector"};clsMap[$UNIT_TYPES.GRID]={n:"Xtab"};clsMap[$UNIT_TYPES.MOJOVISUALIZATION]={n:"MojoVisualization"};function getNodeType(nodeDefn){return(nodeDefn&&nodeDefn.t)||mstrmojo.EnumRWUnitType.LAYOUT;}mstrmojo.DocBuilder=mstrmojo.declare(mstrmojo.Obj,null,{scriptClass:"mstrmojo.DocBuilder",visList:null,selectorFactory:null,classMap:null,init:function init(props){this._super(props);var selectorFactory=this.selectorFactory=this.createSelectorFactory();this.addDisposable(selectorFactory);this.classMap=this.createClassMap();},createSelectorFactory:function createSelectorFactory(){this.throwAbstractMethodError("getSelectorFactory");},createClassMap:function createClassMap(){return $HASH.copy(clsMap);},getMojoVisName:function getMojoVisName(node){var nodeData=node.data,visName=nodeData&&nodeData.visName||"",nodeType=getNodeType(node.defn),v=nodeData&&nodeData.vis;if(!visName){if(v&&(nodeType===$UNIT_TYPES.GRID||nodeType===$UNIT_TYPES.GRAPH||nodeType===$UNIT_TYPES.GRIDGRAPH)){if(v.vn&&v.ve&&v.vm===51){visName=$HASH.walk("dz.visProp.fmt.visStyle",nodeData)||v.vn;}else{if(v.we&&v.wcn){visName=this.visList.findVisName(v.wcn);}}}}if(visName===ENUM_VIZ_STYLES.NEW_GRAPH_MATRIX){if(mstrApp.supportFeature&&mstrApp.supportFeature("ngm")){if(mstrApp.supportFeature("ngmPartial")){if($ARR.indexOf([76,79,80,81,82],$HASH.walk("data.dz.visProp.fmt.visType",node))<0){visName=ENUM_VIZ_STYLES.GRAPH_MATRIX;}}}else{visName=ENUM_VIZ_STYLES.GRAPH_MATRIX;}}return visName;},build:function build(nodes,model,buildConfig){var classMap=this.classMap,arr=[],len=((nodes&&nodes.length)||0),i,node,nodeDefn,nodeData,nodeType,config,visName,fn,w;for(i=0;i<len;i++){node=nodes[i];nodeDefn=node&&node.defn;nodeData=node&&node.data;nodeType=getNodeType(nodeDefn);config=classMap[nodeType];if(model.isMapLayerNode(node.k)){continue;}if(nodeType===$UNIT_TYPES.TEXTFIELD&&((nodeDefn&&nodeDefn.dpst))){config=classMap[nodeType+"B"];}visName=this.getMojoVisName(node);if(visName){nodeData.visName=visName;config=clsMap[$UNIT_TYPES.MOJOVISUALIZATION];}if((visName||nodeType===$UNIT_TYPES.GRID)&&nodeDefn.iifp){config=clsMap[$UNIT_TYPES.SELECTOR];nodeDefn.style=mstrmojo.DocSelector.STYLES.VISUALIZATION;}fn=(config&&config.n)?"new"+config.n:"";w=undefined;if(this[fn]){w=this[fn](model,node,config,buildConfig);}else{if(config&&config.scriptClass){var clazz=config.cls;if(!clazz){clazz=$HASH.walk(config.scriptClass,window);}if(clazz){w=this.newRWUnitInstance(model,node,clazz);}}}if(w){w.k=node.k;w.builder=this;w.tooltip=nodeData.tooltip||nodeDefn.tooltip||"";if(nodeDefn.iifp){w.style=mstrmojo.DocSelector.STYLES.VISUALIZATION;}if(!w.defn){w.defn=nodeDefn;delete w.defn.destroyed;w.disposables.push(w.defn);}if(w.update){w.update(node);}if(this.isPortlet(nodeDefn)){w=this.createPortlet(nodeType,node,w,buildConfig);}if(!this.extractWidget(w,node)){arr.push(w);}}}return arr;},createPortlet:function createPortlet(type,node,w,buildConfig){return w;},newRWUnitInstance:function newRWUnitInstance(model,node,Clazz,props){return new Clazz($HASH.copy(props||{},{id:node.id,node:node,controller:this.parent.controller,model:model}));},newSection:function newSection(model,node){this.throwAbstractMethodError("newSection");},newSelector:function newSelector(model,node,config,buildConfig){var cls=this.selectorFactory.newDocSelector(model,node,config,buildConfig);cls.controller=this.parent.controller;return cls;},isPortlet:function isPortlet(nodeDefn){return !!((nodeDefn.t!==$UNIT_TYPES.PANEL&&nodeDefn.ttl!==undefined)||nodeDefn.qsm);},extractWidget:function extractWidget(widget,node){return !widget;},getDefaultMojoVisModel:function getDefaultMojoVisModel(){this.throwAbstractMethodError("getDefaultMojoVisModel");},newMojoVisualization:function(model,node){var visList=this.visList,nodeData=node.data,visName=nodeData.visName===ENUM_VIZ_STYLES.ESRI_MAP?ENUM_VIZ_STYLES.GOOGLE_MAP:nodeData.visName,visInfo=visList.getVis(visName),viewClassName=visInfo&&((visInfo.dc!==undefined)?visInfo.dc:visInfo.c),me=this;if(!visInfo){var className=nodeData.className,exist=false;if(!className){if(!this._widgetNotFound){this._widgetNotFound=[];}$ARR.forEach(this._widgetNotFound,function(item){if(item.name===visName){exist=true;}});if(!exist){this._widgetNotFound.push({key:nodeData.k,name:visName});}var isDesktopOrWorkstation=mstrApp.isWorkstation,isDesktop=isDesktopOrWorkstation&&FormWrapper.isDesktop(),isLocalFile=isDesktopOrWorkstation&&!(parseInt(FormWrapper.isWSLiveMode(),10)===1),descId=isLocalFile?16113:16112,desc=isLocalFile?'The following custom visualization(s) plug-in(s) used in this dossier are not deployed in $$$$, so the data will be displayed in tabular form:<br>####<br><br>Click on the "plus" button in the Visualizations Gallery to import custom visualization plug-in(s).':"The following custom visualization(s) plug-in(s) used in this dossier are not deployed in your environment, so the data will be displayed in tabular form:<br>####<br><br>Please contact your administrator to deploy these custom visualization plug-in(s).";if(!this._showWarning){this._showWarning=window.setTimeout(function(){var widget=[];$ARR.forEach(this._widgetNotFound,function(item){widget.push(item.name);});mstrmojo.warn(mstrmojo.desc(descId,desc).replace("$$$$",isDesktop?mstrmojo.desc(619,"Desktop"):mstrmojo.desc(15963,"Workstation")).replace("####",widget.join("<br>")),{},{buttons:[{scriptClass:"mstrmojo.Button",text:mstrmojo.desc(1442,"OK"),onclick:function(){delete me._widgetNotFound;delete me._showWarning;}}],allowHTML:true});}.bind(this),0);}var xtab=this.newXtab(model,node);xtab.cssDefault=!!xtab.cssDefault?xtab.cssDefault+" noVis":"noVis";return xtab;}visInfo={dc:className};}var fqcn="mstrmojo."+viewClassName,bundleName=visInfo.b;if(mstrApp.isVI&&visInfo.vib){bundleName=visInfo.vib;}else{if(mstrApp.isExpress&&visInfo.oivmb){bundleName=visInfo.oivmb;}}if(bundleName&&!mstrmojo.loader.isLoaded(fqcn)){mstrmojo.requiresBundle(bundleName);}mstrmojo.requiresCls(fqcn);if(visInfo.lib){var jsRoot=mstrmojo.getJsRoot();var lib=JSON.parse(visInfo.lib);$ARR.forEach(lib,function(item){mstrmojo.requiresDepLib(jsRoot+item[0],item[1]);});}var vizModelName=this.visList.getVis(visName).m,ViewClass=$HASH.walk(viewClassName,mstrmojo),ModelClass=vizModelName?$HASH.walk(vizModelName,mstrmojo):this.getDefaultMojoVisModel();if(!ViewClass||!ModelClass){throw new Error("Missing visualization class.");}ViewClass=visList.getVisClass(ViewClass,node.defn);var vis=new ViewClass($HASH.copy(nodeData.extProps,{id:node.id,node:node,n:node.defn.title,controller:this.parent.controller,gb:nodeData.gbys}));var visModel=new ModelClass({xtab:vis,controller:this.parent.controller,docModel:model});vis.setModel(visModel);visModel.set("data",nodeData);return vis;},getModelClassByVisName:function getModelClassByVisName(visName){var vizModelName,ModelClass,vis=this.visList.getVis(visName);if(!vis){return null;}vizModelName=vis.m;ModelClass=vizModelName?$HASH.walk(vizModelName,mstrmojo):this.getDefaultMojoVisModel();return ModelClass;},getEditableXtab:function getEditableXtab(node){this.throwAbstractMethodError("getEditableXtab");},getDefaultXtab:function getDefaultXtab(node){this.throwAbstractMethodError("getDefaultXtab");},getCustomSortXtab:function getCustomSortXtab(){this.throwAbstractMethodError("getCustomSortXtab");},newXtab:function newXtab(model,node,config,buildConfig){var xtab=mstrmojo.all[node.id];if(!xtab){var mojoXtab=node.defn.iics?this.getCustomSortXtab():(node.defn.txi?this.getEditableXtab(node):this.getDefaultXtab(buildConfig));if(node.data&&node.data.olm&&!(node.data.rw&&node.data.rw.row.bc>0)&&!node.defn.txi){mojoXtab=$CFC(mojoXtab,[mstrmojo.vi.ui.rw._IsOutlineXtab]);}xtab=this.newRWUnitInstance(model,node,mojoXtab);xtab.model=this.newXtabModel({xtab:xtab,docModel:model});}else{xtab.set("node",node);xtab.model.set("docModel",model);}return xtab;},newXtabModel:function newXtabModel(params){this.throwAbstractMethodError("newXtabModel");}});mstrmojo.DocBuilder.ClassMapItemType=null;}());