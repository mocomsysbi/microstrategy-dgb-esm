(function(){mstrmojo.requiresCls("mstrmojo.Obj","mstrmojo.locales","mstrmojo.date","mstrmojo.DI.DIConstants","mstrmojo.DI.DIDatabaseHelper");mstrmojo.requiresDescs(2052,2170,2265,3434,3544,4530,4699,8002,8984,9614,9919,9920,9921,9922,12491,12492,12493,12494,12495,12509,12771,13031,13131,13132,13980,13981,8536);var constants=mstrmojo.DI.DIConstants,dataTypeMenuItems=constants.dataTypeMenuItems,rdcsFlag=constants.rdcsFlag,$DOM=mstrmojo.dom,$ARR=mstrmojo.array;mstrmojo.DI.DIHelpers=mstrmojo.declare(mstrmojo.Obj,null,null);mstrmojo.DI.DIHelpers.isIE7=function isIE7(){return mstrmojo.dom.isIE7;};mstrmojo.DI.DIHelpers.isIE=function(){return $DOM.isIE||!!$DOM.userAgent.match(/Trident\/7\.0/);};mstrmojo.DI.DIHelpers.isIEOrEdge=function(){return mstrmojo.dom.isEdge||this.isIE();};mstrmojo.DI.DIHelpers.getURLCaption=function(){var caption="";if(mstrApp.diParams&&mstrApp.diParams.EnableURLImport){if(mstrApp.diParams.EnableFileImport){if(mstrApp.isSingleTier){if(window.FormWrapper!==window.client){caption+="File://";}}else{caption+="File://";}}if(mstrApp.diParams.EnableHttpImport){if(caption!==""){caption+=", ";}caption+="Http://, Https://";}if(mstrApp.diParams.EnableFTPImport){if(caption!==""){caption+=", ";}caption+="Ftp://";}}return caption;};mstrmojo.DI.DIHelpers.getUrlTooltip=function getUrlTooltip(){var tooltip="";if(!mstrApp.diParams){return tooltip;}if(!mstrApp.diParams.EnableURLImport){tooltip=mstrmojo.desc(12491,"URL file uploads are currently disabled. Please contact your administrator.");}else{tooltip=mstrmojo.desc(12492,"Use one of the following URL formats to upload your file:")+" ";tooltip+=mstrmojo.DI.DIHelpers.getURLCaption();if(mstrApp.enableFileImport){tooltip+="\r\r";tooltip+=mstrmojo.desc(12493,"'File://' format allows you to upload files in your local machine. For example: File://ComputerName/path/FileName.");}if(mstrApp.enableHttpImport||mstrApp.enableHttpsImport){tooltip+="\r\r";if(mstrApp.enableFileImport){tooltip+=mstrmojo.desc(12494,"Some other examples are:");}else{tooltip+=mstrmojo.desc(12495,"Some examples are:");}}if(mstrApp.enableHttpImport){tooltip+="\r";tooltip+="http://host/path/FileName";tooltip+="\r";tooltip+="https://user:password@host/path/FileName";}if(mstrApp.enableFtpImport){tooltip+="\r";tooltip+="ftp://user:password@host/path/FileName";tooltip+="\r";tooltip+="ftp://user:password@host:port/path/FileName";}}return tooltip;};mstrmojo.DI.DIHelpers.createMSTRObjects=function(simpleObject,excludeTags){var mstrObj,property,i;if(simpleObject.constructor===Array){mstrObj=simpleObject;for(i=0;i<mstrObj.length;i++){mstrObj[i]=mstrmojo.DI.DIHelpers.createMSTRObjects(simpleObject[i],excludeTags);}}else{if(typeof simpleObject==="object"){mstrObj=new mstrmojo.Obj(simpleObject);for(property in simpleObject){if(!excludeTags||excludeTags.indexOf(property)===-1){if(simpleObject.hasOwnProperty(property)){mstrObj.set(property,mstrmojo.DI.DIHelpers.createMSTRObjects(simpleObject[property],excludeTags));}}}}else{mstrObj=simpleObject;}}return mstrObj;};mstrmojo.DI.DIHelpers.getURLParameters=function(url){var i;var params;var retVal=[];if(url){if(url.indexOf("?")>0){url=url.substr(url.indexOf("?")+1);}params=url.split("&");for(i=0;i<params.length;i++){var paramNameValue=params[i].split("=");if(paramNameValue.length===2){retVal[paramNameValue[0]]=paramNameValue[1];}}}return retVal;};mstrmojo.DI.DIHelpers.getBackendSourceType=function(subtype){var backendType=constants.backendSourceSubtype.localFile;switch(subtype){case constants.sourceSubtype.dropbox:backendType=constants.backendSourceSubtype.dropbox;break;case constants.sourceSubtype.bisource:backendType=constants.backendSourceSubtype.bISources;break;case constants.sourceSubtype.clipboard:backendType=constants.backendSourceSubtype.clipboard;break;case constants.sourceSubtype.facebook:backendType=constants.backendSourceSubtype.facebook;break;case constants.sourceSubtype.googleAnalytics:backendType=constants.backendSourceSubtype.googleAnalytics;break;case constants.sourceSubtype.googleBigQuery:backendType=constants.backendSourceSubtype.googleBigQuery;break;case constants.sourceSubtype.googleBigQueryFFSQL:backendType=constants.backendSourceSubtype.googleBigQueryFFSQLModel;break;case constants.sourceSubtype.googleBigQuerySingleTable:backendType=constants.backendSourceSubtype.googleBigQuerySingleTable;break;case constants.sourceSubtype.googleDrive:backendType=constants.backendSourceSubtype.googleDrive;break;case constants.sourceSubtype.hadoop:backendType=constants.backendSourceSubtype.hadoopFileBrowser;break;case constants.sourceSubtype.localFile:backendType=constants.backendSourceSubtype.localFile;break;case constants.sourceSubtype.mdx:backendType=constants.backendSourceSubtype.OLAPSources;break;case constants.sourceSubtype.salesforce:backendType=constants.backendSourceSubtype.salesforce;break;case constants.sourceSubtype.samplefile:backendType=constants.backendSourceSubtype.samplefile;break;case constants.sourceSubtype.searchOnSource:backendType=constants.backendSourceSubtype.searchAsASource;break;case constants.sourceSubtype.twitter:backendType=constants.backendSourceSubtype.twitter;break;case constants.sourceSubtype.url:backendType=constants.backendSourceSubtype.url;break;case constants.sourceSubtype.publicData:backendType=constants.backendSourceSubtype.publicData;break;case constants.sourceSubtype.cloudElement:backendType=constants.backendSourceSubtype.cloudElement;break;}return backendType;};mstrmojo.DI.DIHelpers.getStateParameters=function(state){var i;var params;var retVal=[];if(state.indexOf(":")>=0){params=state.split(":");}else{params=state.split("%3A");}for(i=0;i<params.length;i++){var param=params[i];if(param.substr(2,1)==="_"){retVal[param.substr(0,2)]=param.substr(3);}}return retVal;};mstrmojo.DI.DIHelpers.getExtensionType=function(extension){var ext=extension.toLowerCase(),type;if(ext===".xls"||ext===".xlsx"||ext===".xlsm"){type=constants.xdaType.excel;}else{if(ext===".txt"||ext===".csv"||ext===".tsv"||ext===".prn"){type=constants.xdaType.text;}else{type=0;}}return type;};mstrmojo.DI.DIHelpers.setTablesrc=function(controller,srcWidgetID,tableID){if(srcWidgetID){if(!controller.tablesSrc[srcWidgetID]){controller.tablesSrc[srcWidgetID]=[];}controller.tablesSrc[srcWidgetID].push(tableID);}};function getDataTypeString(dataTypeInt){var dataTypeToBaseFormType={0:2,1:2,2:2,3:2,4:2,5:2,6:2,7:2,8:3,9:3,10:3,11:2,12:2,13:2,14:8,15:9,16:1,17:3,18:3,21:2,22:2,23:3,30:11,31:2,33:3,34:2},columnDataTypeMap={1:constants.columnDataTypes.integer,2:constants.columnDataTypes.integer,6:constants.columnDataTypes.dtdouble,7:constants.columnDataTypes.dtfloat,21:constants.columnDataTypes.integer,22:constants.columnDataTypes.nlong,30:constants.columnDataTypes.bigDecimal,34:constants.columnDataTypes.int64},dtp=dataTypeToBaseFormType[dataTypeInt],ctp=columnDataTypeMap[dataTypeInt],str="";switch(dtp.toString()){case constants.dataTypeMenuItems.NUMBER:switch(ctp){case constants.columnDataTypes.integer:str=mstrmojo.desc(9614,"Integer");break;case constants.columnDataTypes.nlong:str=mstrmojo.desc(13131,"Long");break;case constants.columnDataTypes.int64:str=mstrmojo.desc(13132,"Big Integer");break;case constants.columnDataTypes.dtfloat:str=mstrmojo.desc(8002,"Float");break;case constants.columnDataTypes.dtdouble:str=mstrmojo.desc(2265,"Double");break;case constants.columnDataTypes.bigDecimal:str=mstrmojo.desc(9920,"Big Decimal");break;default:str=mstrmojo.desc(3434,"Number");break;}break;case constants.dataTypeMenuItems.DATE:str=mstrmojo.desc(2052,"Date");break;case constants.dataTypeMenuItems.DATE_TIME:str=mstrmojo.desc(9919,"DateTime");break;case constants.dataTypeMenuItems.TIME:str=mstrmojo.desc(2170,"Time");break;case constants.dataTypeMenuItems.TEXT:str=mstrmojo.desc(3544,"Text");break;case constants.dataTypeMenuItems.HTML_TAG:str=mstrmojo.desc(9921,"HTML Tag");break;case constants.dataTypeMenuItems.PHONE_NUMBER:str=mstrmojo.desc(8984,"Phone Number");break;case constants.dataTypeMenuItems.SYMBOL:str=mstrmojo.desc(4530,"Symbol");break;case constants.dataTypeMenuItems.URL:str=mstrmojo.desc(9922,"URL");break;case constants.dataTypeMenuItems.EMAIL:str=mstrmojo.desc(4699,"Email");break;}return str;}mstrmojo.DI.DIHelpers.getDataTypeString=getDataTypeString;mstrmojo.DI.DIHelpers.parseAlternateSourceValidationResults=function parseAlternateSourceValidationResults(cols){var items=[],origName,origDataType,newName,newDataType,src,isMatch,origCol,newCol;$ARR.forEach(cols,function(col){origName=origDataType=newName=newDataType="";isMatch=(col.vt===3)?1:0;switch(col.vt){case 0:case 1:case 2:case 3:origName=col.n;origDataType=getDataTypeString(col.ddt);src=col.src;newName=src.n;newDataType=getDataTypeString(src.ddt);break;case 4:origName=col.n;origDataType=getDataTypeString(col.ddt);break;case 8:src=col.src;newName=src.n;newDataType=getDataTypeString(src.ddt);break;}origCol=origDataType?origName+"("+origDataType+")":origName;newCol=newDataType?newName+"("+newDataType+")":newName;items.push([origCol,isMatch,newCol]);});return items;};mstrmojo.DI.DIHelpers.getURLFileName=function(url){var idx=url.lastIndexOf("/");return idx>=0&&idx+1!==url.length?url.substr(idx+1):url;};mstrmojo.DI.DIHelpers.isOperationMode=function(v){return v!==undefined&&v!==null;};mstrmojo.DI.DIHelpers.isCtrlKey=function(hWin,e){var evt=e||(hWin||window).event;return evt.ctrlKey||evt.metaKey;};mstrmojo.DI.DIHelpers.isRefreshable=function(model){var k,urlTableCount=0;for(k in model.importSources){var source=model.importSources[k];if(source.type===constants.sourceType.file&&(source.subtype===constants.sourceSubtype.url||source.subtype===constants.sourceSubtype.publicData)){if(!source.sourceInfo||source.sourceInfo.url.indexOf("http://mirror.microstrategy.com/datahub/samples")!==0){urlTableCount++;}}}if(model.getAllTableID().length===urlTableCount&&!mstrApp.diParams.EnableHttpImport&&!mstrApp.diParams.EnableFTPImport&&!mstrApp.diParams.EnableFileImport&&!mstrApp.diParams.EnableURLImport){return false;}return true;};mstrmojo.DI.DIHelpers.strStartsWith=function(str,prefix){return str.indexOf(prefix)===0;};mstrmojo.DI.DIHelpers.adjustDataIdx=function(mappings,idxField){var container=[],columns;if(!mappings||mappings.length===0){return ;}$ARR.forEach(mappings,function(map){columns=map.subColumns;if(columns&&columns.length>1){container=container.concat(columns);}else{container.push(map);}});container.sort(function(a,b){return a[idxField]-b[idxField];});};mstrmojo.DI.DIHelpers.setDataIdx=function(mappings,headers,idxField){if(!headers||headers.length===0){return ;}if(headers[0].hasOwnProperty("clix")){$ARR.forEach(mappings,function(map){var ix=map.ix;map[idxField]=$ARR.find(headers,"clix",ix);if(map.isMultiForm){$ARR.forEach(map.subColumns,function(item){item[idxField]=$ARR.find(headers,"clix",item.ix);});}});}if(headers[0].hasOwnProperty("did")){$ARR.forEach(mappings,function(map){var did=map.did;var idx=$ARR.find(headers,"did",did);if(idx!==-1){map[idxField]=idx;}if(map.isMultiForm){$ARR.forEach(map.subColumns,function(item){idx=$ARR.find(headers,"did",item.did);if(idx!==-1){item[idxField]=idx;}});}});}};mstrmojo.DI.DIHelpers.encodeData=function(v){var r="";if(v!==undefined){if(typeof v==="number"){r=v;}else{r=mstrmojo.string.encodeHtmlString(v,false,true);}}return r;};var FOLDER_SIZE_UNIT={0:"Bytes",1:"KB",2:"MB",3:"GB",4:"TB",5:"PB"};function getFolderSizeUnit(dataTypeInt){return FOLDER_SIZE_UNIT[dataTypeInt]||"unknown";}mstrmojo.DI.DIHelpers.getRoundSize=function getRoundSize(size){var i;for(i=0;(size/1024)>1;i++){size=size/1024;}size=size.toPrecision(3);return size+getFolderSizeUnit(i);};mstrmojo.DI.DIHelpers.findNewElements=function(srcArr,dstArr){var ret=[],idx;if(srcArr&&srcArr.length){$ARR.forEach(dstArr,function(elem){idx=$ARR.indexOf(srcArr,elem);if(idx===-1){ret.push(elem);}});}else{if(dstArr&&dstArr.length){ret=[].concat(dstArr);}}return ret;};mstrmojo.DI.DIHelpers.generateCubeName=function(tableNames){var name,tableNum,MAX_LEN=50;name=tableNames.join(" ");if(name.length>MAX_LEN){name=name.slice(0,MAX_LEN)+"...";}tableNum=tableNames.length;if(tableNum>1){name+=" ("+tableNum+" tables)";}return name;};mstrmojo.DI.DIHelpers.parseValidateSourceResults=function(res){var results={isValidate:true,hasError:false,tbids:[],tableValidate:[],missingColumnTbids:[],mismatchedDatatypeTbids:[],missingTableTbids:[],errorTableTbids:[],missingColumns:{},mismatchedDatatypeColumns:{},missingTablesColumns:{},errorTableErrCode:{},errorTableErrMsg:{}},vts=res&&res.vts;$ARR.forEach(vts,function(table){var tbid=table.tbid,tbvt=table.vt,tbErrorMsg=table.emsg,cols=table.cols||[],isValidate=true,hasError=false,isMissingTable,missingColumns=[],mismatchColumns=[];if(tbvt===1){isValidate=true;}else{switch(tbvt){case constants.backendError.switchingFileType:case constants.backendError.noExternalSession:case constants.backendError.databaseCredentialsNotAvailable:case constants.backendError.CECredentialNotAvailable:case constants.backendError.AuthenticationError:case constants.backendError.shouldBeIgnored:hasError=true;break;}$ARR.forEach(cols,function(col){var vt=col.vt;switch(vt){case 1:mismatchColumns.push(col);break;case 4:missingColumns.push(col);break;}});}if(hasError){results.errorTableTbids.push(tbid);results.errorTableErrCode[tbid]=tbvt;results.errorTableErrMsg[tbid]=tbErrorMsg;results.isValidate=false;results.hasError=true;}isMissingTable=missingColumns.length>0&&missingColumns.length===cols.length;if(missingColumns.length>0||mismatchColumns.length>0){isValidate=false;}else{isValidate=true;}if(isValidate===false){results.isValidate=false;}results.tbids.push(tbid);results.tableValidate.push(isValidate);if(missingColumns.length>0){if(isMissingTable){results.missingTableTbids.push(tbid);results.missingTablesColumns[tbid]=missingColumns;}else{results.missingColumnTbids.push(tbid);results.missingColumns[tbid]=missingColumns;}}if(mismatchColumns.length>0){results.mismatchedDatatypeTbids.push(tbid);results.mismatchedDatatypeColumns[tbid]=mismatchColumns;}});return results;};mstrmojo.DI.DIHelpers.truncate=function(name,strLen,atEnd){if(name&&name.length>strLen){var sepLen=3,charsToShow=strLen-sepLen,frontChars=Math.ceil(charsToShow/2),backChars=Math.floor(charsToShow/2);if(atEnd){return name.substr(0,charsToShow)+"...";}else{return name.substr(0,frontChars)+"..."+name.substr(name.length-backChars);}}else{return name;}};mstrmojo.DI.DIHelpers.getAbsoluteFileName=function(file){var display,pos=file.lastIndexOf("\\");if(pos===-1){pos=file.lastIndexOf("/");}display=file.substring(pos+1,file.length);return display;};mstrmojo.DI.DIHelpers.reevaluatePopupPosition=function(domNode){if(domNode){var elementStyle=domNode.style,elementDisplay=elementStyle.display,left=elementStyle.left,top=elementStyle.top;elementStyle.display="block";if(parseInt(left.substring(0,left.length-2))<0){elementStyle.left="0px";}if(parseInt(top.substring(0,top.length-2))<0){elementStyle.top="0px";}elementStyle.display=elementDisplay;}};mstrmojo.DI.DIHelpers.expandNode=function(widget){var isVisible=widget.visible;widget.set("visible",!isVisible);return !isVisible;};mstrmojo.DI.DIHelpers.normalizeTimestamp=function(timestamp){var ts=timestamp.replace(/-/g,"/");var i=ts.indexOf(".");if(i>0){ts=ts.substring(0,i);}return ts;};mstrmojo.DI.DIHelpers.getBackendErrorStr=function(code,sourceType){var msg="";switch(code){case constants.backendError.switchingFileType:msg=mstrmojo.desc(12509,"Switching the file type is not allowed during republishing or editing the cube.");break;case constants.backendError.noExternalSession:case constants.backendError.databaseCredentialsNotAvailable:case constants.backendError.CECredentialNotAvailable:case constants.backendError.AuthenticationError:msg=mstrmojo.desc(14392,"We do not have the credentials needed to get the data for this table. Please provide the credentials to proceed publishing this table.");break;}return msg;};mstrmojo.DI.DIHelpers.getCommonElements=function(larr,rarr,equalFn){var ret=[],i,j;for(i=0;larr&&i<larr.length;i++){for(j=0;rarr&&j<rarr.length;j++){if(equalFn(larr[i],rarr[j])){ret.push(larr[i]);break;}}}return ret;};mstrmojo.DI.DIHelpers.formatDateAndTime=function(datetimeStr,isUTC){var $D=mstrmojo.date;var $L=mstrmojo.locales;var info,dateInfo,timeInfo,dateStr,timeStr,date;info=$D.parseDateAndOrTime(datetimeStr);dateInfo=info.date;timeInfo=info.time;if(isUTC){date=new Date(Date.UTC(dateInfo.year,dateInfo.month-1,dateInfo.day,timeInfo.hour,timeInfo.min,timeInfo.sec));info=$D.getDateJson(date);dateInfo=info;timeInfo=info;}dateStr=$D.formatDateInfo(dateInfo,$L.datetime.DATEDISPLAYFORMAT);timeStr=$D.formatTimeInfo(timeInfo,$L.datetime.TIMEDISPLAYFORMAT);return dateStr+" "+timeStr;};mstrmojo.DI.DIHelpers.isServerBasedWS=function(){return !!mstrApp.isWorkstation&&!mstrApp.isSingleTier;};mstrmojo.DI.DIHelpers.isLocalWS=function(){return !!mstrApp.isWorkstation&&!!mstrApp.isSingleTier;};mstrmojo.DI.DIHelpers.isDIinVI=function(){return !!mstrApp.isWorkstation&&!!mstrApp.isSingleTier&&!!mstrApp.isPopup;};mstrmojo.DI.DIHelpers.extractFileNameFromHadoopURL=function(url){if(!url){return"";}var firstIndex,fileName;firstIndex=url.lastIndexOf("/")+1;fileName=url.substring(firstIndex);return fileName;};mstrmojo.DI.DIHelpers.extractFileExtensionFromHadoopURL=function(url){if(!url){return"";}var firstIndex,fileName;firstIndex=url.lastIndexOf("/")+1;fileName=url.substring(firstIndex);return fileName.substring(fileName.lastIndexOf(".")+1);};mstrmojo.DI.DIHelpers.isWS=function(){return !!mstrApp.isWorkstation;};mstrmojo.DI.DIHelpers.getEnvObj=function(){var os=(navigator.platform.indexOf("Win")!==-1?"Win":"Mac"),platform=!!mstrApp.isWorkstation?"WS":"Web",env=[];env.push(platform,os);return{ENV:env.join("-"),isWSClient:function(){if(!window.FormWrapper||!window.FormWrapper.isDesktop){return false;}return !window.FormWrapper.isDesktop();},isDesktopClient:function(){if(!window.FormWrapper||!window.FormWrapper.isDesktop){return false;}return window.FormWrapper.isDesktop();},isWeb:function(){return platform==="Web";},isWS:function(){return platform==="WS";},isWin:function(){return os==="Win";},isMac:function(){return os==="Mac";},isDataSet:function(){return mstrApp.placeholder==="DIApp"||mstrApp.placeholder==="mainDIApp"||mstrApp.placeholder==="QBApp";},isDIinVI:function(){return !!mstrApp.isFromVI;},isInDI:function(){return mstrApp.placeholder==="DIApp"||mstrApp.placeholder==="mainDIApp";},isInQB:function(){return mstrApp.placeholder==="QBApp";},isAppSchema:function(){return !!window.mstrAppSchema;},isWebWin:function(){return this.isWeb()&&this.isWin();},isWebMac:function(){return this.isWeb()&&this.isMac();},isWebDataSet:function(){return this.isWeb()&&this.isDataSet();},isWebDossier:function(){return this.isWeb()&&this.isDIinVI();},isWSWin:function(){return this.isWS()&&this.isWin();},isWSMac:function(){return this.isWS()&&this.isMac();},isWSDataSet:function(){return this.isWS()&&this.isDataSet();},isServerBasedWS:mstrmojo.DI.DIHelpers.isServerBasedWS,isWSDossier:function(){return this.isWS()&&this.isDIinVI();},isWSLiveMode:function getWSLiveMode(){return this.isWS()&&parseInt(window.FormWrapper.isWSLiveMode(),10)===1;},isWSDossierLocalMode:function(){return this.isWSDossier()&&!this.isWSLiveMode();},isWebWinDataSet:function(){return this.isWeb()&&this.isWin()&&this.isDataSet();},isWebMacDataSet:function(){return this.isWeb()&&this.isMac()&&this.isDataSet();},isWebWinDossier:function(){return this.isWeb()&&this.isWin()&&this.isDIinVI();},isWebMacDossier:function(){return this.isWeb()&&this.isMac()&&this.isDIinVI();},isWSWinDataSet:function(){return this.isWS()&&this.isWin()&&this.isDataSet();},isWSMacDataSet:function(){return this.isWS()&&this.isMac()&&this.isDataSet();},isWSWinDossier:function(){return this.isWS()&&this.isWin()&&this.isDIinVI();},isWSMacDossier:function(){return this.isWS()&&this.isMac()&&this.isDIinVI();},isStandaloneDataSet:function(){return !this.isDIinVI()&&this.isDataSet();}};};mstrmojo.DI.DIHelpers.isOnetier=function(){return !!mstrApp.isSingleTier;};mstrmojo.DI.DIHelpers.getHierarchyMappingXML=function(oid,hierarchyMaps){var xml="";var drvflg=0,recurisve=1,ot=12;if(hierarchyMaps&&hierarchyMaps[rdcsFlag.ID]){xml+="<mpcs>";xml+="<mpc ";xml+='did="'+hierarchyMaps[rdcsFlag.ID].did+'" drvflg="'+drvflg+(hierarchyMaps[rdcsFlag.ID].n?('" n="'+hierarchyMaps[rdcsFlag.ID].n+'" ot="'):"")+ot+'" recurisve="'+recurisve+'" ';if(!!oid&&oid!==""){xml+='oid="'+oid+'" ';}xml+=">";if(hierarchyMaps[rdcsFlag.JOIN_ID]){xml+="<rdcs>";}for(var fg=rdcsFlag.JOIN_ID;fg<=rdcsFlag.DISTANCE;fg++){if(hierarchyMaps[fg]!==undefined){xml+='<rdc did="'+hierarchyMaps[fg].did+'" fg="'+fg+'"/>';}}if(hierarchyMaps[rdcsFlag.JOIN_ID]){xml+="</rdcs>";}xml+="</mpc>";xml+="</mpcs>";}return xml;};mstrmojo.DI.DIHelpers.getOperationMode=function(){return mstrApp.getRootController().getModel().operationMode;};mstrmojo.DI.DIHelpers.standardizeDBRolesFormat=function standardizeDBRolesFormat(items){var exclude=["att","dbRole","tableMap"],dbInfo,dbRole,dbmsObj,efd,def,cnsr,keyValue,auth,dbp,dbtp,setDbpField=(function(){var TYPE_LIST="list",TYPE_NUM="number",TYPE_TEXT="text";function pushObject(arr,field,value,ids,type,opt){if(arr&&value){if(opt){arr.push({field:field,fieldV:value,IDS:ids,options:opt,tp:type});}else{arr.push({field:field,fieldV:value,IDS:ids,tp:type});}}}return{authenticationmethod:function(arr,value){pushObject(arr,"auth",value,7776,TYPE_LIST,[{IDS:13980,n:mstrmojo.desc(13980),v:"1"},{IDS:13981,n:mstrmojo.desc(13981),v:"4"}]);},databasename:function(arr,value){pushObject(arr,"db",value,8519,TYPE_TEXT);},hostname:function(arr,value){pushObject(arr,"host",value,8533,TYPE_TEXT);},port:function(arr,value){pushObject(arr,"port",value,8534,TYPE_NUM);},server:function(arr,value){pushObject(arr,"svr",value,8536,TYPE_TEXT);}};}());items=Object.keys(items).map(function(key){return mstrmojo.DI.DIHelpers.createMSTRObjects(items[key],exclude);});$ARR.forEach(items,function(ds){$ARR.forEach(ds.tables,function(table){table.dbRole=(table.dbRole&&table.dbRole.oi)||table.dbRole;table.dbmsObj=table.dbmsObj&&table.dbmsObj.oi;dbRole=table.dbRole;if(dbRole){dbRole.dbmsObj=table.dbmsObj;dbmsObj=dbRole.dbmsObj;if(!dbRole.dbms){dbRole.dbms=dbRole.def&&dbRole.def.dbms&&dbRole.def.dbms.did;}}if(!dbmsObj||dbmsObj.DBInfo){return ;}dbmsObj.DBInfo={};dbInfo=dbmsObj.DBInfo;efd=dbRole.efd;if(!efd){return ;}efd.forEach(function(e){def=e.oi&&e.oi.def;if(!def){return ;}dbtp=def.dbtp;if(dbtp){dbRole.db_type=dbtp;dbInfo.dbTypes={dbt:{v:dbtp,n:mstrmojo.desc(mstrmojo.DI.DIDatabaseHelper.getDescriptionIdByDBType(dbtp))}};}cnsr=def.cnsr;if(!cnsr){return ;}dbp=[];auth=null;dbRole.connstr=cnsr;cnsr.split(";").forEach(function(field){keyValue=field.split("=");keyValue[0]=keyValue[0].toLowerCase().trim();if(keyValue[0]==="driver"){dbInfo.driverInstalled=true;}else{if(keyValue[0]==="authenticationmethod"){auth=keyValue;}else{if(setDbpField[keyValue[0]]){setDbpField[keyValue[0]](dbp,keyValue[1]);}}}});if(auth){setDbpField[auth[0]](dbp,auth[1]);}});});});return items;};mstrmojo.DI.DIHelpers.filterDisableSources=function filterDisableSources(sourceType){return $ARR.indexOf(mstrApp.diParams.disabledSources,sourceType)<0;};mstrmojo.DI.DIHelpers.getPopupWindowOptions=function getPopupWindowOptions(){var wnd_settings={};var screenX=window.screenX||window.screenLeft||0,screenY=window.screenY||window.screenTop||0,wndW=800,wndH=600,wnd_options;if(document.body&&document.body.offsetWidth){wndW=document.body.offsetWidth;wndH=document.body.offsetHeight;}if(document.compatMode==="CSS1Compat"&&document.documentElement&&document.documentElement.offsetWidth){wndW=document.documentElement.offsetWidth;wndH=document.documentElement.offsetHeight;}if(window.innerWidth&&window.innerHeight){wndW=window.innerWidth;wndH=window.innerHeight;}if(window.outerWidth){wndW=window.outerWidth;}if(window.outerHeight){wndH=window.outerHeight;}wnd_settings.height=wndH*0.5;wnd_settings.width=wndW*0.8;if(wnd_settings.height<600||isNaN(wnd_settings.height)){wnd_settings.height=600;}if(wnd_settings.width<800||isNaN(wnd_settings.width)){wnd_settings.width=800;}wnd_settings.left=screenX+(wndW-wnd_settings.width)/2;wnd_settings.top=screenY+(wndH-wnd_settings.height)/8;if(this.getEnvObj().isWSWin()&&this.getEnvObj().isDIinVI()){wnd_settings.left=(window.screen.width-wnd_settings.width)/2;wnd_settings.top=(window.screen.height-wnd_settings.height)/2;}wnd_options="width="+wnd_settings.width+",height="+wnd_settings.height;wnd_options+=",toolbar=0,scrollbars=1,status=1,resizable=1,location=1,menuBar=0";wnd_options+=",left="+wnd_settings.left+",top="+wnd_settings.top;return wnd_options;};mstrmojo.DI.DIHelpers.createPopupWindow=function createPopupWindow(url,name){var wnd,wnd_options;wnd_options=this.getPopupWindowOptions();if(!url){url="";}wnd=window.open(url,name,wnd_options);return{wnd:wnd};};mstrmojo.DI.DIHelpers.openPopupWindow=function openPopupWindow(wnd,name,url){var r;if(wnd&&!wnd.closed){wnd.location=url;wnd.focus();}else{r=this.createPopupWindow(url);wnd=r.wnd;if(wnd){wnd.focus();}}return wnd;};mstrmojo.DI.DIHelpers.sendResponse2Window=function sendResponse2Window(response,origin,wnd){var opener;if(wnd){opener=wnd;}else{opener=window.opener;}if(opener){if(origin===undefined){origin=window.location.origin;if(!origin){origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");}}try{if(this.isIE()&&opener.postMessagePassthrough){opener.postMessagePassthrough(response,origin);try{window.open("","_self","");window.close();}catch(e){window.close();}}else{opener.postMessage(response,origin);}}catch(ex){console.log("postMessage error: "+ex);}}};mstrmojo.DI.DIHelpers.convertDataSourceType2SourceType=function convertDataSourceType2SourceType(type){switch(type){case constants.dataSourceType.DROPBOX:return constants.sourceType.dropbox;case constants.dataSourceType.GOOGLE_DRIVE:return constants.sourceType.googleDrive;case constants.dataSourceType.GOOGLE_ANALYTICS:return constants.sourceType.googleAnalytics;case constants.dataSourceType.SALESFORCE:return constants.sourceType.salesforce;case constants.dataSourceType.GOOGLE_BIGQUERY:return constants.sourceType.googleBigQuery;default:return -1;}};mstrmojo.DI.DIHelpers.highlightKeyWords=function highlightKeyWords(keyWord,text,highlightedCssClass){var escapes="\\*.?+$^[](){}|/",searchTextEscaped=keyWord,esc,i;if(keyWord===""){return text;}for(i in escapes){if(escapes.hasOwnProperty(i)){esc=escapes[i];searchTextEscaped=searchTextEscaped.replace(new RegExp("\\"+esc,"g"),"\\"+esc);}}var filterRegExp=new RegExp("("+searchTextEscaped+")","ig");var DELEMITER="\u001E",encode=mstrmojo.string.encodeHtmlString,highlightText;if(filterRegExp.test(text)){text=text.replace(filterRegExp,function(match){return DELEMITER+match+DELEMITER;});highlightText=$ARR.map((text||"").split(DELEMITER),function(v,idx){return(idx%2===0)?encode(v):('<span class="'+highlightedCssClass+'">'+encode(v)+"</span>");});return highlightText.join("");}};mstrmojo.DI.DIHelpers.detectCustomImg=function(name,iconNode){if(!name||!(iconNode.nodeType&&iconNode.nodeType===window.Node.ELEMENT_NODE)){return ;}var _name=name.replace?name.replace(/\s+/g,""):"";var head=document.getElementsByTagName("head")[0];var img=document.createElement("img");img.src="../javascript/mojo/css/images/DI/connectors/"+_name+".png";img.onload=function(){iconNode.style.background="url(../javascript/mojo/css/images/DI/connectors/"+_name+".png) no-repeat";head.removeChild(img);};img.onerror=function(){iconNode.style.background="url(../javascript/mojo/css/images/DI/connectors/default.png) no-repeat";head.removeChild(img);};head.appendChild(img);};mstrmojo.DI.DIHelpers.spliceUrlBySeparator=function(url){var arr=url.split("#");return arr.slice(arr.length/2+1).join("#");};mstrmojo.DI.DIHelpers.isOriginalConnector=function(oid){var connectorList=constants.originalConnector;if(connectorList.elastic===oid||connectorList.tapClicks===oid){return true;}return false;};mstrmojo.DI.DIHelpers.acceptEventFromAncestor=function(target){if(!target){return true;}if(!this.domNode||typeof target.contains!=="function"||!this.hasRendered){return false;}return target.contains(this.domNode);};mstrmojo.DI.DIHelpers.isdbRoleWritable=function(dbRole){if(mstrmojo.DI.DIHelpers.isOnetier()){return true;}else{return dbRole.writable==="1"&&mstrApp.rootController.hasPrivilege(constants.DssXmlPrivileges.DssXmlPrivilegesUseDatabaseInstanceManager);}};mstrmojo.DI.DIHelpers.isdbRoleUsable=function(dbRole){return mstrmojo.DI.DIHelpers.isOnetier()?true:dbRole.usable==="1";};mstrmojo.DI.DIHelpers.applyDriverSuffix=function(DBInfo){if(!DBInfo||!DBInfo.Preferences){return ;}var jsonStr=JSON.stringify(DBInfo),suffixes=DBInfo.Preferences.driverNameSuffix,env=this.getEnvObj();var key="Platform";if(env.isDesktopClient()){key=env.isMac()?"DesktopMac":"DesktopWin";}else{if(env.isWSClient()){key=env.isMac()?"WorkstationMac":"WorkstationWin";}}var suffix=suffixes[$ARR.find(suffixes,"n",key)];return JSON.parse(jsonStr.replace(/!#DRIVERSUFFIX#!/g,suffix?suffix.value:""));};mstrmojo.DI.DIHelpers.isGeo=function(item){return item.georole&&item.georole>0;};mstrmojo.DI.DIHelpers.isTime=function(item){return item.dtp===parseInt(dataTypeMenuItems.DATE,10)||item.dtp===parseInt(dataTypeMenuItems.DATE_TIME,10)||item.dtp===parseInt(dataTypeMenuItems.TIME,10);};}());