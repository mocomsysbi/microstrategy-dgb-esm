(function(){mstrmojo.requiresCls("mstrmojo.func","mstrmojo.dom","mstrmojo.hash","mstrmojo.ServerProxy","mstrmojo.XHRServerTransport","mstrmojo.LoginEditor","mstrmojo.util.ThemeHelper","mstrmojo.SessionManager");function passGraphToServerProxy(key,isAdd){var mthName=(isAdd?"add":"remove")+"LoadingGraph";this.serverProxy[mthName](key);}var isAppInteractive=true,$HASH=mstrmojo.hash,WAIT_BOX_ID="waitBox",HELP_TOPIC_SUFFIX=".htm";function extractChildren(node){return node&&(node.sections||node.subsections||node.objects||node.panels||node.layouts||node.children);}mstrmojo._IsWebApp=mstrmojo.provide("mstrmojo._IsWebApp",{_mixinName:"mstrmojo._IsWebApp",serverProxy:null,init:function init(props){this._super(props);if(!this.serverProxy){this.serverProxy=new mstrmojo.ServerProxy({transport:mstrmojo.XHRServerTransport});}},start:mstrmojo.emptyFn,styleName:"RWDocumentMojoStyle",modelFactory:null,enableWaitBox:false,primaryScdpMap:{},onMobileDevice:function onMobileDevice(){return false;},isTouchApp:function isTouchApp(){return false;},getContentDimensions:function getContentDimensions(supportsFullScreen){return null;},getConfiguration:mstrmojo.emptyFn,setInteractive:function setInteractive(isActive){if(isAppInteractive!==isActive){isAppInteractive=isActive;mstrmojo.dom.toggleSelection(window.document.body,isActive);return true;}return false;},isInteractive:function isInteractive(){return isAppInteractive;},addLoadingGraph:function addLoadingGraph(key){passGraphToServerProxy.call(this,key,true);},removeLoadingGraph:function removeLoadingGraph(key){passGraphToServerProxy.call(this,key);},serverRequest:function serverRequest(params,callback,config){try{callback=callback||{};config=config||{};var mthName=config.src||(arguments.callee&&arguments.callee.caller.name),silent=!this.enableWaitBox||config.silent,hideFailureErr=config.hideFailureErr,me=this;if(!params.noStyle){params.styleName=params.styleName||this.styleName;}callback=mstrmojo.func.wrapMethods(callback,{submission:function(requestId){if(!silent&&mstrmojo.all[WAIT_BOX_ID]){mstrmojo.all[WAIT_BOX_ID].requestId=requestId;}},failure:function(res){if(!silent){res.method=mthName;if(!(mstrApp.isSingleTier&&res.code===403)&&!hideFailureErr){mstrmojo.err(typeof res.mstrerr==="object"?res.mstrerr:res);}}},complete:function(){if(!silent){if(mstrmojo.all[WAIT_BOX_ID]){delete mstrmojo.all[WAIT_BOX_ID].requestId;}me.hideWait();}}});if(!silent){this.showWait(config&&config.waitBoxCfg);}window.setTimeout(function(){me.serverProxy.request(callback,params,!!config.override,config);},0);}catch(ex){mstrmojo.err(ex);}},serverRequestParallelNative:function serverRequestParallelNative(params,callback,nativeQueue){var queue=nativeQueue||new mstrmojo.QueueNative();queue.queueHandle(params,callback);},hasRequests:function hasRequests(){return this.serverProxy.hasRequests();},getWaitBoxPosition:function(){return null;},isWaiting:function isWaiting(){var waitBox=mstrmojo.all[WAIT_BOX_ID];return !!(waitBox&&waitBox.visible);},showWait:function showWait(config){var me=this,waitBox=mstrmojo.all[WAIT_BOX_ID]||mstrmojo.insert({scriptClass:"mstrmojo.Editor",id:WAIT_BOX_ID,cssClass:"mstrWaitBox",draggable:false,refreshOnNextShow:false,showTitle:false,zIndex:99999,counter:0,displayMsg:null,position:null,ondisplayMsgChange:function ondisplayMsgChange(){this.msgfield.set("text",this.displayMsg);},oncounterChange:function oncounterChange(){var counter=this.counter,visible=this.visible;if(counter===0&&visible){this.close();}else{if(counter>0&&!visible){this.open();mstrmojo.dom.center(this.editorNode);var position=this.position||me.getWaitBoxPosition();if(position){var top=position.top,left=position.left;if(top!==undefined){this.set("top",top+"px");}if(left!==undefined){this.set("left",left+"px");}}}}},children:[{scriptClass:"mstrmojo.Box",cssClass:"mstrIcon-wait",alias:"icon"},{scriptClass:"mstrmojo.Label",cssClass:"mstrWaitMsg",alias:"msgfield"},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-Button mstrmojo-WebButton mstrWaitCancel",alias:"cancelBtn",text:mstrmojo.desc(2140,"Cancel")}]});waitBox.cancelBtn.set("visible",!!(config&&config.showCancel));waitBox.cancelBtn.onclick=function(){me.serverProxy.cancelRequests();if(config&&config.onCancel&&config.onCancel instanceof Function){config.onCancel.call(me);}};var position=config&&config.position;if(position&&((position.top||position.left)!==undefined)){waitBox.position=config.position;}else{waitBox.position=null;}waitBox.set("displayMsg",(config&&config.message)||mstrmojo.desc(11960,"Loading Data..."));if(config&&config.cssClass){waitBox.set("cssClass","mstrWaitBox "+((config&&config.cssClass)||""));waitBox.refresh();waitBox.refreshOnNextShow=true;}else{if(waitBox.refreshOnNextShow){waitBox.refresh();waitBox.refreshOnNextShow=false;}}if(!this._waitUserLogin){waitBox.set("counter",waitBox.counter+1);}else{this._waitCounter=this._waitCounter+1;}var timeout;function hideWaitBox(){mstrApp.hideWait();clearTimeout(timeout);}if(config&&config.timeout){timeout=window.setTimeout(function(){hideWaitBox();},config.timeout);}if(config&&config._autoClose){mstrmojo.all.waitBox.curtainNode.onclick=function(){hideWaitBox();};}return waitBox;},hideWait:function hideWait(force){var waitBox=mstrmojo.all[WAIT_BOX_ID];if(this._autoCloseFn){mstrmojo.dom.detachEvent(waitBox.curtainNode,"mousedown",this._autoCloseFn,true);delete this._autoCloseFn;}if(waitBox){waitBox.set("cssClass","mstrWaitBox");if(!this._waitUserLogin){waitBox.set("counter",force?0:Math.max(0,waitBox.counter-1));}else{this._waitCounter=force?0:Math.max(0,waitBox.counter-1);}}},getWaitBox:function(){return mstrmojo.all[WAIT_BOX_ID];},showProgress:mstrmojo.emptyFn,hideProgress:mstrmojo.emptyFn,startSessionManager:function startSessionManager(cfg){var app=mstrApp,canStart=app.enableAutomaticSessionRecovery&&app.maxSessionIdleTime;app.sessionManager=app.addDisposable(new mstrmojo.SessionManager(mstrmojo.hash.copy(cfg,canStart?{timeBeforeSessionTimeoutWarning:mstrApp.timeBeforeSessionTimeoutWarning,maxSessionIdleTime:app.maxSessionIdleTime}:{})));if(canStart){app.sessionManager.start();}},isSessionExpiredError:function isSessionExpiredError(c){var MSI_SERVER_NAME_NOT_INITIALIZED=2147760371,MSI_INVALID_SESSION_ID=2147760372,E_MSI_USERMGR_USER_NOTFOUND=2147758245,E_MSI_CONNECT_FAILED=2147759877;c=(c<0)?(4294967296+parseInt(c,10)):c;switch(c){case MSI_SERVER_NAME_NOT_INITIALIZED:case MSI_INVALID_SESSION_ID:case E_MSI_USERMGR_USER_NOTFOUND:case E_MSI_CONNECT_FAILED:return true;}return false;},onSessionExpired:function onSessionExpired(prevRequest){if(!mstrConfig.features["enable-login-editor"]){var mApp=mstrApp.launchingApp||mstrApp;var params={evt:5005,src:mApp.name+"."+mApp.pageName+".5005"},rwbState=(mApp.docModel&&mApp.docModel.bs)||(mApp.rootCtrl&&mApp.rootCtrl.docCtrl&&mApp.rootCtrl.docCtrl.model&&mApp.rootCtrl.docCtrl.model.bs)||(mApp.docModelData&&mApp.docModelData.bs);if(rwbState){params.rwb=rwbState;}mstrmojo.form.send(params);return ;}if(mstrApp.sessionManager){var waitBox=mstrmojo.all[WAIT_BOX_ID],waitBoxShown=waitBox&&waitBox.counter>0,me=this;this._waitCounter=-1;if(waitBoxShown){this._waitCounter=waitBox.counter-1;me.hideWait(true);}this._waitUserLogin=true;mstrApp.sessionManager.openLoginEditor({success:function(res){me._waitUserLogin=false;if(res&&res.sessionState){if(prevRequest){if(prevRequest.params.sessionState){prevRequest.params.sessionState=res.sessionState;}if(waitBoxShown){waitBox.counter=me._waitCounter;me.showWait();}mstrmojo.xhr.request(prevRequest.method,prevRequest.baseUrl,prevRequest.callback,prevRequest.params);}}},cancelRequests:function(){mstrApp.serverProxy.cancelRequests();}});}},updateSessionState:function updateSessionState(sessionState){this.sessionState=sessionState;},onNavigateOut:mstrmojo.emptyFn,showHelpTopic:function showHelpTopic(topic,alternateHelp){var helpUrlFunc=alternateHelp?alternateHelp+"HelpPath":"helpPath",helpUrl=mstrmojo[helpUrlFunc].call(),isSingleTier=mstrApp.isSingleTier,isWorkstation=mstrApp.isWorkstation,htmIndex=-1;if(topic&&typeof topic==="string"){helpUrl+=topic;}if(isSingleTier||isWorkstation){window.FormWrapper.openPage(helpUrl);}else{mstrApp.openPage(helpUrl);}return false;},getSearchAutoCompleteDelay:function getSearchAutoCompleteDelay(){return parseInt(mstrConfig&&mstrConfig.searchAutoCompleteDelay,10)||200;},getThemeClassName:function getThemeClassName(){return"mojo-theme-light";},openPage:function openPage(url,target){window.open(url,target);},modalEditorChange:function modalEditorChange(id,isOpen){if(mstrApp&&mstrApp.isOIVM&&mstrApp.isOIVM()){if(!mstrApp.modalOpenEditors){mstrApp.modalOpenEditors={};}if(isOpen){mstrApp.modalOpenEditors[id]=true;}else{delete mstrApp.modalOpenEditors[id];}}},parseSecondaryDataProviders:function parseSecondaryDataProviders(res){var i,layout,units,defn=res.defn,layouts=defn&&defn.layouts,lytLength=(layouts&&layouts.length)||0,primaryScdpMap=mstrApp.primaryScdpMap;for(i=0;i<lytLength;i++){layout=layouts[i];units=layout&&layout.units;$HASH.forEach(units,function(v,key){if(v&&v.scdp){primaryScdpMap[key]=v.scdp.split(",");}});}},getPluginsRoot:function(){return((mstrApp.isSingleTier||mstrApp.isWorkstation)?"file://":"")+(this.pluginRoot||(mstrConfig&&mstrConfig.pluginRoot)||"../plugins/");},upload:function(callback,params,data,config,override,webSrvParams,useCache){this.serverProxy.upload(callback,params,data,config,override,webSrvParams,useCache);},getThemeProps:function getThemeProps(subtype){var themeProps;if(mstrApp&&mstrApp.isOIVM&&mstrApp.isOIVM()){if(!mstrApp.themeProps){mstrApp.themeProps=mstrmojo.util.ThemeHelper.getThemePropConfig({layoutstyle:mstrApp.docModel.getCurrentLayoutStyle()});}themeProps=mstrApp.themeProps;}else{themeProps=mstrApp.getRootController().view.themeProps;}return subtype?themeProps[subtype]:themeProps;}});window.$MAPF=function(){return false;};}());