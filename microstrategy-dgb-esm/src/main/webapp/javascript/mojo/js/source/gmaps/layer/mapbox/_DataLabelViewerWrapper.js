(function(){mstrmojo.requiresCls("mstrmojo.array","mstrmojo.hash","mstrmojo.gmaps.MapEnums","mstrmojo.mapbox.MapboxEnums","mstrmojo.gmaps.MapUtils");var $MOJO=mstrmojo,$ARR=$MOJO.array,$H=$MOJO.hash,$MAPBOX=$MOJO.mapbox,ID_SUFFIX=$MAPBOX.ID_SUFFIX,$EnumDataLabelShowOption=$MOJO.gmaps.EnumDataLabelShowOption,$FONT_FAMILIES_MAPPING=$MAPBOX.FONT_FAMILIES_MAPPING;var FONT_FALLBACK=$FONT_FAMILIES_MAPPING.ArialUnicodeMS.normal,DEFAULT_FONT_FAMILY=[$FONT_FAMILIES_MAPPING.Arial.normal,FONT_FALLBACK],DEFAULT_HALO_COLOR="white",DEFAULT_HALO_WIDTH=1;function getFontFamily(dlFontStyle){if(!dlFontStyle){return DEFAULT_FONT_FAMILY;}var fontStyle=dlFontStyle.fontStyle,fontWeight=dlFontStyle.fontWeight,fontFamily=dlFontStyle.fontFamily,fontCfg,key,ret;if(!fontFamily){return DEFAULT_FONT_FAMILY;}key=fontFamily.split(" ").join("");fontCfg=$FONT_FAMILIES_MAPPING[key];if(!fontCfg){return DEFAULT_FONT_FAMILY;}if(fontStyle!=="italic"){if(fontWeight!=="bold"){ret=fontCfg.normal;}else{ret=fontCfg.bold;}}else{if(fontStyle==="italic"){if(fontWeight!=="bold"){ret=fontCfg.italic;}else{ret=fontCfg.bolditalic;}}}return[ret,FONT_FALLBACK];}mstrmojo.gmaps.layer.mapbox._DataLabelViewerWrapper=mstrmojo.provide("mstrmojo.gmaps.layer.mapbox._DataLabelViewerWrapper",{_mixinName:"mstrmojo.gmaps.layer.mapbox._DataLabelViewerWrapper",addDataLabelLayer:function addDataLabelLayer(map){var sourceId=this.getSourceId(),layerId=this.getLayerId()+ID_SUFFIX.DataLabel,_layerIds=this._layerIds,labelConfig=this.execMethodOfParent("getLabelConfig"),dlFontStyle=labelConfig&&labelConfig.dlFontStyle,fontSize=this.getFontSize(),sourceLayer=this.getDataLabelSourceLayer(),lineHeight,layoutPaintProps;if(!sourceId||!this.needLabel()||!dlFontStyle){return ;}lineHeight=parseInt(labelConfig.dlFontHeight)/fontSize;layoutPaintProps={layout:{"text-field":this.getLabelField(labelConfig.dlShowOption),"text-font":getFontFamily(dlFontStyle),"text-size":parseInt(dlFontStyle.fontSize),"text-line-height":lineHeight,"text-allow-overlap":!!labelConfig.showAllDataLabel,"text-offset":this.getLabelTextOffset(),"text-anchor":this.labelTextAnchor,"text-padding":0,visibility:this.isVisible()?"visible":"none"},paint:{"text-color":labelConfig.dlFontStyle.fillColor,"text-halo-color":labelConfig.dlFontStyle.dlFntHaloClr||DEFAULT_HALO_COLOR,"text-halo-width":labelConfig.dlFontStyle.dlFntHaloWidth||DEFAULT_HALO_WIDTH,"text-opacity":this.getFillOpacityForZoomAnimation(1)}};map.addLayer($H.copy(layoutPaintProps,this.getLayerCtrlProps(layerId,"symbol",sourceId,undefined,sourceLayer)));_layerIds.push(layerId);},getLabelField:function getLabelField(showOption){switch(showOption){case $EnumDataLabelShowOption.SHOW_TEXT:return"{labelText}";case $EnumDataLabelShowOption.SHOW_VALUE:return"{labelValues}";case $EnumDataLabelShowOption.SHOW_BOTH:return"{labelText}\n{labelValues}";default:return"";}},getLabelLayerId:function getLabelLayerId(){return this.getLayerId()+ID_SUFFIX.DataLabel;},updateDataLabelLayer:function updateDataLabelLayer(){var map=this.getMapInstance(),layerId=this.getLabelLayerId();if(!map){return ;}if(map.getLayer(layerId)){map.removeLayer(layerId);$ARR.removeItem(this._layerIds,layerId);}this.addDataLabelLayer(map);}});}());