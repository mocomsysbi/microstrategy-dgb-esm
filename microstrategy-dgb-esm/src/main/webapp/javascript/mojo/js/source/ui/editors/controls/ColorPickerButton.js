(function(){mstrmojo.requiresCls("mstrmojo.ui.editors.controls.PreviewButton","mstrmojo.ui.editors.controls.AdvancedColorPicker","mstrmojo.ui.editors.controls.AdvancedColorPickerPopup","mstrmojo.css");var $CSS=mstrmojo.css,$ROUND=Math.round;function showNoFillStyle(noFillNodeStyle){var previewNode=this.previewNode,w=previewNode.clientWidth,h=previewNode.clientHeight,borderSize=previewNode.offsetWidth-w,noFillLineLength=Math.sqrt(w*w+h*h)-borderSize/2,noFillRotation=Math.atan2(h,w)*(-180)/Math.PI;previewNode.style.backgroundColor="#FFFFFF";noFillNodeStyle.display="block";noFillNodeStyle.top=$ROUND((previewNode.offsetHeight+borderSize)/2)+"px";noFillNodeStyle.left=$ROUND((w-noFillLineLength+borderSize)/2)+previewNode.offsetLeft+"px";noFillNodeStyle.width=$ROUND(noFillLineLength)+"px";noFillNodeStyle[mstrmojo.dom.CSS3_TRANSFORM]="rotate("+$ROUND(noFillRotation)+"deg)";}mstrmojo.ui.editors.controls.ColorPickerButton=mstrmojo.declare(mstrmojo.ui.editors.controls.PreviewButton,null,{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",markupMethods:{onvisibleChange:mstrmojo.Widget.visibleMarkupMethod,onselectedValueChange:function(){this.updatePreview();this.colorPicker.set("color",this.selectedValue);},onautoPreviewColorChange:function onautoPreviewColorChange(){this.getPopupWidget().set("autoPreviewColor",this.autoPreviewColor);this.updatePreview();},onenabledChange:function onenabledChange(){$CSS.toggleClass(this.domNode,"disabled",!this.enabled);}},isHostedWithin:false,showGradient:false,showNoFill:true,showAutomatic:false,autoPreviewColor:null,selectedValue:null,init:function init(props){this._super(props);var picker=this.colorPicker;picker.showGradient=this.showGradient;if(this.showNoFill!==undefined){picker.showNoFill=this.showNoFill;picker.showAutomatic=this.showAutomatic;}picker.showAutomatic=this.showAutomatic;$CSS.addWidgetCssClass(this,"mstrmojo-ColorPickerBtn");},preBuildRendering:function preBuildRendering(){this.colorPicker.showNoFill=this.showNoFill;return this._super();},setDimensions:function setDimensions(h,w){this._super(h,w);window.setTimeout(function(){this.updatePreview();}.bind(this),0);},afterLayout:function afterLayout(){var previewNode=this.previewNode,previewNodeStyle=previewNode.style,width=previewNodeStyle.width,offsetWidth=previewNode.offsetWidth;if(offsetWidth>0){previewNodeStyle.width=(offsetWidth-4)+"px";}else{if(width!==""){previewNodeStyle.width=(parseInt(width,10)-4)+"px";}}if(previewNodeStyle.height===""){previewNodeStyle.height=(previewNode.offsetHeight-4)+"px";}},postBuildRendering:function postBuildRendering(){var noFillNode=this.noFillNode=document.createElement("div");noFillNode.style.display="none";noFillNode.className="slash";this.domNode.firstChild.appendChild(noFillNode);this._super();},updatePreview:function updatePreview(){var previewNode=this.previewNode;if(previewNode){var previewColor=this.selectedValue===mstrmojo.ui.editors.controls.AdvancedColorPicker.VAL_AUTOMATIC?this.autoPreviewColor:this.selectedValue;if(previewColor){var previewNodeStyle=previewNode.style;if(previewColor.c1){var gradient=$CSS.buildGradient(previewColor.or,previewColor.c1,previewColor.c2);if(gradient&&gradient.n){previewNodeStyle[$CSS.convertCssToCamelCase(gradient.n)]=gradient.v;}}else{var noGradient=$CSS.buildGradient(0,"0","0");if(noGradient&&noGradient.n){previewNodeStyle[$CSS.convertCssToCamelCase(noGradient.n)]=null;}var showConflict="conflict"===previewColor;$CSS.toggleClass(previewNode,"conflict",showConflict);previewNodeStyle.backgroundColor=!showConflict?previewColor:null;}if(this.showNoFill&&this.noFillNode&&this.enabled){var noFillNodeStyle=this.noFillNode.style;if("transparent"===previewColor){showNoFillStyle.call(this,noFillNodeStyle);}else{noFillNodeStyle.display="none";}}}previewNode.style.backgroundOrigin="border-box";}},getPopupWidget:function getPopupWidget(){return this.colorPicker;},children:[{scriptClass:"mstrmojo.ui.editors.controls.AdvancedColorPickerPopup",alias:"colorPicker",slot:"widgetHostNode",color:this.selectedValue,isHostedWithin:true,colorChanged:function(color){this.parent.set("selectedValue",color);this.close();}}]});}());