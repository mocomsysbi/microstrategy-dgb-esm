(function(){mstrmojo.requiresCls("mstrmojo.Box","mstrmojo.array","mstrmojo.DI.DISourceItemAdmin","mstrmojo.DI.DIConstants","mstrmojo.DI.DISourceItemBox","mstrmojo.ui._HasScroller");mstrmojo.requiresDescs(14456,14459);var $A=mstrmojo.array,$H=mstrmojo.hash,$DIConst=mstrmojo.DI.DIConstants;mstrmojo.DI.DIResourceAdmin=mstrmojo.declare(mstrmojo.Box,[mstrmojo.ui._HasScroller],{scriptClass:"mstrmojo.DI.DIResourceAdmin",selectedSource:null,topLabel:mstrmojo.desc(14459,"Commonly used"),bottomLabel:mstrmojo.desc(14456,"Not commonly used"),markupString:'<div id="{@id}" class="mstrmojo-DI-DIResourceAdmin {@cssClass}" style="{@cssText}"><div class="mstrmojo-DI-DIResourceAdmin-Label top" style="position: relative">{@topLabel}</div><div class="mstrmojo-DI-DIResourceAdmin-Content top cf"></div><div class="mstrmojo-DI-DIResourceAdmin-Label bottom" style="position: relative">{@bottomLabel}</div><div class="mstrmojo-DI-DIResourceAdmin-Content bottom cf"></div></div>',markupSlots:{topContainerNode:function(){return this.domNode.children[1];},bottomContainerNode:function(){return this.domNode.children[3];}},children:[{scriptClass:"mstrmojo.DI.DISourceItemBox",alias:"topBox",slot:"topContainerNode",cssClass:"mstrmojo-DI-DIResourceAdmin-Box top",setSrcLsrs:function(){var ce=!mstrApp.diParams.disableCESource?$DIConst.srcItemTypes.CLOUDELEMENT_CONNECTOR:undefined,cc=!mstrApp.diParams.disableCustomerConnector?$DIConst.srcItemTypes.CUSTOM_CONNECTOR:undefined;return[ce,cc];}},{scriptClass:"mstrmojo.Box",alias:"bottomBox",slot:"bottomContainerNode",cssClass:"mstrmojo-DI-DIResourceAdmin-Box bottom"}],hasCustomScrollbar:true,setupScrollNodes:function(){this.scrollNode=this.domNode;},postBuildRendering:function(){if(this._super){this._super();}this.populateResources();var model=mstrApp.getRootController().model;model.attachEventListener("sourceItemsChange",this.id,this.onsourceItemsChange);model.attachEventListener("windowSizeChanged",this.id,this.adjustSize);},onsourceItemsChange:function(){this.populateResources();},populateResources:function(){var me=this,controller=mstrApp.getRootController(),model=controller.getModel(),sources=[],selectedSource=[],scrollTop=this.domNode.scrollTop;var onSelectChangeFn=function(evt){me.onItemSelectChange(evt);};$A.forEach(model.sourceItems,function(item){var adminItem=$H.copy({scriptClass:"mstrmojo.DI.DISourceItemAdmin",mode:item.selected!==false?"":"add",onselectChange:onSelectChangeFn},$H.clone(item));if(adminItem.selected!==false){selectedSource.push($H.copy({mode:"remove"},adminItem));}else{sources.push(adminItem);}});this.selectedSource=selectedSource||[];this.topBox.addItems(mstrApp.isSingleTier?controller.filterSourcesForOneTier(selectedSource):controller.filterSourcesByPrivileges(selectedSource));this.bottomBox.removeChildren();this.bottomBox.addChildren(mstrApp.isSingleTier?controller.filterSourcesForOneTier(sources):controller.filterSourcesByPrivileges(sources));this.updateScroll(scrollTop);},updateScroll:function(scrollTop){this.domNode.scrollTop=scrollTop;this.updateScrollbars();this.disableScroll(true,false);},onItemSelectChange:function(evt){switch(evt.type){case"add":this.addItem(evt);break;case"remove":this.removeItem(evt);break;}},addItem:function(evt){var me=this,model=mstrApp.getRootController().getModel(),src=evt.src,sources=model.sourceItems,$SrcItemType=$DIConst.sourceItemType,sid,source,idx,item,isCustConnector,isCloudElement;var onSelectChangeFn=function(evt){me.onItemSelectChange(evt);};isCustConnector=(src.sid===$SrcItemType.newConnector);isCloudElement=(src.sid===$SrcItemType.cloudElement);this.bottomBox.removeChildren(src);src.destroy();sid=src.sid;idx=$A.find(sources,isCustConnector||isCloudElement?"oid":"sid",isCustConnector||isCloudElement?src.oid:sid);source=sources[idx];item=$H.copy({scriptClass:"mstrmojo.DI.DISourceItemAdmin",mode:"remove",onselectChange:onSelectChangeFn},$H.clone(source));this.selectedSource.push(item);this.topBox.addItems([item],true);},removeItem:function(evt){var me=this,src=evt.src,model=mstrApp.getRootController().getModel(),sources=model.sourceItems,$SrcItemType=$DIConst.sourceItemType,idx,i,item,adminItem,isCustConnector,isCloudElement;var onSelectChangeFn=function(evt){me.onItemSelectChange(evt);};isCustConnector=(src.sid===$SrcItemType.newConnector);isCloudElement=(src.sid===$SrcItemType.cloudElement);idx=$A.find(this.topBox.children,isCustConnector||isCloudElement?"oid":"sid",isCustConnector||isCloudElement?src.oid:src.sid);if(idx<0){return ;}item=this.topBox.children[idx];this.topBox.removeItems(item);idx=$A.find(this.bottomBox.children,isCustConnector||isCloudElement?"oid":"sid",isCustConnector||isCloudElement?src.oid:src.sid);if(idx>=0){item=this.bottomBox.children[idx];item.set("mode","add");}else{i=$A.find(sources,isCustConnector||isCloudElement?"oid":"sid",isCustConnector||isCloudElement?src.oid:src.sid);if(i>=0){adminItem=$H.copy({scriptClass:"mstrmojo.DI.DISourceItemAdmin",mode:"add",onselectChange:onSelectChangeFn},$H.clone(sources[i]));this.bottomBox.addChildren([adminItem],true);}}idx=$A.find(this.selectedSource,isCustConnector||isCloudElement?"oid":"sid",isCustConnector||isCloudElement?src.oid:src.sid);if(idx>=0){$A.removeIndices(this.selectedSource,idx,1);}},getAdminConfig:function(){var me=this,model=mstrApp.getRootController().getModel(),selected=me.selectedSource,unselected=null,isCustConnector,isCloudElement;if(this.hasRendered){unselected=[];$A.forEach(model.sourceItems,function(source){var sid=source.sid;isCustConnector=(sid===$DIConst.sourceItemType.newConnector);isCloudElement=(sid===$DIConst.sourceItemType.cloudElement);if($A.find(selected,isCustConnector||isCloudElement?"oid":"sid",isCustConnector||isCloudElement?source.oid:sid)<0){unselected.push(isCustConnector||isCloudElement?source.oid:sid);}});}return unselected;},adjustSize:function(evt){var width=Math.floor(parseInt(evt.size.w,10)),numCols,margin;if(isNaN(width)||width<0||!this.domNode){return ;}numCols=Math.floor(width/160);if(numCols>0){margin=Math.floor((width-numCols*160)/2);}if(margin>0){this.topBox.domNode.style.left=margin+"px";this.bottomBox.domNode.style.left=margin+"px";}}});}());