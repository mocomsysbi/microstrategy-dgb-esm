(function(){mstrmojo.requiresCls("mstrmojo.Editor","mstrmojo.Button","mstrmojo.Label","mstrmojo.List","mstrmojo.Pulldown","mstrmojo.ui.ButtonBar","mstrmojo.Box","mstrmojo.ui.Checkbox","mstrmojo.ui.CheckList","mstrmojo.ui.IconTooltipCheckList","mstrmojo.ui.LabelWithIconTooltip","mstrmojo.ValidationTextBox","mstrmojo.hash","mstrmojo.func","mstrmojo.desc","mstrmojo.css","mstrmojo.form","mstrmojo.date","mstrmojo.dom","mstrmojo.alert","mstrmojo.NumberFormat");mstrmojo.requiresDescs(6,7,295,3437,15153,15156,2879,2140,5212,5592,5374,1345,34,5875,29,32,6213,15581,15582,5876,35,15583,2696,18,15631,15632,15633,15634,2033,4604,2058,8378,15836,15837,15838,15839,15840,15841,15842,15843,15846,15847,15849,15948,15956);var $DESC=mstrmojo.desc,$HASH=mstrmojo.hash,$NWB=mstrmojo.Button.newWebButton,$CSS=mstrmojo.css,$ENUM_TABS={GENERAL:0,SECURITY:1,LAYOUT:2},$ENUM_DISPLAY_CONTENT={ALL_CHAPTERS:0,CURRENT_CHAPTER:1,CURRENT_PAGE:2},$ENUM_CONTENT_MODE={FULL_PAGE:1,VISUALIZATIONS:2,BOTH:3},$ENUM_HEADER_FOOTER={DISABLE:0,ENABLE:1};var DEFAULT_EXPORT_OPTIONS={range:$ENUM_DISPLAY_CONTENT.CURRENT_CHAPTER,overviewViz:$ENUM_CONTENT_MODE.FULL_PAGE,paperHeight:"8.5",paperWidth:"11",pageOrientation:-1,mode:0,enableFooter:$ENUM_HEADER_FOOTER.ENABLE,enableHeader:$ENUM_HEADER_FOOTER.ENABLE,pdfPwd:"",selectedTabIndex:$ENUM_TABS.GENERAL,hideTabIndex:undefined};function validateOptions(){return true;}function getExportOptions(){var exOpts={},generalBox=this.general,layoutBox=this.layout;exOpts.range=generalBox.exportChapters.chapterContent.getSelectedItem().v;exOpts.overviewViz=this.singleVis?$ENUM_CONTENT_MODE.VISUALIZATIONS:generalBox.exportIndiVis.checkbox.checked?$ENUM_CONTENT_MODE.BOTH:$ENUM_CONTENT_MODE.FULL_PAGE;exOpts.pageOrientation=generalBox.pageOrientation.oriCheckList.selectedItem.v;exOpts.paperHeight=layoutBox.exportPages.paperSize.sizeOptions.getSelectedItem().eph;exOpts.paperWidth=layoutBox.exportPages.paperSize.sizeOptions.getSelectedItem().epw;exOpts.pageOrientation=layoutBox.pageOrientation.oriCheckList.selectedItem.v;exOpts.mode=0;exOpts.enableHeader=layoutBox.pdfHeader.checkbox.checked?$ENUM_HEADER_FOOTER.ENABLE:$ENUM_HEADER_FOOTER.DISABLE;exOpts.enableFooter=layoutBox.pdfFooter.checkbox.checked?$ENUM_HEADER_FOOTER.ENABLE:$ENUM_HEADER_FOOTER.DISABLE;exOpts.pdfPwd="";return exOpts;}function setExportOptions(exOpts){var generalBox=this.general,layoutBox=this.layout;this.exOpts=exOpts;generalBox.exportChapters.chapterContent.set("selectedIndex",getSelectIndexFromValue(chapterContentItems,exOpts.range));generalBox.exportIndiVis.checkbox.set("checked",exOpts.overviewViz===$ENUM_CONTENT_MODE.BOTH);generalBox.pageOrientation.oriCheckList.set("selectedIndex",getSelectIndexFromValue(oriCheckListItems,exOpts.pageOrientation));layoutBox.exportPages.paperSize.sizeOptions.set("selectedIndex",getSelectIndexFromValue(sizeOptionsItems,getSizeOptions(exOpts.paperWidth,exOpts.paperHeight)));layoutBox.pageOrientation.oriCheckList.set("selectedIndex",getSelectIndexFromValue(oriCheckListItems,exOpts.pageOrientation));layoutBox.pdfHeader.set("checked",exOpts.enableHeader===$ENUM_HEADER_FOOTER.ENABLE);layoutBox.pdfFooter.set("checked",exOpts.enableFooter===$ENUM_HEADER_FOOTER.ENABLE);}var chapterContentItems=[{n:$DESC(2058,"All"),v:$ENUM_DISPLAY_CONTENT.ALL_CHAPTERS},{n:$DESC(15846,"Current Chapter"),v:$ENUM_DISPLAY_CONTENT.CURRENT_CHAPTER}];var sizeOptionsItems=[{n:$DESC(1345,'A3 11.69" x 16.54"'),eph:"11.69",epw:"16.54"},{n:$DESC(34,'A4 8.27" x 11.69"'),eph:"8.27",epw:"11.69"},{n:$DESC(5875,'A5 5.83" x 8.27"'),eph:"5.83",epw:"8.27"},{n:$DESC(29,'Letter 8.5" x 11"'),eph:"8.5",epw:"11"},{n:$DESC(32,'Legal 8.5" x 14"'),eph:"8.5",epw:"14"},{n:$DESC(6213,'Ledger 11" x 17"'),eph:"11",epw:"17"},{n:$DESC(15581,'B4 13.9" x 9.8"'),eph:"13.9",epw:"9.8"},{n:$DESC(15582,'B5 9.8" x 6.9"'),eph:"9.8",epw:"6.9"},{n:$DESC(5876,'Executive 7.25" x 10.5"'),eph:"7.25",epw:"10.5"},{n:$DESC(35,'Folio 8.5" x 13"'),eph:"8.5",epw:"13"},{n:$DESC(15583,'Statement 5.5" x 8.5"'),eph:"5.5",epw:"8.5"}];var oriCheckListItems=[{n:$DESC(4604,"Auto"),tx:true,css:"pdfAuto",v:-1},{n:$DESC(6,"Portrait"),css:"pdfPortrait",v:0},{n:$DESC(7,"Landscape"),css:"pdfLandscape",v:1}];function getSizeOptions(width,height){if(parseFloat(width)<parseFloat(height)){return{eph:width,epw:height};}return{eph:height,epw:width};}function getSelectIndexFromValue(items,selectedValue){var selectedIndex=0;if(typeof selectedValue==="object"){var props=$HASH.keyarray(selectedValue);$HASH.forEach(items,function(element,index){if($HASH.equals($HASH.copyProps(props,element),selectedValue)){selectedIndex=index;return false;}});}else{$HASH.forEach(items,function(element,index){if(element.v===selectedValue){selectedIndex=index;return false;}});}return parseInt(selectedIndex);}function getOrientationBox(me){return{scriptClass:"mstrmojo.Box",alias:"pageOrientation",cssClass:"page-orientation",bindings:{visible:"this.parent.parent.basic||this.parent.parent.tabBar.tabs.selectedIndex===2"},children:[{scriptClass:"mstrmojo.Label",text:$DESC(2879,"Orientation")},{scriptClass:"mstrmojo.ui.ButtonBar",renderOnScroll:false,showIcon:true,alias:"oriCheckList",selectedIndex:getSelectIndexFromValue(oriCheckListItems,me.exOpts.pageOrientation),items:oriCheckListItems,postselectionChange:function(evt){me.exOpts.pageOrientation=this.selectedItem.v;me.raiseEvent({name:"updateOrientation"});}}]};}function getChildren(exOpts,basic){var editor=this;return[{scriptClass:"mstrmojo.Box",alias:"tabBar",cssClass:"tabBar",children:[{scriptClass:"mstrmojo.ui.ButtonBar",renderOnScroll:false,showIcon:false,alias:"tabs",selectedIndex:$ENUM_TABS.GENERAL,postselectionChange:function(evt){var exportEditor=this.parent.parent,selectedTab=exportEditor.tabBar.tabs.selectedItem.v,tabs=[exportEditor.general,exportEditor.security,exportEditor.layout];for(var i=0;i<tabs.length;i++){tabs[i].set("visible",i+1==selectedTab);}},items:[{n:$DESC(295,"General"),v:$ENUM_TABS.GENERAL+1},{n:$DESC(2696,"Security"),v:$ENUM_TABS.SECURITY+1},{n:$DESC(3437,"Layout"),v:$ENUM_TABS.LAYOUT+1}]}]},{scriptClass:"mstrmojo.Box",alias:"general",cssClass:"general",children:[{scriptClass:"mstrmojo.Box",alias:"exportChapters",cssClass:"mstrmojo-Pulldown-Box",children:[{scriptClass:"mstrmojo.Label",text:$DESC(5374,"Content")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"chapterContent",selectedIndex:getSelectIndexFromValue(chapterContentItems,exOpts.range),items:chapterContentItems}]},{scriptClass:"mstrmojo.Box",alias:"exportIndiVis",cssClass:"mstrmojo-CheckBoxes-Box",bindings:{visible:"!this.parent.parent.basic"},children:[{scriptClass:"mstrmojo.CheckBox",alias:"checkbox",checked:exOpts.overviewViz===$ENUM_CONTENT_MODE.BOTH?true:false,label:"",oncheckedChange:function(){exOpts.overviewViz=this.checked?$ENUM_CONTENT_MODE.BOTH:$ENUM_CONTENT_MODE.FULL_PAGE;}},{scriptClass:"mstrmojo.ui.LabelWithIconTooltip",text:$DESC(15849,"Export Individual Visualizations"),alias:"iconTooltipLabel",iconCss:"info-icon",tooltip:$DESC(15836,"Visualizations will be exported individually on separate pages.")}]},this.orientationSettings,]},{scriptClass:"mstrmojo.Box",alias:"security",cssClass:"security",visible:false},{scriptClass:"mstrmojo.Box",alias:"layout",cssClass:"layout",visible:false,children:[{scriptClass:"mstrmojo.Box",alias:"exportPages",cssClass:"mstrmojo-Pulldown-Box",children:[{scriptClass:"mstrmojo.Box",alias:"paperSize",children:[{scriptClass:"mstrmojo.Label",text:$DESC(15156,"Paper Size")},{scriptClass:"mstrmojo.ui.Pulldown",alias:"sizeOptions",selectedIndex:getSelectIndexFromValue(sizeOptionsItems,getSizeOptions(exOpts.paperWidth,exOpts.paperHeight)),items:sizeOptionsItems}]}]},this.orientationSettings,{scriptClass:"mstrmojo.Label",cssClass:"wrap",text:$DESC(15839,"Header and Footer")},{scriptClass:"mstrmojo.Box",alias:"pdfHeader",cssClass:"mstrmojo-CheckBoxes-Box",children:[{scriptClass:"mstrmojo.CheckBox",alias:"checkbox",checked:exOpts.enableHeader===$ENUM_HEADER_FOOTER.ENABLE?true:false,label:"",oncheckedChange:function(){exOpts.enableHeader=this.checked?$ENUM_HEADER_FOOTER.ENABLE:$ENUM_HEADER_FOOTER.DISABLE;}},{scriptClass:"mstrmojo.ui.LabelWithIconTooltip",text:$DESC(2033,"Header"),alias:"iconTooltipLabel",iconCss:"info-icon",tooltip:$DESC(15956,"Display the dossier, chapter, and page name on every page.")}]},{scriptClass:"mstrmojo.Label",text:""},{scriptClass:"mstrmojo.Box",alias:"pdfFooter",cssClass:"mstrmojo-CheckBoxes-Box",children:[{scriptClass:"mstrmojo.CheckBox",alias:"checkbox",checked:exOpts.enableFooter===$ENUM_HEADER_FOOTER.ENABLE?true:false,label:$DESC(15948,"Page Numbers"),oncheckedChange:function(){exOpts.enableFooter=this.checked?$ENUM_HEADER_FOOTER.ENABLE:$ENUM_HEADER_FOOTER.DISABLE;}}]}]},{scriptClass:"mstrmojo.Box",alias:"buttonNode",slot:"buttonNode",children:[$NWB($DESC(2140,"Cancel"),function(){this.parent.parent.close();}),$NWB(editor.exportDisplayText,function(){var editor=this.parent.parent;if(!validateOptions.call(editor)){return ;}var newExOpts=getExportOptions.call(editor);editor.exOpts=newExOpts;editor.exportHandler(newExOpts);editor.close();},true),$NWB($DESC(8378,"Advanced Settings"),function(){basic=!basic;this.parent.parent.set("basic",basic);this.parent.parent.toggleMode();this.set("text",basic?$DESC(8378,"Advanced Settings"):$DESC(15840,"Basic Settings"));},false,{cssClass:"togglerBtn"+(this.singleVis?" hidden":"")})]}];}function parseExportOptions(srcExOpts){var destExOpts=$HASH.copy(DEFAULT_EXPORT_OPTIONS);if(typeof srcExOpts==="object"){if(srcExOpts.hasOwnProperty("range")){destExOpts.range=parseInt(srcExOpts.range);}if(srcExOpts.hasOwnProperty("overviewViz")){destExOpts.overviewViz=parseInt(srcExOpts.overviewViz);}if(srcExOpts.hasOwnProperty("paperHeight")){destExOpts.paperHeight=srcExOpts.paperHeight.toString();}if(srcExOpts.hasOwnProperty("paperWidth")){destExOpts.paperWidth=srcExOpts.paperWidth.toString();}if(srcExOpts.hasOwnProperty("pageOrientation")){destExOpts.pageOrientation=parseInt(srcExOpts.pageOrientation);}if(srcExOpts.hasOwnProperty("mode")){destExOpts.mode=parseInt(srcExOpts.mode);}if(srcExOpts.hasOwnProperty("enableFooter")){destExOpts.enableFooter=parseInt(srcExOpts.enableFooter);}if(srcExOpts.hasOwnProperty("enableHeader")){destExOpts.enableHeader=parseInt(srcExOpts.enableHeader);}if(srcExOpts.hasOwnProperty("pdfPwd")){destExOpts.pdfPwd=srcExOpts.pdfPwd.toString();}if(srcExOpts.hasOwnProperty("selectedTabIndex")){destExOpts.selectedTabIndex=parseInt(srcExOpts.selectedTabIndex);}destExOpts.hideTabIndex=srcExOpts.hideTabIndex;}return destExOpts;}mstrmojo.vi.ui.editors.ExportPDFEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.vi.ui.editors.ExportPDFEditor",cssClass:"mstrmojo-ExportPDFEditor",title:$DESC(5212,"Export to PDF"),help:"intro_export_dossier.htm",exportHandler:mstrmojo.emptyFn,exportDisplayText:$DESC(5592,"Export"),basic:true,singleVis:false,exOpts:DEFAULT_EXPORT_OPTIONS,orientationSettings:undefined,useCache:false,zIndex:12,init:function init(props){this._super(props);this.basic=!this.singleVis;this.exOpts=parseExportOptions.call(this,props.exOpts);this.orientationSettings=getOrientationBox(this,this);this.set("children",getChildren.call(this,this.exOpts,this.basic));this.attachEventListener("updateOrientation",this.id,function(){var newIdx=getSelectIndexFromValue(oriCheckListItems,this.exOpts.pageOrientation);this.general.pageOrientation.oriCheckList.set("selectedIndex",newIdx);this.layout.pageOrientation.oriCheckList.set("selectedIndex",newIdx);});},updatePopupConfig:function updatePopupConfig(config,opener){setExportOptions.call(this,this.exOpts);},onOpen:function onOpen(){var exOpts=this.exOpts,tabs=this.tabBar.tabs.itemsContainerNode.childNodes;if(exOpts.hideTabIndex!==undefined&&0<=exOpts.hideTabIndex&&exOpts.hideTabIndex<tabs.length){$CSS.addClass(tabs[exOpts.hideTabIndex],"hidden");}this.toggleMode();this.positionDialog();},onClose:function onClose(){if(!this.useCache){this.destroy();}},toggleMode:function toggleMode(){var tabs=this.tabBar.tabs.itemsContainerNode.childNodes,basicMode=this.basic;$CSS.toggleClass(this.editorNode,"advanced",!basicMode);$CSS.toggleClass(tabs[$ENUM_TABS.LAYOUT],"hidden",basicMode);var canEncrypt=mstrApp&&mstrApp.featureFlagsCache&&mstrApp.featureFlagsCache["EE/PDFEncrypt"];$CSS.toggleClass(tabs[$ENUM_TABS.SECURITY],"hidden",basicMode||!canEncrypt);var tabCount=tabs.length;for(var i=0;i<tabs.length;i++){if(tabs[i].className.match(/\bhidden\b/)){tabCount--;}}this.tabBar.set("visible",tabCount>1);this.tabBar.tabs.set("selectedIndex",this.exOpts.selectedTabIndex);if(!this.singleVis){this.set("title",basicMode?$DESC(15841,"Export to PDF - Basic"):$DESC(15842,"Export to PDF - Advanced"));}}});mstrmojo.vi.ui.editors.ExportPDFEditor.singleVisSettings={hideTabIndex:$ENUM_TABS.GENERAL,selectedTabIndex:$ENUM_TABS.LAYOUT,overviewViz:$ENUM_CONTENT_MODE.VISUALIZATIONS,enableFooter:$ENUM_HEADER_FOOTER.DISABLE};}());