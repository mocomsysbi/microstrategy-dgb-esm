(function(){mstrmojo.requiresCls("mstrmojo.vi.ui.tabs.TabStrip","mstrmojo.vi.ui._HasMask","mstrmojo.hash","mstrmojo.dom","mstrmojo.css","mstrmojo.string","mstrmojo.models.FormatModel","mstrmojo.vi._MonitorsLayoutMode","mstrmojo.vi.ui.tabs.LayoutTabHelper","mstrmojo.vi.models.VIComponentMap","mstrmojo.vi.controllers.EnumLayoutManipulationType","mstrmojo.vi.controllers.EnumLayoutSelectorPosition","mstrmojo.vi.controllers.EnumPanelManipulationType","mstrmojo.vi.controllers.EnumEvents");mstrmojo.requiresDescs(13768,13769,14918,14919,15127,15128);var $HASH=mstrmojo.hash,$DOM=mstrmojo.dom,$ARR=mstrmojo.array,$CSS=mstrmojo.css,$STR=mstrmojo.string,ENUM_ACTIONS=mstrmojo.vi.ui.tabs.Tab.ACTIONS,MENU_ACTIONS=ENUM_ACTIONS.DELETE+ENUM_ACTIONS.DUPLICATE+ENUM_ACTIONS.MOVE+ENUM_ACTIONS.RENAME+ENUM_ACTIONS.NEW_TAB,$VI_TYPES=mstrmojo.vi.models.VIComponentMap.TYPES,$FORMAT_MODEL=mstrmojo.models.FormatModel,$LAYOUT_TAB_HELPER=mstrmojo.vi.ui.tabs.LayoutTabHelper,BUTTON_BAR_WIDTH=144,MENU_BUTTON_WIDTH=70,ADD_BUTTON_WIDTH=90,NAV_BUTTONS_WIDTH=52,BUFFER_WIDTH=6,ADJUSTED_WIDTH=2,LAYOUT_MANIPULATION_TYPE=mstrmojo.vi.controllers.EnumLayoutManipulationType,PANEL_MANIPULATION_TYPE=mstrmojo.vi.controllers.EnumPanelManipulationType,LAYOUT_SELECTOR_POSITION=mstrmojo.vi.controllers.EnumLayoutSelectorPosition,EVENTS=mstrmojo.vi.controllers.EnumEvents;function getPopupHandler(isOpen){return function(){$CSS.toggleClass(this.menuBtnNode,"expand",isOpen);this.menuBtnHostNode.style.display=isOpen?"block":"none";};}mstrmojo.vi.ui.tabs.LayoutTabStrip=mstrmojo.declare(mstrmojo.vi.ui.tabs.TabStrip,[mstrmojo.vi.ui._HasMask,mstrmojo.vi._MonitorsLayoutMode],{scriptClass:"mstrmojo.vi.ui.tabs.LayoutTabStrip",docModel:null,isAlignRight:false,alignPosition:LAYOUT_SELECTOR_POSITION.LEFT,selectMovedTab:true,cssClass:"mstrmojo-LayoutTabStrip",markupMethods:{onalignPositionChange:function(){var tabBarOnTop=this.alignPosition===LAYOUT_SELECTOR_POSITION.TOP;$CSS.toggleClass(this.domNode,"alignTop",tabBarOnTop);$CSS.toggleClass(this.menuImgNode,"topButton",tabBarOnTop);this.visible=this.alignPosition===LAYOUT_SELECTOR_POSITION.LEFT?false:true;},onvisibleChange:mstrmojo.Widget.visibleMarkupMethod},layoutConfig:{w:{bufferNode:BUFFER_WIDTH+"px",addBtnNode:ADD_BUTTON_WIDTH+"px",navBtnsNode:NAV_BUTTONS_WIDTH+"px"},xt:true},onRender:function onRender(){this._super();var leftBtn=this.leftBtnNode,rightBtn=this.rightBtnNode,replaceText=mstrApp.isWSStyling?mstrmojo.desc(15127,"Chapter"):mstrmojo.desc(15128,"Sheet");if(leftBtn&&!leftBtn.getAttribute("tooltip")){this.leftBtnNode.setAttribute("tooltip",mstrmojo.desc(15820,"This is the first ##").replace("##",replaceText));}if(rightBtn&&!rightBtn.getAttribute("tooltip")){this.rightBtnNode.setAttribute("tooltip",mstrmojo.desc(15821,"This is the last ##").replace("##",replaceText));}},onLayoutModeChange:function onLayoutModeChange(evt){this.adjustInPreviewMode();},widgetResized:function widgetResized(){var fnAdjustLayout=function(){if(mstrApp.isLayoutModePreview&&mstrApp.isLayoutModePreview()){this.adjustInPreviewMode();}else{var isInvalidMode=!this.isValidMode(),currentWidth=$DOM.position(this.domNode).w||parseInt(this.width,10)||0,reservedWidth=isInvalidMode?NAV_BUTTONS_WIDTH+ADJUSTED_WIDTH+BUFFER_WIDTH:BUTTON_BAR_WIDTH+MENU_BUTTON_WIDTH,maxWidth=Math.max(currentWidth-reservedWidth,0),tabContainerNode=this.tabContainerNode;if(tabContainerNode&&maxWidth){tabContainerNode.style.maxWidth=maxWidth+"px";}}};if(this.hasRendered){fnAdjustLayout.call(this);return ;}this.attachEventListener("renderComplete",this.id,fnAdjustLayout);},buildRendering:function bldRendering(){this._super();var borderDiv=this.borderNode=document.createElement("div");borderDiv.className="mstrmojo-VILayoutTabs-divider";borderDiv.style.zIndex=this._borderZIndex;this.domNode.appendChild(borderDiv);this.addBtnTxtNode.innerHTML=mstrApp.isWSStyling?mstrmojo.desc(15127,"Chapter"):mstrmojo.desc(15128,"Sheet");},adjustInPreviewMode:function adjustInPreviewMode(){var layoutWidth=parseInt(this.parent.width,10)||0,breakpointWidth=mstrmojo.vi.ui.rw.DocRelativePanel.getLayoutBreakPoint(),isInvalidMode=!this.isValidMode(),isPreview=mstrApp.isLayoutModePreview(),reservedWidth=isInvalidMode?NAV_BUTTONS_WIDTH+ADJUSTED_WIDTH:BUTTON_BAR_WIDTH+MENU_BUTTON_WIDTH,tabStripNode=this.domNode,tabContainerNode=this.tabContainerNode;var width=isPreview?Math.min(layoutWidth,breakpointWidth):layoutWidth,maxWidth=Math.max(width-reservedWidth,0);this.set("width",width+"px");if(tabStripNode){tabStripNode.style.left=isPreview?Math.max(layoutWidth-breakpointWidth,0)/2+"px":"0px";if(tabContainerNode&&maxWidth){tabContainerNode.style.maxWidth=maxWidth+"px";}}},getTabCfg:function getTabCfg(allTabObjects,currentTabObject,cfg){var tabKey=cfg.k,tabStripId=this.id,model=currentTabObject.model,doc=model.controller.view;$HASH.copy({title:currentTabObject.n,getMenuActions:function getMenuActions(){return MENU_ACTIONS;},addNewTabMenuItem:function addNewTabMenuItem(menuCfg){menuCfg.addMenuItem(mstrApp.isWSStyling?mstrmojo.desc(14919,"Insert Page"):mstrmojo.desc(13768,"Insert Panel"),"",function(){var currentTabObject=(allTabObjects||[]).filter(function(layout){return layout.k===tabKey;})[0];var model=currentTabObject.model,stack=model.getVIComponent($VI_TYPES.VIZ_CONTENT,model.getCurrentLayoutKey()),panelStackKey=stack&&stack.k;model.raiseEvent({name:EVENTS.MANIPULATE_PANEL,type:PANEL_MANIPULATION_TYPE.NEW,layoutKey:model.getCurrentLayoutKey(),panelStackKey:panelStackKey});});menuCfg.addSeparator();menuCfg.addMenuItem(mstrApp.isWSStyling?mstrmojo.desc(14918,"Insert Chapter"):mstrmojo.desc(13769,"Insert Sheet"),"",function(){mstrmojo.all[tabStripId].addTab();});},findSelectedTab:function findSelectedTab(tab){var selectedLayout=doc.getSelectedLayoutWidget();return selectedLayout.getSelector().getSelectedTab();},tabSelected:function tabSelected(callback){var isTargeting=mstrApp.isAppStateSelection&&mstrApp.isAppStateSelection();if(isTargeting){model.raiseEvent({name:"targetLayoutSelected",layoutKey:tabKey});}else{model.execute({execute:function execute(){doc.showLayout((allTabObjects||[]).filter(function(layout){return layout.k===tabKey;})[0],callback);},urInfo:{treesToRender:3}});}},tabDeleted:function tabDeleted(){model.raiseEvent({name:EVENTS.MANIPULATE_LAYOUT,type:LAYOUT_MANIPULATION_TYPE.DELETE,layoutKey:tabKey});},tabDuplicated:function tabDuplicated(){model.raiseEvent({name:EVENTS.MANIPULATE_LAYOUT,type:LAYOUT_MANIPULATION_TYPE.DUPLICATE,layoutKey:tabKey});},titleEdited:function editTitle(titleText,oldText){model.raiseEvent({name:EVENTS.MANIPULATE_LAYOUT,type:LAYOUT_MANIPULATION_TYPE.RENAME,layoutKey:tabKey,oldText:oldText,newText:titleText});this.parent.updateTabTable();},postCreateChildren:function postCreateChildren(){$HASH.copy({autoApplyDelay:3000,editOnDoubleClick:mstrApp.allowWebDashboardDesign()},this.lbl);},useRichTooltip:true,updateTooltipConfig:function updateTooltipConfig(evt){var target=evt.target;if(target===this.lbl.domNode&&target.scrollWidth>target.clientWidth){var position=$DOM.position(target);this.richTooltip={posType:mstrmojo.tooltip.POS_BOTTOMCENTER,cssClass:"vi-regular vi-tooltip-V V-center",content:$STR.encodeHtmlString(this.title),top:position.y,left:position.x+position.w/2};}else{this.richTooltip=null;}}},cfg);this.docModel=currentTabObject.model;return cfg;},addTab:function addTab(){var model=this.parent.model;model.raiseEvent({name:EVENTS.MANIPULATE_LAYOUT,type:LAYOUT_MANIPULATION_TYPE.NEW});},commitTabMove:function commitTabMove(fromIdx,toIdx){this.docModel.controller.view.moveLayout(fromIdx,toIdx);},onclick:function onclick(evt){this._super(evt);if(evt.getTarget().parentNode===this.tabStripMenuNode&&this.isValidMode()){var model=this.parent.model,rootCtrl=model.controller.rootCtrl,menuCfg=rootCtrl.getSelectorTabMenu(model);menuCfg.addPopupHandlers(this.id,getPopupHandler(true),getPopupHandler(false));menuCfg.hostId=this.id;menuCfg.hostElement=this.menuBtnHostNode;menuCfg.isHostedWithin=false;this.openPopup(menuCfg.newInstance());}},onmousedown:function onmousedown(evt){this._super(evt);var me=this,target=evt.getTarget().parentNode,isLeftBtn=(target===this.leftBtnNode),isRightBtn=(target===this.rightBtnNode);if(isLeftBtn||isRightBtn){var fnScrollDone=function(){$LAYOUT_TAB_HELPER.saveTabBarPosition(me);};$DOM.attachOneTimeEvent(document.body,"mouseup",fnScrollDone);}},layoutSelected:function layoutSelected(evt){var model=this.docModel,doc=model.controller.view,selectedTab=this.getSelectedTab(),me=this;var raiseSelectPageEvt=function raiseSelectPageEvt(e){model.raiseEvent({name:"selectPage",panelKey:e.panelKey,callback:e.callback});};if(selectedTab.k!==evt.layoutKey){model.execute({execute:function execute(){doc.showLayout((me.tabObjects||[]).filter(function(layout){return layout.k===evt.layoutKey;})[0],evt.callback,undefined,evt.panelKey);},urInfo:{treesToRender:3},isUntracked:mstrApp.isAppStateSelection()});}else{raiseSelectPageEvt(evt);}}});}());