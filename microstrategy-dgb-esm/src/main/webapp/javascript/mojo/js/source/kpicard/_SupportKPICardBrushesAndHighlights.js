(function(){mstrmojo.requiresCls("mstrmojo.hash","mstrmojo.array","mstrmojo.vi.ui.rw._HasVisSelections");var $HASH=mstrmojo.hash,$ARRAY=mstrmojo.array,SELECTION_TYPE=mstrmojo.vi.ui.rw.SelectionType;function getAttIndexFromId(attId){var attIndex=-1,attrs=this.modelData.gts.row||[],len=attrs.length,i;for(i=0;i<len;i+=1){if(attrs[i].id===attId){attIndex=i;}}return attIndex;}mstrmojo.kpicard._SupportKPICardBrushesAndHighlights=mstrmojo.provide("mstrmojo.kpicard._SupportKPICardBrushesAndHighlights",{_mixinName:"mstrmojo.kpicard._SupportKPICardBrushesAndHighlights",prepareLMCSelectionData:function prepareLMCSelectionData(){this.clearSelections();var selectedCards=this.selectedCards;$ARRAY.forEach(selectedCards,function(singleCard){var dataModel=singleCard.dataModel;this.addAttributeSelection(dataModel.attrId,dataModel.elemId,dataModel.categoryElemName);},this);},prepareRMCSelectionData:function prepareRMCSelectionData(){this.clearCxtMnuSelection();var contextMenuSelections=this.contextMenuSelections;$ARRAY.forEach(contextMenuSelections,function(singleCard){var dataModel=singleCard.dataModel;this.addContextMenuAttributeSelection(dataModel.attrId,dataModel.elemId,dataModel.categoryElemName);},this);},kpiInitialHighlight:function kpiInitialHighlight(){var sc=mstrApp.isInVFConfigMode||this.isCustomSort?null:this.findSelectorControl();if(sc&&!sc.isNavigation&&!$HASH.isEmpty(sc.exp)&&this.addSelectionsFromExpression&&this.highlight){this.highlight(this.getSelectionType(),this.getSelectionHash(),true);}this.initialHighlight();},normalizeElementId:function normalizeElementId(elemId){var model=this.model,normalizedIdCache=this.normalizedIdCache,nId=normalizedIdCache[elemId];if(!nId){nId=model.getNormalizedFormElementId(elemId);normalizedIdCache[elemId]=nId;}return nId;},highlight:function highlight(selType,data){if(this._super){this._super.apply(this,arguments);}if(this.noHighlightAfterKeepOnlyExcludeDrill||this.isEmpty()||this.excludeData){return ;}var hash,dataUnit,attId,attIndex,attElems,singleCard,nId;if(selType===SELECTION_TYPE.ATTS||selType===SELECTION_TYPE.METRICS){this.clearSelectedCards();this.clearMenuData();for(hash in data){if(data.hasOwnProperty(hash)){dataUnit=data[hash];for(attId in dataUnit){if(dataUnit.hasOwnProperty(attId)){attIndex=getAttIndexFromId.call(this,attId);if(attIndex>=0){attElems=dataUnit[attId];if(attElems&&attElems.length>0){nId=this.normalizeElementId(attElems[0].id);singleCard=this.getCardInfoByElementId(nId).card;}if(singleCard){this.addToSelectedCards(singleCard);}}}}}}}else{if(selType===SELECTION_TYPE.EMPTY){this.clearSelectedCards();this.clearMenuData();}}},clearSelections:function(flag){if(this._super){this._super();}if(flag){this.clearSelectedCards();}}});}());