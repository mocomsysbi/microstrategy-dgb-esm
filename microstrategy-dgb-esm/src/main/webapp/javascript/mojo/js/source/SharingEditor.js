(function(){mstrmojo.requiresCls("mstrmojo.dom","mstrmojo.array","mstrmojo.hash","mstrmojo.func","mstrmojo.Button","mstrmojo.HTMLButton","mstrmojo.HBox","mstrmojo.List","mstrmojo.Label","mstrmojo.ListMapperHoriz","mstrmojo.WidgetList","mstrmojo.WidgetListMapper","mstrmojo.TristateCheckBox","mstrmojo.Pulldown","mstrmojo.ACL.UserTreeBrowser","mstrmojo.DataGrid","mstrmojo.DropDownButton","mstrmojo.ListBox","mstrmojo.DivItemRenderer","mstrmojo.VBox","mstrmojo.Box","mstrmojo.ACL.UserInputBox","mstrmojo.Editor","mstrmojo.ACL.UserDataService","mstrmojo.CheckList","mstrmojo.TextBox","mstrmojo.TextBoxWithLabel","mstrmojo.CheckBox","mstrmojo.MouseOverContainer","mstrmojo.util.LibraryHelper");mstrmojo.requiresDescs(1825,8078,8079,629,8080,8081,8082,3336,9048,8083,8084,955,8085,531,8086,8087,8088,8089,8090,767,2056,8091,8093,1442,221,8092,13621,9772,9773,9774,272,271,8145,2509,8146,8147,9775,9776,9777,9771,12299,9151,2156,9892,9890,9891,9099,2140,2102);var $DOM=mstrmojo.dom,$CSS=mstrmojo.css,$ARRAY=mstrmojo.array,$LIB_HELPER=mstrmojo.util.LibraryHelper,publicUsers=[],PERMISSION_LEVELS=[{n:mstrmojo.desc(16034,"Grant"),v:0},{n:mstrmojo.desc(16035,"Deny"),v:1},{n:mstrmojo.desc(8441,"Default"),v:2}],editorID="sharingEditor",defaultPublicAccess=199,publicGuestDID="294DEDC011D2F1D56000D98E67019608",everyoneDID="C82C6B1011D2894CC0009D9F29718E4F",Enum_RIGHT_FLAGS=[1,4,8,16,32,64,128],Enum_RIGHT_DESC=[mstrmojo.desc(1825,"Browse"),mstrmojo.desc(8078,"Read"),mstrmojo.desc(8079,"Write"),mstrmojo.desc(629,"Delete"),mstrmojo.desc(8080,"Control"),mstrmojo.desc(8081,"Use"),mstrmojo.desc(8082,"Execute")],Enum_RIGHT_DESC_SHORT=["B","R","W","D","C","U","E"],guestModeEnabled=false,showMsg=true,SUBTYPE_CUSTOM_GROUP=257,SUBTYPE_METRIC=1024,SUBTYPE_REPORT_DATAMART=772,SUBTYPE_REPORT_CUBE=776,SUBTYPE_REPORT_INCREMENTAL_REFRESH=777,$NWB=mstrmojo.Button.newWebButton,$NAB=mstrmojo.Button.newActionButton;function createCustomPermisssionLevelItem(a,r,l){return{scriptClass:"mstrmojo.HBox",alias:a,right:r,cssText:"height:20px;",children:[{scriptClass:"mstrmojo.Label",text:l,cssText:"width:80px"},{scriptClass:"mstrmojo.Pulldown",cssText:"width:100px",itemIdField:"v",items:PERMISSION_LEVELS,defaultSelection:2,selectionPolicy:"reselect",_set_value:function(n,v){this.value=v;}}]};}function _isFolder(oi){return(oi&&oi.t===8);}function _showLinks(oi){return oi&&oi.st!=SUBTYPE_CUSTOM_GROUP&&oi.st!=SUBTYPE_METRIC&&oi.st!=SUBTYPE_REPORT_DATAMART&&oi.st!=SUBTYPE_REPORT_CUBE&&oi.st!=SUBTYPE_REPORT_INCREMENTAL_REFRESH;}function _fixACL(v){return{"253000":255000,"253":255,"221":223,"197":199,"69":71}[v]||v;}function _fixACLTwoStates(v){return{"253000":255000,"253":255,"32221":223,"56197":199}[v]||v;}function _postProcessACLs(oi){var acls=[].concat(oi.acls),inhs=oi.inhs,exAcls=oi.acls,acl,g,rgt,i,len;exAcls.splice(0,exAcls.length);if(_isFolder(oi)){acls=acls.concat(mstrmojo.hash.valarray(inhs));}for(i=0,len=acls.length;i<len;i++){acl=acls[i];rgt=acl.rgt;if(rgt>1000){g=mstrmojo.hash.copy(acl);g.den=true;g.rgt=Math.floor(rgt/1000);exAcls.push(g);}if((rgt%1000)>0){g=mstrmojo.hash.copy(acl);g.den=false;g.rgt=rgt%1000;exAcls.push(g);}}return oi;}function _getSaveXML(oi){var cfg={isSerializable:function(nodeName,jsons,idx){switch(nodeName){case"did":case"rgt":case"n":case"acls":case"t":case"st":case"inh":case"den":return true;}return false;},getArrItemName:function(n,v,i){if(n==="acls"){return"acl";}},convertBoolean:true};return mstrmojo.string.json2xml("oi",oi,cfg);}function _saveACL(e,isToClose){var oi=e&&e.oi,xml,cb,params,otc=e.oneTierConnectivity;if(oi){oi=_postProcessACLs(oi);xml=_getSaveXML(oi);params={taskId:"saveObjectACL",objectXML:xml,objectType:oi.t,objectID:oi.did,propagateToChildren:e.childrenAccessPulldown.value};cb={success:function(res){if(isToClose){e.close();}else{mstrmojo.alert(mstrmojo.desc(3336,"## has been saved successfully.").replace("##",res.n));e.set("hasChanged",false);}},failure:function(res){if(res.getReponseHeader){mstrmojo.alert(res.getResponseHeader("X-MSTR-TaskFailureMsg"));}if(isToClose){e.close();}}};if(otc){delete params.taskId;params.connectionId=otc.connectionId;params.sessionState=otc.sessionState;otc.connectivityProxy.saveObjectACL(params,mstrmojo.func.wrapMethods(cb,{failure:function(res){mstrmojo.onetier.vi.prefs.handleErrorMessage(res);}}));}else{mstrmojo.xhr.request("POST",mstrConfig.taskURL,cb,params);}}}function _addACL(e){var acl=e.aclList,ci=e.objectInputer,its=ci.getSelectedObjects(),len=its.length,added=[],it,rgt=199,i,idx,ace;if(!ci.isValid()){mstrmojo.alert(mstrmojo.desc(9048,"Some users/groups do not exist. Please remove them in order to proceed."),null,e.alertTitle);return false;}for(i=0;i<len;i++){it=its[i];if(it.did===publicGuestDID||it.did===everyoneDID){var editor=mstrmojo.all[editorID];if(rgt===editor.currentPublicRight){if(showMsg){$CSS.removeClass(editor.userMessage.domNode,"hideMsg");}}}idx=$ARRAY.find(acl.items,"did",it.did);if(idx!==-1){ace=acl.items[idx];if(e.uneditableRights[ace.rgt]){continue;}}added.push(new mstrmojo.Obj({n:it.n,did:it.did,st:it.st,rgt:rgt,newItem:true}));}if(added.length>0){var ret=$ARRAY.findMulti(acl.items,"did",added);if(ret.count){var idxs=ret.indices.concat().sort($ARRAY.numSorter).slice(0,ret.count);for(i=idxs.length-1;i>-1;i--){acl.remove(idxs[i]);}}acl.add(added);e.set("hasChanged",true);}ci.set("items",[]);return true;}function _getACLHint(r){var h=[],d=Math.floor(r/1000),g=r%1000,rf=Enum_RIGHT_FLAGS,rd=Enum_RIGHT_DESC,len=rf.length,s,i;for(i=0;i<len;i++){h.push(rd[i]);h.push(" ");if((g&rf[i])>0){h.push(mstrmojo.desc(8083,"Granted"));}else{if((d&rf[i])>0){h.push(mstrmojo.desc(8084,"Denied"));}else{h.push(mstrmojo.desc(959,"Default"));}}h.push(",");}s=h.join("");return s.substring(s,s.length-1);}function _getACLLabel(r){var h=[],g=r%1000,rf=Enum_RIGHT_FLAGS,rd=Enum_RIGHT_DESC_SHORT,len=rf.length,s,i;for(i=0;i<len;i++){if((g&rf[i])>0){h.push(rd[i]);h.push(",");}}s=h.join("");return s.substring(s,s.length-1);}function _updatePulldown(w,v){var its=w.items,idx=$ARRAY.find(its,w.itemIdField,v),iWas=w.customItem,iIdx=its.length-2;if(idx===-1){var iNew={n:_getACLLabel(v),rgt:v};if(iWas){its.splice(iIdx,1);}iIdx=its.length-1;its.splice(iIdx,0,iNew);w.customItem=iNew;}else{if(iWas&&idx!==iIdx){its.splice(iIdx,1);w.customItem=null;}}if(mstrmojo.all[editorID].showACLHint!==false){w.set("title",_getACLHint(v));}w.value=v;}function _getCategoriesByType(t){return{"776":[{n:mstrmojo.desc(8085,"Consume"),rgt:71},{n:mstrmojo.desc(531,"Add"),rgt:199},{n:mstrmojo.desc(8086,"Collaborate"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8089,"Custom ..."),rgt:-1}],"779":[{n:mstrmojo.desc(8085,"Consume"),rgt:71},{n:mstrmojo.desc(531,"Add"),rgt:199},{n:mstrmojo.desc(8086,"Collaborate"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8089,"Custom ..."),rgt:-1}]}[t]||[{n:mstrmojo.desc(8090,"View"),rgt:199},{n:mstrmojo.desc(767,"Modify"),rgt:223},{n:mstrmojo.desc(8087,"Full control"),rgt:255},{n:mstrmojo.desc(8088,"Denied all"),rgt:255000},{n:mstrmojo.desc(8089,"Custom ..."),rgt:-1}];}function _getHTMLCode(link,reset){var finalStr="";if(reset){var width=this.widthInput.value,height=this.heightInput.value,src=' src="'+link,hiddenSecStr="",checkBoxes=this.toolbarOptions.checkBoxList,items=checkBoxes.items,i;for(i=0;i<items.length;i++){if(!checkBoxes.selectedIndices.hasOwnProperty(i)){if(hiddenSecStr==""){hiddenSecStr="&hiddensections="+items[i].alias;}else{hiddenSecStr+=","+items[i].alias;}}}finalStr='<iframe width="'+width+'" ';finalStr+='height="'+height+'" ';finalStr+=src;finalStr+=hiddenSecStr;finalStr+='"></iframe>';}else{finalStr='<iframe width="640" height="480" src="';finalStr+=link;finalStr+='&hiddensections=header,path,dockTop,dockLeft,footer"></iframe>';}return finalStr;}function _getURLLink(href){var parsedURL=mstrmojo.string.parseUri(href).queryKey,parmStart=href.indexOf("?"),finalURL=parmStart>0?href.substring(0,parmStart):href;var jStart=finalURL.indexOf(";jsessionid");finalURL=jStart>0?finalURL.substring(0,jStart):finalURL;if(parsedURL.hasOwnProperty("iframe")){delete parsedURL.iframe;}if(parsedURL.hasOwnProperty("validateRandNum")){delete parsedURL.validateRandNum;}if(!parsedURL.hasOwnProperty("server")){parsedURL.Server=encodeURIComponent(mstrApp.serverName);}if(!parsedURL.hasOwnProperty("Project")){parsedURL.Project=encodeURIComponent(mstrmojo.string.decodeHtmlString(mstrApp.projectName));}if(!parsedURL.hasOwnProperty("port")){parsedURL.Port=mstrApp.serverPort;}if(guestModeEnabled&&mstrConfig.shareToGuestWhenEnabled){parsedURL.connmode=8;parsedURL.ru=1;}if(parsedURL.evt!=="3185"){parsedURL.share=1;}finalURL+="?";for(var key in parsedURL){finalURL+=key+"="+parsedURL[key]+"&";}finalURL=finalURL.substring(0,finalURL.length-1);return finalURL;}function _copyLink(textArea){textArea.select();document.execCommand("copy");textArea.value=textArea.value;mstrmojo.alert(mstrmojo.desc(15340,"The link has been successfully copied to your clipboard"));}function _showLibraryLink(type,url){return($LIB_HELPER.isLibraryConfigured()&&(type===55||(type===18&&url&&url.contains("documentID"))));}function _resolveId(oid,type,url){if(type===18&&_showLibraryLink(type,url)){var parsedURL=mstrmojo.string.parseUri(url).queryKey;oid=parsedURL.documentID;}return oid;}function _emailHelper(editor,url){var pro=window.location.protocol,mt="mailto:?body="+window.encodeURIComponent(url)+"&subject="+encodeURI(editor.objectName);if(mstrApp.isSingleTier){window.FormWrapper.openPage(mt);}else{if(!!$DOM.isChrome&&pro==="https:"){window.open(mt,"_self");window.setTimeout("iframe.hideWaitPage()",2000);}else{window.open(mt,"mailtoIframe");}}}function _iconHelper(rgt){var iconClass;switch(rgt){case 199:iconClass="read";break;case 223:iconClass="write";break;case 255:iconClass="full";break;case 255000:iconClass="deny";break;default:iconClass="custom";}return"sharingEditor-privilegeIcon "+iconClass;}function _createPersonalView(sendEmail){var now=new Date(),subName=this.objectName+" "+now.toLocaleDateString()+" "+now.toLocaleTimeString(),editor=this,callback={success:function(res){var url=_getURLLink(res.url);editor.topSection.authorLinkRow.authorLinkBox.set("value",url);editor.url=url;editor.topSection.htmlPanel.htmlLinkRow.htmlBox.set("value",_getHTMLCode(url));var email=editor.topSection.authorEmail.emailLink;email.set("url",window.encodeURIComponent(url));email.set("name",editor.objectName);},failure:function(res){mstrmojo.alert(res.getResponseHeader("X-MSTR-TaskFailureMsg"));},complete:function(){editor.hideWait();if(sendEmail){var mt="mailto:?body="+window.encodeURIComponent(editor.url)+"&subject="+encodeURI(editor.objectName);var func=mstrApp.openPage||mstrmojo._IsWebApp.openPage;func(mt,"mailtoIframe");}}};this.showWait();mstrmojo.xhr.request("POST",mstrConfig.taskURL,callback,{taskId:"savePersonalView",messageID:this.mid,objectType:this.oi.t,subName:subName,objectSubType:0,viewMode:this.viewMode||0,isPVPublic:true});}function _getMouseOverLabel(rgt){var access=this.getAvailableRightsForSelection(),len=access.length,i;for(i=0;i<len;i++){if(access[i].rgt===rgt){return access[i].n;}}return mstrmojo.desc(2056,"Custom");}function hasControlPermission(oi){return(((oi.acg&32)>0)&&((oi.acg&8)>0));}mstrmojo.SharingEditor=mstrmojo.declare(mstrmojo.Editor,null,{scriptClass:"mstrmojo.SharingEditor",cssClass:"mstrmojo-SharingEditor",showSharingOptions:true,showButtonBar:true,showPublisAccess:true,hasChanged:false,help:"sharing_dialog_box.htm",zIndex:199,defaultRight:223,showButtonText:true,uneditableRights:{},currentPublicRight:199,userSelectorTitle:mstrmojo.desc(8091,"User/User Group Browser"),showLinkOnOpen:true,closeEditorAfterSave:true,allowHTMLTitle:true,init:function(props){editorID=props.id||editorID;this._super(props);},onShowLink:function(alias){var name=["libraryLink","showLink","htmlCode"];for(var i=0;i<name.length;i++){if(name[i]!==alias){var element=this.topSection.tabDock[name[i]];element.set("selected",false);$CSS.removeClass(element.domNode,"selected");}}},showWait:mstrmojo.emptyFn,hideWait:mstrmojo.emptyFn,checkPublicAccess:function(){var acls=this.oi.acls,i,everyoneIndex=$ARRAY.find(acls,"did",everyoneDID),itemContainerNode=this.aclList.itemsContainerNode,publicLabel=this.publicAccessSection.publicLabel,dataRow,toggleClass=false,guestIndex=$ARRAY.find(acls,"did",publicGuestDID),publicAccess;if(everyoneIndex!==-1&&guestModeEnabled&&guestIndex!==-1){var everyoneRight=acls[everyoneIndex].rgt,guestRight=acls[guestIndex].rgt;if(everyoneRight===guestRight){toggleClass=true;publicAccess=guestRight;}}if(everyoneIndex!==-1&&!guestModeEnabled){toggleClass=true;publicAccess=acls[everyoneIndex].rgt;}dataRow=itemContainerNode.children[0].tBodies;if(guestModeEnabled&&dataRow[guestIndex]){$CSS.toggleClass(dataRow[guestIndex].rows[0],"hide",toggleClass);}if(dataRow[everyoneIndex]){$CSS.toggleClass(dataRow[everyoneIndex].rows[0],"hide",toggleClass);}publicLabel.set("checked",toggleClass);if(publicAccess){this.set("currentPublicRight",publicAccess);}},oncurrentPublicRightChange:function(){var mouseOverContainer=this.publicAccessSection.publicMouseOver;mouseOverContainer.publicRight.set("value",this.currentPublicRight);mouseOverContainer.publicRightLabel.set("text",_getMouseOverLabel.call(this,this.currentPublicRight));},onOpen:function(){var oi=this.oi,name=oi.n,type=oi.t,acl=oi.acls,topSection=this.topSection,tabDock=topSection.tabDock,sameDoc=false;var oid=_resolveId(oi.did,type,this.href);if(this.objectId&&this.objectId===oid&&!this.isLinkDirty){sameDoc=true;}this.objectId=oid;this.objectName=name;this.set("showACL",!!acl);guestModeEnabled=this.guestModeEnabled;if(_showLinks(oi)&&this.showSharingOptions){if(!sameDoc){if(this.href&&!this.isLinkDirty){var url=!this.urlReady?_getURLLink(this.href):this.href,email=topSection.authorEmail.emailLink;this.url=url;email.set("url",window.encodeURIComponent(url));email.set("name",name);topSection.htmlPanel.htmlLinkRow.htmlBox.set("value",_getHTMLCode(url));topSection.authorLinkRow.authorLinkBox.set("value",url);}else{_createPersonalView.call(this);this.set("isLinkDirty",false);}if(_showLibraryLink(type,this.href)){var url=$LIB_HELPER.constructLibraryUrl(oid);var libraryEmail=topSection.libraryLaunchButtons.libraryEmailLink;this.libraryUrl=url;topSection.libraryLinkRow.libraryLinkBox.set("value",this.libraryUrl);libraryEmail.set("url",window.encodeURIComponent(url));libraryEmail.set("name",name);}}if(this.initTab=="shareByLinkMSTRLibrary"){this.onShowLink("libraryLink");tabDock.libraryLink.set("selected",true);$CSS.addClass(tabDock.libraryLink.domNode,"selected");}else{if(this.initTab=="shareByLinkEmbed"){this.onShowLink("htmlCode");tabDock.htmlCode.set("selected",true);$CSS.addClass(tabDock.htmlCode.domNode,"selected");}else{this.onShowLink("showLink");tabDock.showLink.set("selected",true);$CSS.addClass(tabDock.showLink.domNode,"selected");}}}this.set("title",mstrmojo.desc(8093,"share").replace("##",mstrmojo.string.encodeHtmlString(name)));if(acl){this.checkPublicAccess();var ci=this.objectInputer,us=this.userSelector,ub=us&&us.userBrowser;ci.zIndex=this.zIndex;if(ub&&ub.hasRendered){us.opener=this;ub.set("items",[]);ub.getContent(ub);}this.set("hasChanged",false);}this.aclList.updateScrollbars();this.positionDialog();},_set_hasChanged:function(n,v){var returnVal=(v!==this.hasChanged);this.hasChanged=v;if(v===true){this.checkPublicAccess();return v;}return returnVal;},_set_oi:function(n,v){this.oi=this.preProcessACLs(v);return true;},postCreate:function(){this.oi=this.preProcessACLs(this.oi);},getAvailableRightsForSelection:function(){return _getCategoriesByType(this.oi.st);},preProcessACLs:function(oi){if(oi&&oi.acls){var acls=oi.acls,len=acls&&acls.length,isF=_isFolder(oi),aclMap={},acl,r,inhs,i;if(isF){inhs={};oi.inhs=inhs;}for(i=0;i<len;i++){acl=new mstrmojo.Obj(acls[i]);if(acl.den){acl.rgt=acl.rgt*1000;}if(isF&&acl.inh){inhs[acl.n]=mstrmojo.hash.copy(acl);continue;}r=aclMap[acl.n];if(!r){r=mstrmojo.hash.copy(acl);r.rgt=0;delete r.den;aclMap[acl.n]=r;}r.rgt=r.rgt+acl.rgt;if(r.rgt>255000){r.rgt=Math.floor(r.rgt/1000)*1000;}}acls=mstrmojo.hash.valarray(aclMap);oi.acls=acls;}return oi;},getACLItems:function(){var itms=this.aclList&&this.aclList.items,_itms=[];for(var i=0,len=itms.length;i<len;i++){_itms.push(itms[i]);}return _itms;},onClose:function(){var ci=this.objectInputer;ci.set("items",[]);this.aclList.clearSelect();this.onShowLink("showLink");},getACLUserDataService:function getACLUserDataService(){return mstrmojo.ACL.UserDataService;},userSelector:{scriptClass:"mstrmojo.Editor",cssClass:"mstrmojo-UserEditor",help:"user_group_browser.htm",onClose:function(){this.userBrowser.clearTreeSelect();},children:[{scriptClass:"mstrmojo.ACL.UserTreeBrowser",alias:"userBrowser",getACLUserDataService:function getACLUserDataService(){return this.parent.opener.getACLUserDataService();},updateTreeContent:function(w,res){w.contentRetrieved=true;var items=res[w.itemChildrenField],tree=w.tree||w,bc=res.bc,sz=res.sz,bb=res.bb;if(bc!==-1){if(bb+bc<=sz){items.push(tree.nextItemCreaterFunc());}if((bb-bc)>-1){items.unshift(tree.prevItemCreaterFunc());}}w.blockBegin=bb;tree.initializing=true;w.clearSelect(false);w.set("items",items);w.setSelectedItems(tree.getTotalSelections(),true);tree.initializing=false;},selectionAcrossBranch:true,multiSelect:true},{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",iconClass:"mstrmojo-Editor-button-OK",text:mstrmojo.desc(1442,"OK"),onclick:function(evt){var ue=this.parent.parent,e=ue.opener,ci=e.objectInputer,ub=ue.userBrowser,sls=ub.getTotalSelections();if(sls&&sls.length>0){ci.add(sls,ci.items.length-1);}ue.close();},preBuildRendering:function(){if(!this.parent.parent.opener.showButtonText){this.set("text","");}}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",iconClass:"mstrmojo-Editor-button-Cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(evt){this.parent.parent.close();},preBuildRendering:function(){if(!this.parent.parent.opener.showButtonText){this.set("text","");}}}]}],onOpen:function(){this.set("title",this.opener.userSelectorTitle);}},customACL:{scriptClass:"mstrmojo.Editor",title:mstrmojo.desc(8092,"Custom Permission Level"),cssClass:"mstrmojo-CustomACLEditor",help:"Custom_Permission_Level_dialog_box.htm",onOpen:function(){var rgt=this.rgt,d=Math.floor(rgt/1000),g=rgt%1000,chs=this.children,ch,r,i,len;for(i=0,len=7;i<len;i++){ch=chs[i];r=ch.right;if((g&r)>0){ch.children[1].value=0;}else{if((d&r)>0){ch.children[1].value=1;}else{ch.children[1].value=2;}}}this.refresh();},getACLValue:function(){var g=0,d=0,chs=this.children,ch,i,len;for(i=0,len=7;i<len;i++){ch=chs[i];if(ch.children[1].value==0){g+=ch.right;}else{if(ch.children[1].value==1){d+=ch.right;}}}return d*1000+g;},children:[createCustomPermisssionLevelItem("browse",1,mstrmojo.desc(1825,"Browse")),createCustomPermisssionLevelItem("read",4,mstrmojo.desc(8078,"Read")),createCustomPermisssionLevelItem("write",8,mstrmojo.desc(8079,"Write")),createCustomPermisssionLevelItem("delete",16,mstrmojo.desc(629,"Delete")),createCustomPermisssionLevelItem("control",32,mstrmojo.desc(8080,"Control")),createCustomPermisssionLevelItem("use",64,mstrmojo.desc(8081,"Use")),createCustomPermisssionLevelItem("execute",128,mstrmojo.desc(8082,"Execute")),{scriptClass:"mstrmojo.HBox",cssClass:"mstrmojo-Editor-buttonBox",slot:"buttonNode",children:[{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",iconClass:"mstrmojo-Editor-button-OK",text:mstrmojo.desc(1442,"OK"),onclick:function(evt){var e=this.parent.parent;if(e.onOK){e.onOK();}e.close();}},{scriptClass:"mstrmojo.HTMLButton",cssClass:"mstrmojo-Editor-button",iconClass:"mstrmojo-Editor-button-Cancel",text:mstrmojo.desc(221,"Cancel"),onclick:function(evt){var e=this.parent.parent;if(e.onCancel){e.onCancel();}e.close();}}]}]},children:[{scriptClass:"mstrmojo.Box",alias:"topSection",cssClass:"sharingEditor-topSection",bindings:{visible:function(){return _showLinks(this.parent.oi)&&this.parent.showSharingOptions;}},children:[{scriptClass:"mstrmojo.HBox",alias:"tabDock",cssClass:"sharingEditor-tabDock",bindings:{visible:function(){return _showLinks(this.parent.parent.oi)&&this.parent.parent.showSharingOptions;}},children:[{scriptClass:"mstrmojo.Label",alias:"showLink",text:mstrmojo.desc(9773,"Link"),cssClass:"SharingEditor-ShowLink",selected:false,onclick:function(evt){var editor=this.parent.parent.parent;if(!this.selected){editor.onShowLink(this.alias);this.set("selected",true);$CSS.addClass(this.domNode,"selected");}},},{scriptClass:"mstrmojo.Label",alias:"libraryLink",text:mstrmojo.desc(15572,"Library link"),cssClass:"SharingEditor-libraryLink",selected:false,onclick:function(evt){var editor=this.parent.parent.parent;if(!this.selected){editor.onShowLink(this.alias);this.set("selected",true);$CSS.addClass(this.domNode,"selected");}},bindings:{visible:function(){return _showLibraryLink(this.parent.parent.parent.oi.t,this.parent.parent.parent.href);}}},{scriptClass:"mstrmojo.Label",cssClass:"SharingEditor-ShowHtml",alias:"htmlCode",text:mstrmojo.desc(9774,"Show HTML"),selected:false,onclick:function(evt){var editor=this.parent.parent.parent;if(!this.selected){editor.onShowLink(this.alias);this.set("selected",true);$CSS.addClass(this.domNode,"selected");}}}]},{scriptClass:"mstrmojo.Box",alias:"htmlPanel",cssClass:"mstrmojo-SharingEditor-html-panel",children:[{scriptClass:"mstrmojo.HBox",alias:"htmlLinkRow",cssClass:"SharingEditor-LinkRow",children:[{scriptClass:"mstrmojo.TextBox",alias:"htmlBox",cssClass:"SharingEditor-Html"},{scriptClass:"mstrmojo.Button",alias:"copyHtmlLink",cssClass:"SharingEditor-CopyHtmlLink",onclick:function(evt){var textArea=this.parent.htmlBox.inputNode;_copyLink(textArea);},bindings:{visible:"this.parent.parent.parent.tabDock.htmlCode.selected"}}]},{scriptClass:"mstrmojo.Label",alias:"IframeSize",text:mstrmojo.desc(9735,"Size:"),cssClass:"SharingEditor-Html-Size"},{scriptClass:"mstrmojo.TextBoxWithLabel",alias:"widthInput",label:mstrmojo.desc(272,"Width:"),value:640,onvalueChange:function(evt){var prt=this.parent,editor=mstrmojo.all[editorID];prt.htmlLinkRow.htmlBox.set("value",_getHTMLCode.call(prt,editor.url,true));}},{scriptClass:"mstrmojo.TextBoxWithLabel",label:mstrmojo.desc(271,"Height:"),alias:"heightInput",value:480,onvalueChange:function(){var prt=this.parent,editor=mstrmojo.all[editorID];prt.htmlLinkRow.htmlBox.set("value",_getHTMLCode.call(prt,editor.url,true));}},{scriptClass:"mstrmojo.HBox",alias:"toolbarOptions",cssClass:"SharingEditor-toolbarRow",children:[{scriptClass:"mstrmojo.Label",alias:"IframeShow",text:mstrmojo.desc(15341,"Show:"),cssClass:"SharingEditor-Html-Show"},{scriptClass:"mstrmojo.CheckListHoriz",alias:"checkBoxList",items:[{n:mstrmojo.desc(8145,"Navigation bar"),alias:"path"},{n:mstrmojo.desc(2509,"Toolbar"),alias:"dockTop"},{n:mstrmojo.desc(8146,"Tools panel"),alias:"dockLeft"},{n:mstrmojo.desc(8147,"Footer"),alias:"footer"}],multiSelect:true,onselectionChange:function(evt){var prt=this.parent.parent,editor=mstrmojo.all[editorID];prt.htmlLinkRow.htmlBox.set("value",_getHTMLCode.call(prt,editor.url,true));}}]}],bindings:{visible:"this.parent.tabDock.htmlCode.selected"}},{scriptClass:"mstrmojo.HBox",alias:"authorLinkRow",cssClass:"SharingEditor-LinkRow",bindings:{visible:function(){return this.parent.tabDock.showLink.selected;}},children:[{scriptClass:"mstrmojo.TextBox",alias:"authorLinkBox",cssClass:"SharingEditor-Link",},{scriptClass:"mstrmojo.Button",alias:"authorCopyLink",cssClass:"SharingEditor-CopyLink",onclick:function(evt){var textArea=this.parent.authorLinkBox.inputNode;_copyLink(textArea);}},]},{scriptClass:"mstrmojo.HBox",alias:"libraryLinkRow",cssClass:"SharingEditor-LinkRow",bindings:{visible:function(){return this.parent.tabDock.libraryLink.selected;}},children:[{scriptClass:"mstrmojo.TextBox",alias:"libraryLinkBox",cssClass:"SharingEditor-Link",},{scriptClass:"mstrmojo.Button",alias:"libraryCopyLink",cssClass:"SharingEditor-CopyLink",onclick:function(evt){var textArea=this.parent.libraryLinkBox.inputNode;_copyLink(textArea);}},]},{scriptClass:"mstrmojo.HBox",alias:"libraryLaunchButtons",cssClass:"SharingEditor-LaunchButtons",bindings:{visible:function(){return this.parent.tabDock.libraryLink.selected;}},children:[{scriptClass:"mstrmojo.Widget",markupString:'<div id = "{@id}" class ="sharingEditor-launchLink" style="{@cssText}" mstrAttach:click>'+mstrmojo.desc(15334,"Launch")+' <iframe name="launchToIframe" target="_blank" style="display:none"></iframe> </div>',alias:"launchLink",onclick:function(){var editor=this.parent.parent.parent;$LIB_HELPER.createTokenAndOpenLink(editor.libraryUrl);},bindings:{visible:function(){return this.parent.parent.tabDock.libraryLink.selected&&this.parent.parent.parent.oi.t==55;}}},{scriptClass:"mstrmojo.Widget",markupString:'<div id = "{@id}" class ="sharingEditor-emailLink" style="{@cssText}"" mstrAttach:click>'+mstrmojo.desc(15333,"Email Link")+' <iframe name="mailtoIframe" style="display:none"></iframe> </div>',alias:"libraryEmailLink",onclick:function(){var editor=this.parent.parent.parent;if(!editor.libraryUrl){$LIB_HELPER.constructLibraryUrl(editor.objectId);}else{_emailHelper(editor,editor.libraryUrl);}}}]},{scriptClass:"mstrmojo.HBox",alias:"authorEmail",cssClass:"SharingEditor-LaunchButtons email",bindings:{visible:function(){return this.parent.tabDock.showLink.selected;}},children:[{scriptClass:"mstrmojo.Widget",markupString:'<div id = "{@id}" class ="sharingEditor-emailLink" style="{@cssText}"" mstrAttach:click>'+mstrmojo.desc(15333,"Email Link")+' <iframe name="mailtoIframe" style="display:none"></iframe> </div>',alias:"emailLink",onclick:function(){var editor=this.parent.parent.parent;if(!editor.url||editor.isLinkDirty){_createPersonalView.call(editor,true);editor.set("isLinkDirty",false);}else{_emailHelper(editor,editor.url);}}}]}]},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9775,"Who Has Access"),cssClass:"SharingEditor-title",bindings:{visible:"this.parent.showACL"}},{scriptClass:"mstrmojo.Label",alias:"userMessage",text:mstrmojo.desc(9771,"The permission you added is already granted"),cssClass:"sharingEditorUserMessage hideMsg",bindings:{visible:"this.parent.showACL"},onclick:function(){$CSS.addClass(this.domNode,"hideMsg");showMsg=false;}},{scriptClass:"mstrmojo.Box",cssClass:"sharingEditor-ACLUserPanel",bindings:{visible:"this.parent.showACL"},children:[{scriptClass:"mstrmojo.HBox",cssClass:"sharingEditor-CPSection",children:[{scriptClass:"mstrmojo.ACL.AddUserInputBox",emptyText:mstrmojo.desc(15335,"Type to add users or groups here..."),getACLUserDataService:function getACLUserDataService(){return this.parent.parent.parent.getACLUserDataService();},noCache:true,postCreate:function(){var e=this.parent.parent.parent;if(e){this.zIndex=e.zIndex+1;}},onRender:function(){var e=this.parent.parent.parent;if(e){e.objectInputer=this;}},bindings:{enabled:function(){return hasControlPermission(this.parent.parent.parent.oi);}}},$NAB(mstrmojo.desc(1825,"Browse"),function(evt){var e=this.parent.parent.parent;e.openPopup("userSelector",{zIndex:e.zIndex+10});},{bindings:{enabled:function(){return hasControlPermission(this.parent.parent.parent.oi);}}})]}]},{scriptClass:"mstrmojo.HBox",alias:"publicAccessSection",cssClass:"sharingEditor-publicAccessSection",bindings:{visible:"this.parent.showACL && this.parent.showPublisAccess"},children:[{scriptClass:"mstrmojo.CheckBox",alias:"publicLabel",cssClass:"SharingEditor-Public",bindings:{label:function(){if(this.parent.parent.guestModeEnabled){return mstrmojo.desc(9776,"Public (Login not required)");}return mstrmojo.desc(9777,"Everyone (Login not required)");},enabled:function(){return hasControlPermission(this.parent.parent.oi);}},oncheckedChange:function(){$CSS.toggleClass(this.domNode.children[1],"label-disabled",!this.checked);},getUserGroupsInfo:function(){if(guestModeEnabled){this.getUserGroupFromTaskCall(publicGuestDID);}this.getUserGroupFromTaskCall(everyoneDID);},getUserGroupFromTaskCall:function(id){var editor=mstrmojo.all[editorID],acls=editor.aclList,DS=editor.getACLUserDataService(),success=function(candidates){var added=new mstrmojo.Obj({n:candidates.n,did:candidates.did,st:candidates.st,rgt:defaultPublicAccess,newItem:true});publicUsers.push(added);},failure=function(res){},complete=function(){if(!guestModeEnabled||(guestModeEnabled&&publicUsers.length==2)){acls.add(publicUsers);editor.set("hasChanged",true);}};DS.getMembers({blockBegin:0,blockCount:1,outputElements:1,data:{did:id}},{success:success,failure:failure,complete:complete});},onclick:function(){var editor=mstrmojo.all[editorID];var acls=editor.aclList.items;var everyoneIndex=$ARRAY.find(acls,"did",everyoneDID);if(everyoneIndex!==-1){acls.remove(everyoneIndex);}var guestIndex=$ARRAY.find(acls,"did",publicGuestDID);if(guestModeEnabled&&guestIndex!==-1){acls.remove(guestIndex);}if(this.checked===true){if(publicUsers.length<1){this.getUserGroupsInfo();}else{mstrmojo.array.forEach(publicUsers,function(item){item.rgt=defaultPublicAccess;});acls.add(publicUsers);editor.set("hasChanged",true);}}else{editor.set("currentPublicRight",defaultPublicAccess);editor.set("hasChanged",true);}}},{scriptClass:"mstrmojo.MouseOverContainer",alias:"publicMouseOver",setupSelectedItem:function setupSelectedItem(){this.mouseoverItem=this.publicRight;this.mouseoutItem=this.publicRightLabel;},bindings:{visible:"this.parent.publicLabel.checked",enabled:function(){return hasControlPermission(this.parent.parent.oi);}},children:[{scriptClass:"mstrmojo.Label",markupMethods:{oncssClassChange:function(){this.domNode.className="mstrmojo-Label "+this.cssClass;}},bindings:{cssClass:function(){return _iconHelper(this.parent.parent.parent.currentPublicRight);}}},{scriptClass:"mstrmojo.Label",alias:"publicRightLabel",cssClass:"sharingEditor-rightLabel",bindings:{text:function(){var editor=this.parent.parent.parent;return _getMouseOverLabel.call(editor,editor.currentPublicRight);},enabled:function(){return hasControlPermission(this.parent.parent.parent.oi);}}},{scriptClass:"mstrmojo.Pulldown",cssClass:"sharingEditor-pulldown",itemIdField:"rgt",alias:"publicRight",visible:false,postCreate:function(){this.items=this.parent.parent.parent.getAvailableRightsForSelection();},bindings:{value:"this.parent.parent.parent.currentPublicRight",enabled:function(){return hasControlPermission(this.parent.parent.parent.oi);}},selectionPolicy:"reselect",onvalueChange:function(){var mouseOverContainer=this.parent;var editor=mouseOverContainer.parent.parent;mouseOverContainer.publicRightLabel.set("text",_getMouseOverLabel.call(editor,this.value));},_set_value:function(n,v){var vWas=this.value,bChanged=(vWas!==v);if(bChanged){if(v===-1){var e=this.parent.parent.parent,me=this;e.openPopup("customACL",{zIndex:e.zIndex+10,rgt:vWas,twoStates:true,onOK:function(){me.set("value",this.getACLValue());},onCancel:function(){me.set("value",vWas);}});return false;}v=_fixACLTwoStates(v);_updatePulldown(this,v);this.updatePublicRight(v);return true;}return true;},updatePublicRight:function(v){var editor=this.parent.parent.parent;if(editor.aclList){var acls=editor.aclList.items;var guestIndex=$ARRAY.find(acls,"did",publicGuestDID);var everyoneIndex=$ARRAY.find(acls,"did",everyoneDID);if(guestModeEnabled&&guestIndex!==-1){acls[guestIndex].rgt=v;}if(everyoneIndex!==-1){acls[everyoneIndex].rgt=v;}editor.set("hasChanged",true);editor.set("currentPublicRight",v);}}}]}]},{scriptClass:"mstrmojo.DataGrid",alias:"aclList",cssClass:"aclList",renderOnScroll:false,makeObservable:true,itemDisplayField:"n",itemIdField:"did",dropZone:true,bindings:{items:function(){return this.parent.oi.acls||[];},visible:"this.parent.showACL"},onremove:function(evt){var oi=this.parent.oi;var me=this;window.setTimeout(function(){me.updateScrollbars();},10);if(!_isFolder(oi)){return ;}var inhs=oi.inhs,its=evt.value,len=its&&its.length,n,i;for(i=0;i<len;i++){n=its[i].n;delete inhs[n];}},onadd:function(evt){var oi=this.parent.oi;var me=this;window.setTimeout(function(){me.updateScrollbars();},10);if(!_isFolder(oi)){return ;}var inhs=oi.inhs,its=evt.value,len=its&&its.length,n,i;for(i=0;i<len;i++){n=its[i].n;inhs[n]=mstrmojo.hash.copy(its[i]);inhs[n].inh=true;}},onACLChanged:function(d){var oi=this.parent.oi;this.parent.set("hasChanged",true);if(!_isFolder(oi)){return ;}if(this.parent.childrenAccessPulldown.value==1){oi.inhs[d.n]=mstrmojo.hash.copy(d);oi.inhs[d.n].inh=true;}},columns:[{dataFunction:function(item,idx,w){return'<div class="mstrmojo-ACLEditor-user '+(item.st===8705?"ug":"u")+'">'+mstrmojo.string.encodeHtmlString(item.n)+"</div>";}},{dataWidget:{scriptClass:"mstrmojo.MouseOverContainer",alias:"mouseOverContainer",bindings:{enabled:function(){return hasControlPermission(this.parent.parent.parent.oi);}},setupSelectedItem:function setupSelectedItem(){this.mouseoverItem=this.dataGridPulldown;this.mouseoutItem=this.dataGridLabel;},children:[{scriptClass:"mstrmojo.Label",markupMethods:{oncssClassChange:function(){this.domNode.className="mstrmojo-Label "+this.cssClass;}},bindings:{cssClass:function(){return _iconHelper(this.parent.parent.data.rgt);}}},{scriptClass:"mstrmojo.Label",cssClass:"sharingEditor-rightLabel",alias:"dataGridLabel",bindings:{text:function(){return _getMouseOverLabel.call(mstrmojo.all[editorID],this.parent.parent.data.rgt);},enabled:function(){return hasControlPermission(this.parent.parent.parent.parent.oi);}}},{scriptClass:"mstrmojo.HBox",alias:"dataGridPulldown",cssClass:"sharingEditor-datagridContainer",visible:false,children:[{scriptClass:"mstrmojo.Pulldown",cssClass:"sharingEditor-datagridPulldown",itemIdField:"rgt",popupToBody:true,selectionPolicy:"reselect",popupZIndex:1001,postCreate:function(){this.markupMethods=mstrmojo.hash.copy({ondataChange:function(){var d=this.parent.parent.data;this.set("value",d[this.itemIdField]);},onvisibleChange:function(){this.domNode.style.display=this.visible?"block":"none";if(!this.visible&&this.popupRef){this.popupRef.set("visible",false);}}},mstrmojo.hash.copy(this.markupMethods));this.items=this.parent.parent.dataGrid.parent.getAvailableRightsForSelection();},_set_value:function(n,v){var vWas=this.value,bChanged=(vWas!==v);if(bChanged){if(v===-1){var e=this.parent.parent.dataGrid.parent,me=this;e.openPopup("customACL",{zIndex:e.zIndex+10,rgt:vWas,twoStates:!!this.parent.parent.data.newItem,onOK:function(){me.set("value",this.getACLValue());},onCancel:function(){me.set("value",vWas);}});return false;}v=_fixACL(v);_updatePulldown(this,v);this.parent.parent.data.set(this.itemIdField,v);if(vWas!==null){this.parent.parent.dataGrid.onACLChanged(this.parent.parent.data);}return true;}return true;},bindings:{enabled:function(){return hasControlPermission(this.parent.parent.parent.parent.parent.oi);}}},{scriptClass:"mstrmojo.Button",cssClass:"mstrmojo-ACLEditor-delete",text:"&nbsp",title:mstrmojo.desc(629,"Delete"),onclick:function(evt){var me=this,fnOk=function(){var dg=me.parent.parent.dataGrid;dg.remove(me.parent.parent.data);dg.parent.set("hasChanged",true);};mstrmojo.confirm(mstrmojo.desc(12299,"Are you sure you want to delete the user/user group #?").replace("#",this.parent.parent.data.n),{confirmBtn:{fn:fnOk}},{zIndex:2000});},bindings:{enabled:function(){return hasControlPermission(this.parent.parent.parent.parent.parent.oi);}}}]}]}}]},{scriptClass:"mstrmojo.Label",text:mstrmojo.desc(9892,"Children Access"),cssClass:"SharingEditor-title",bindings:{visible:function(){return this.parent.showACL&&_isFolder(this.parent.oi);}}},{scriptClass:"mstrmojo.Pulldown",alias:"childrenAccessPulldown",value:0,items:[{n:mstrmojo.desc(9890,"Preserve children's access control lists"),idx:0},{n:mstrmojo.desc(9891,"Overwrite children's access control lists"),idx:1}],itemIdField:"idx",bindings:{visible:function(){return this.parent.showACL&&_isFolder(this.parent.oi);}}},{scriptClass:"mstrmojo.HBox",cssClass:"Editor-buttonBox",slot:"buttonNode",bindings:{visible:"this.parent.showButtonBar"},children:[$NWB(mstrmojo.desc(8473,"Done"),function(evt){var e=this.parent.parent;if(_addACL(e)){_saveACL(e,e.closeEditorAfterSave);}},true,{iconClass:"mstrmojo-Editor-button-OK",bindings:{visible:"this.parent.parent.showACL",enabled:function(){return hasControlPermission(this.parent.parent.oi)&&this.parent.parent.hasChanged;},text:function(){return mstrmojo.desc(8473,"Done");}},preBuildRendering:function(){if(!this.parent.parent.showButtonText){this.set("text","");}}}),$NWB("",function(evt){var editor=this.parent.parent;editor.close();editor.set("hasChanged",false);},false,{iconClass:"mstrmojo-Editor-button-Close",bindings:{iconClass:function(){var editor=this.parent.parent;if(editor.hasChanged){return"mstrmojo-Editor-button-Cancel";}return"mstrmojo-Editor-button-Close";},text:function(){return mstrmojo.desc(2140,"Cancel");}}})]}]});mstrmojo.ACL.AddUserInputBox=mstrmojo.declare(mstrmojo.ACL.UserInputBox,null,{scriptClass:"mstrmojo.ACL.AddUserInputBox",add:function add(arr,at){var editor=this.parent.parent.parent;this._super(arr,at);_addACL(editor);},});}());