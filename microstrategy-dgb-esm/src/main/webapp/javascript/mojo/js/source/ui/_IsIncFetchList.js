(function(){mstrmojo.requiresCls("mstrmojo.dom");var $DOM=mstrmojo.dom;mstrmojo.ui._IsIncFetchList=mstrmojo.provide("mstrmojo.ui._IsIncFetchList",{_mixinName:"mstrmojo.ui._IsIncFetchList",ifDataHelper:null,supportsIncFetch:false,isFetching:false,initScroll:function initScroll(){var dataHelper=this.ifDataHelper,me=this,node=this.scrollNode||this.domNode;this.supportsIncFetch=dataHelper&&dataHelper.hasNext();if(dataHelper&&this.supportsIncFetch){this._scroll=function _scroll(){var listNode=this.scrollNode||this.domNode||node;if(Math.ceil(listNode.offsetHeight+listNode.scrollTop)>=listNode.scrollHeight){me.raiseEvent({name:"incFetch",id:me.id});}};$DOM.attachEvent(node,"scroll",this._scroll);this.attachEventListener("incFetch",this.id,function(evt){if(!this.supportsIncFetch||this.isFetching){return ;}if(this.preNext){this.preNext();}this.set("isFetching",true);dataHelper.next({complete:function(res){if(me.postNext){me.postNext();}me.set("isFetching",false);},success:function(res){me.addItems(res.items||null);},failure:function(res){me.supportsIncFetch=false;mstrmojo.alert("Error in fetching next: "+res);}});});}},unrender:function unrender(ignoreDom){var node=this.scrollNode||this.domNode;$DOM.detachEvent(node,"scroll",this._scroll);this._super(ignoreDom);},render:function render(){this._super();if(this.supportsIncFetch){var node=this.scrollNode||this.domNode;$DOM.attachEvent(node,"scroll",this._scroll);}},addItems:function addItems(items){if(this._super){this._super(items);}if(!this.ifDataHelper.hasNext()){this.supportsIncFetch=false;var node=this.scrollNode||this.domNode;$DOM.detachEvent(node,"scroll",this._scroll);}}});}());