(function(){mstrmojo.requiresCls("mstrmojo.registry","mstrmojo.hash","mstrmojo.Label","mstrmojo.array","mstrmojo.Popup","mstrmojo.Box","mstrmojo.ui.editors.controls.ColorPickerButton","mstrmojo.ui.PopupConfig","mstrmojo.ui.Pulldown","mstrmojo.ui.editors.controls.LineStyleButton","mstrmojo.dom","mstrmojo.models.FormatModel","mstrmojo.VisUtility");var $ARR=mstrmojo.array,$HASH=mstrmojo.hash,$DOM=mstrmojo.dom,$UTIL=mstrmojo.VisUtility,OPACITY_ITEMS_NUMBER=11,ENUM_PROPERTY_NAMES=mstrmojo.models.FormatModel.ENUM_PROPERTY_NAMES;function getOpacityItems(){var itemsNumber=OPACITY_ITEMS_NUMBER,i,ret=[],delta=Math.round(100/(itemsNumber-1));for(i=0;i<itemsNumber;i++){var value=(i*delta)/100,name=(i*delta)+"%";if(i===itemsNumber-1){name="100%";value=1;}ret.push({n:name,did:value});}return ret;}function getShapeItems(){var items=[{n:mstrmojo.desc(12100,"Circle"),did:"Circle"},{n:mstrmojo.desc(12101,"Square"),did:"Square"},{n:mstrmojo.desc(14433,"Diamond"),did:"Diamond"},{n:mstrmojo.desc(14434,"Hexagon"),did:"Hexagon"},{n:mstrmojo.desc(14435,"Triangle"),did:"Triangle"},{n:mstrmojo.desc(12103,"Ring"),did:"Ring"}];return items;}function findSelectedOpacityItemIndex(value){var itemsNumber=OPACITY_ITEMS_NUMBER,i,ret=0,delta=Math.round(100/(itemsNumber-1));value=Math.round(value*100);for(i=0;i<itemsNumber;i++){if(Math.abs(value-i*delta)<0.5*delta){ret=i;break;}}return ret;}function getRowContainer(children){children=children||[];$ARR.forEach(children,function(child){child.cssDisplay="inline-block";});return{scriptClass:"mstrmojo.Box",cssClass:"row-container",children:children};}function getPulldown(items,selectedIndex,obModels,width){width=width||"60px";var pulldown=new mstrmojo.ui.Pulldown({items:items,width:width});pulldown.set("selectedIndex",selectedIndex);pulldown.postselectedIndexChange=function(evt){var newIndex=evt.value,newValue=items[newIndex]&&items[newIndex].did;$ARR.forEach(obModels,function(om){om.setValue(newValue);});};return{scriptClass:"mstrmojo.Box",children:[pulldown]};}function getLabel(label,cfg){return $HASH.copy(cfg,{scriptClass:"mstrmojo.Label",text:label,cssText:"width: 60px;"});}function findSelectedIndex(items,selectedValue){var ret;$ARR.forEach(items,function(item,i){if(item===selectedValue||item.did===selectedValue){ret=i;return false;}});return ret;}function getFromSingleModel(singleModel,shapeModels,initialValues){initialValues.shapeIndex=findSelectedIndex(getShapeItems(),singleModel.shape.getValue());initialValues.fillColorValue=singleModel.color.value.getValue();initialValues.opacityIndex=findSelectedOpacityItemIndex(singleModel.color.opacity.getValue());initialValues.borderColorValue=singleModel.border.color.value.getValue();initialValues.borderStyleValue=singleModel.border.style.getValue();shapeModels.push(singleModel);}function getFromMultiModel(model,shapeModels,initialValues){var fromNode=model.circleStyle.fromNode,toNode=model.circleStyle.toNode,fromShape=fromNode.shape.getValue(),toShape=toNode.shape.getValue(),fromFillColor=fromNode.color.value.getValue(),toFillColor=toNode.color.value.getValue(),fromOpacity=fromNode.color.opacity.getValue(),toOpacity=toNode.color.opacity.getValue(),fromBorderColor=fromNode.border.color.value.getValue(),toBorderColor=toNode.border.color.value.getValue(),fromBorderStyle=fromNode.border.style.getValue(),toBorderStyle=toNode.border.style.getValue();initialValues.shapeIndex=fromShape===toShape?findSelectedIndex(getShapeItems(),fromShape):-1;initialValues.fillColorValue=fromFillColor===toFillColor?fromFillColor:"conflict";initialValues.opacityIndex=fromOpacity===toOpacity?findSelectedOpacityItemIndex(fromOpacity):-1;initialValues.borderColorValue=fromBorderColor===toBorderColor?fromBorderColor:"conflict";initialValues.borderStyleValue=fromBorderStyle===toBorderStyle?fromBorderStyle:"conflict";shapeModels.push(fromNode);shapeModels.push(toNode);}function multiModelPostSelValChangeCB(e){if(!$HASH.equals(e.value,e.valueWas)){$ARR.forEach(this.models,function(om){om.setValue(e.value);});}}var configFactory={background:function(model,extraParam){var title=(extraParam&&extraParam.label)||mstrmojo.desc(3905,"Background"),theme=mstrApp.getThemeClassName()||"";return{scriptClass:"mstrmojo.Popup",cssClass:"widget-inner-context-menu "+theme,locksHover:true,children:[getRowContainer([getLabel(title),{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",isHostedWithin:true,cssClass:theme,selectedValue:model.value.getValue(),model:model.value,showNoFill:false,width:"60px",postselectedValueChange:function(e){this.model.setValue(e.value);}}]}])]};},bubble:function(model,extraParam){var theme=mstrApp.getThemeClassName()||"",fromNode=model.circleStyle.fromNode,toNode=model.circleStyle.toNode,shapeModels=[],initialValues={shapeIndex:-1,fillColorValue:"conflict",opacityIndex:-1,borderColorValue:"conflict",borderStyleValue:"conflict"};if(extraParam.alignment.attSrc==="from"){getFromSingleModel(fromNode,shapeModels,initialValues);}else{if(extraParam.alignment.attSrc==="to"){getFromSingleModel(toNode,shapeModels,initialValues);}else{getFromMultiModel(model,shapeModels,initialValues);}}return{scriptClass:"mstrmojo.Popup",cssClass:"widget-inner-context-menu "+theme,locksHover:true,children:[getRowContainer([getLabel(mstrmojo.desc(2923,"Shape")),getPulldown(getShapeItems(),initialValues.shapeIndex,shapeModels.map(function(m){return m.shape;}),"128px")]),getRowContainer([getLabel(mstrmojo.desc(2885,"Fill")),{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",isHostedWithin:true,cssClass:theme,showNoFill:false,selectedValue:initialValues.fillColorValue,models:shapeModels.map(function(m){return m.color.value;}),width:"60px",postselectedValueChange:multiModelPostSelValChangeCB}]},getPulldown(getOpacityItems(),initialValues.opacityIndex,shapeModels.map(function(m){return m.color.opacity;}))]),getRowContainer([getLabel(mstrmojo.desc(9736,"Border")),{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.ColorPickerButton",isHostedWithin:true,cssClass:theme,showNoFill:false,showGradient:false,selectedValue:initialValues.borderColorValue,models:shapeModels.map(function(m){return m.border.color.value;}),width:"60px",postselectedValueChange:multiModelPostSelValChangeCB}]},{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.LineStyleButton",width:"60px",isHostedWithin:true,models:shapeModels.map(function(m){return m.border.style;}),selectedValue:initialValues.borderStyleValue,postselectedValueChange:multiModelPostSelValChangeCB}]}]),getRowContainer([getLabel(mstrmojo.desc(11993,"Data Labels")),{scriptClass:"mstrmojo.Box",children:[{scriptClass:"mstrmojo.ui.editors.controls.CharacterGroup",cssClass:"mstrmojo-ui-ToolbarCharacter cf",layoutConfig:null,showNoFillInColor:false,width:"397px",height:"22px,",onGroupValueChange:$UTIL.getCharGroupValueChangeCb(model.circleLabelStyle)}]}])]};}};function getConfig(type,model,e,extraParam){var factory=configFactory[type];if(factory){var config=factory(model,extraParam),containerPosition=$DOM.position(this.containerNode,true),x=e.pageX-containerPosition.x,y=e.pageY-containerPosition.y;var anchor=this._contextMenuAnchor;if(!anchor||!anchor.parentElement){anchor=document.createElement("div");anchor.style.position="absolute";this._contextMenuAnchor=anchor;this.containerNode.appendChild(anchor);}anchor.style.left=x+1+"px";anchor.style.top=y+1+"px";var popupConfig={hostId:this.id,hostElement:anchor,isHostedWithin:false};if(extraParam&&extraParam.alignment){popupConfig.alignment=extraParam.alignment;}config.popupConfig=new mstrmojo.ui.PopupConfig(popupConfig);config.visible=true;config.onClose=function(){this.unrender();};return config;}}mstrmojo.netviz._HasNetworkContextMenu=mstrmojo.provide("mstrmojo.netviz._HasNetworkContextMenu",{getWidget:function(){return this.owner;},showContextMenu:function(type,model,e,extraParam){var config=getConfig.call(this,type,model,e,extraParam);if(extraParam&&$UTIL.getPropertyByPath(extraParam,"alignment.attSrc",false)!==false){if(extraParam.alignment.attSrc==="from"){this.parent.textSelectedIndex=1;}else{if(extraParam.alignment.attSrc==="from and to"){this.parent.textSelectedIndex=0;}else{this.parent.textSelectedIndex=2;}}}if(type==="bubble"){config=mstrmojo.registry.ref(config);var charGroup=$UTIL.getPropertyByPath(config,"children.3.children.1.children.0");if(charGroup!==undefined){charGroup.setFormatSource(this.getDataLabelFormats());charGroup.fontColor.isHostedWithin=true;charGroup.fontSize.isHostedWithin=true;charGroup.fontFamily.isHostedWithin=true;}}this.openPopup(config);},unrender:function(params){this._contextMenuAnchor=undefined;this._super(params);}});}());